<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//RU"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>Array Information</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- 3,next,fn-in,charset=utf-8,sections+,minitoc<,html --> 
<meta name="src" content="clm.tex"> 
<meta name="date" content="2012-06-19 08:48:00"> 
<link rel="stylesheet" type="text/css" href="clm.css"> 
<link rel="stylesheet" type="text/css" href="../cltl2ed.css"></head><body 
>
   <div id="toplinks"> &lt;<a href="../index.html">Main Page</a>&gt; &lt;<a href="symbols.html">Symbols</a>&gt; <br> &#x003C;<a 
href="clmse94.html" >Next</a>&#x003E;&#x003C;<a 
href="clmse92.html" >Prev</a>&#x003E;&#x003C;<a 
href="clmse92.html#tailclmse92.html" >PrevTail</a>&#x003E;&#x003C;<a 
href="#tailclmse93.html">Tail</a>&#x003E;&#x003C;<a 
href="array.html#clmse93.html" >Up</a>&#x003E;</div><h3 class="sectionHead"><span class="titlemark">17.3   </span> <a 
href="clm.html#QQ2-115-185" id="x115-15500017.3">Array Information</a></h3>
<!--l. 357--><p class="noindent" >The following functions extract from an array interesting information other than
the elements.
<div class="defun">
<div class="defunheader">
<em>
<!--l. 361--><p class="noindent" >[Function]</em><a 
 id="dx115-155001"></a> <b>array-element-type</b> <i>array</i>
</div>
<b>
<!--l. 363--><p class="indent" >   <a 
href="symbols.html#x188-376102r102">array-element-type</a></b> returns a type speciﬁer for the set of objects that can be
stored in the <em>array</em>. This set may be larger than the set requested when the array
was created; for example, the result of <div class="lisp"><tt><div class="tabbing">
(array-element-type (make-array 5 :element-type &#x2019;(mod 5)))
   <br>
<!--l. 369--><p class="noindent" ></div>
</tt>
</div>
<!--l. 370--><p class="indent" >   could be <b>(mod 5)</b>, <b>(mod 8)</b>, <b>ﬁxnum</b>, <b><a 
href="symbols.html#x188-376941r941">t</a></b>, or any other type of which <b>(mod 5)</b>
is a subtype. See <b><a 
href="symbols.html#x188-376928r928">subtypep</a></b>.
<hr></div>
<div class="defun">
<div class="defunheader">
<em>
<!--l. 375--><p class="noindent" >[Function]</em><a 
 id="dx115-155002"></a> <b>array-rank</b> <i>array</i>
</div>
<!--l. 377--><p class="indent" >   This returns the number of dimensions (axes) of <em>array</em>. This will be a
                                                                          

                                                                          
non-negative integer. See <b><a 
href="symbols.html#x188-376106r106">array-rank-limit</a></b>.
<hr></div>
<div class="defun">
<div class="defunheader">
<em>
<!--l. 383--><p class="noindent" >[Function]</em><a 
 id="dx115-155003"></a> <b>array-dimension</b> <i>array</i> <i>axis-number</i>
</div>
<!--l. 385--><p class="indent" >   The length of dimension number <em>axis-number</em> of the <em>array</em> is returned. <em>array</em>
may be any kind of array, and <em>axis-number</em> should be a non-negative integer
less than the rank of <em>array</em>. If the <em>array</em> is a vector with a ﬁll pointer,
<b><a 
href="symbols.html#x188-376098r98">array-dimension</a></b> returns the total size of the vector, including inactive elements,
not the size indicated by the ﬁll pointer. (The function <b><a 
href="symbols.html#x188-376530r530">length</a></b> will return the size
indicated by the ﬁll pointer.)
<hr></div>
<div class="defun">
<div class="defunheader">
<em>
<!--l. 397--><p class="noindent" >[Function]</em><a 
 id="dx115-155004"></a> <b>array-dimensions</b> <i>array</i>
</div>
<b>
<!--l. 399--><p class="indent" >   <a 
href="symbols.html#x188-376100r100">array-dimensions</a></b> returns a list whose elements are the dimensions of
<em>array</em>.
<hr></div>
<div class="defun">
<div class="defunheader">
<em>
<!--l. 404--><p class="noindent" >[Function]</em><a 
 id="dx115-155005"></a> <b>array-total-size</b> <i>array</i>
</div>
<b>
<!--l. 406--><p class="indent" >   <a 
href="symbols.html#x188-376108r108">array-total-size</a></b> returns the total number of elements in the <em>array</em>, calculated
as the product of all the dimensions. <div class="lisp"><tt><div class="tabbing">
                                                                          

                                                                          
(array-total-size <em>x</em>)
   <br>                                             <span class="math"> ≡</span> (apply #&#x2019;* (array-dimensions <em>x</em>))<br>
   <span class="math"> ≡</span> (reduce #&#x2019;* (array-dimensions <em>x</em>))<br>
<!--l. 412--><p class="noindent" ></div>
</tt>
</div>
<!--l. 413--><p class="indent" >   Note that the total size of a zero-dimensional array is <b>1</b>. The total
size of a one-dimensional array is calculated without regard for any ﬁll
pointer.
<hr></div>
<div class="defun">
<div class="defunheader">
<em>
<!--l. 419--><p class="noindent" >[Function]</em><a 
 id="dx115-155006"></a> <b>array-in-bounds-p</b> <i>array</i> <tt><a 
href="clmse29.html#x39-620005.2.2">&#x0026;rest</a></tt> <i>subscripts</i>
</div>
<!--l. 421--><p class="indent" >   This predicate checks whether the <em>subscripts</em> are all legal subscripts for
<em>array</em>. The predicate is true if they are all legal; otherwise it is false.
The <em>subscripts</em> must be integers. The number of <em>subscripts</em> supplied must
equal the rank of the array. Like <b><a 
href="symbols.html#x188-376093r93">aref</a></b>, <b><a 
href="symbols.html#x188-376104r104">array-in-bounds-p</a></b> ignores ﬁll
pointers.
<hr></div>
<div class="defun">
<div class="defunheader">
<em>
<!--l. 429--><p class="noindent" >[Function]</em><a 
 id="dx115-155007"></a> <b>array-row-major-index</b> <i>array</i> <tt><a 
href="clmse29.html#x39-620005.2.2">&#x0026;rest</a></tt> <i>subscripts</i>
</div>
<!--l. 431--><p class="indent" >   This function takes an array and valid subscripts for the array and returns a
single non-negative integer less than the total size of the array that identiﬁes the
accessed element in the row-major ordering of the elements. The number of
<em>subscripts</em> supplied must equal the rank of the array. Each subscript must be a
non-negative integer less than the corresponding array dimension. Like <b><a 
href="symbols.html#x188-376093r93">aref</a></b>,
<b><a 
href="symbols.html#x188-376107r107">array-row-major-index</a></b> ignores ﬁll pointers.
                                                                          

                                                                          
<!--l. 440--><p class="indent" >   A possible deﬁnition of <b><a 
href="symbols.html#x188-376107r107">array-row-major-index</a></b>, with no error checking,
would be <div class="lisp"><tt><div class="tabbing">
(defun array-row-major-index (a <b>&#x0026;rest</b> subscripts)
   <br>                                            (apply #&#x2019;+ (maplist #&#x2019;(lambda (x y)<br>
                          (* (car x) (apply #&#x2019;* (cdr y))))<br>
                      subscripts<br>
                      (array-dimensions a))))<br>
<!--l. 448--><p class="noindent" ></div>
</tt>
</div>
<!--l. 449--><p class="indent" >   For a one-dimensional array, the result of <b><a 
href="symbols.html#x188-376107r107">array-row-major-index</a></b> always
equals the supplied subscript.
<hr></div>
<div class="defun">
<div class="defunheader">
<em>
<!--l. 454--><p class="noindent" >[Function]</em><a 
 id="dx115-155008"></a> <b>row-major-aref</b> <i>array</i> <i>index</i>
</div>
<!--l. 456--><p class="indent" >   This allows any array element to be accessed as if the containing array were
one-dimensional. The <em>index</em> must be a non-negative integer less than the total size
of the <em>array</em>. It indexes into the array as if its elements were arranged
one-dimensionally in row-major order. It may be understood in terms of <b><a 
href="symbols.html#x188-376093r93">aref</a></b> as
follows: <div class="lisp"><tt><div class="tabbing">
(row-major-aref <em>array</em> <em>index</em>) <span class="math"> ≡</span>
   <br>                  (aref (make-array (array-total-size array))<br>
                    :displaced-to array<br>
                    :element-type (array-element-type array))<br>
        index)<br>
<!--l. 467--><p class="noindent" ></div>
</tt>
                                                                          

                                                                          
</div>
<!--l. 468--><p class="indent" >   In other words, one may treat an array as one-dimensional by creating a new
one-dimensional array that is displaced to the old one and then accessing the new
array. Alternatively, <b><a 
href="symbols.html#x188-376093r93">aref</a></b> may be understood in terms of <b><a 
href="symbols.html#x188-376812r812">row-major-aref</a></b>:
<div class="lisp"><tt><div class="tabbing">
(aref <em>array</em> <span class="math"><em>i</em><sub>0</sub></span> <span class="math"><em>i</em><sub>1</sub></span> ... <span class="math"><em>i</em><sub>n−1</sub></span>) <span class="math"> ≡</span>
   <br>                             (row-major-aref array<br>
                  (array-row-major-index array <span class="math"><em>i</em><sub>0</sub></span> <span class="math"><em>i</em><sub>1</sub></span> ... <span class="math"><em>i</em><sub>n−1</sub></span>)<br>
<!--l. 476--><p class="noindent" ></div>
</tt>
</div>
<!--l. 477--><p class="indent" >   That is, a multidimensional array access is equivalent to a row-major access
using an equivalent row-major index.
<!--l. 480--><p class="indent" >   Like <b><a 
href="symbols.html#x188-376093r93">aref</a></b>, <b><a 
href="symbols.html#x188-376812r812">row-major-aref</a></b> completely ignores ﬁll pointers. A call to
<b>row-major-setf</b> is suitable for use as a <em>place</em> for <b><a 
href="symbols.html#x188-376833r833">setf</a></b>.
<!--l. 484--><p class="indent" >   This operation makes it easier to write code that eﬃciently processes arrays of
any rank. Suppose, for example, that one wishes to set every element of an array
<b>tennis-scores</b> to zero. One might write <div class="lisp"><tt><div class="tabbing">
(ﬁll (make-array (array-total-size tennis-scores)
   <br>                     :element-type (array-element-type tennis-scores)<br>
                  :displaced-to tennis-scores)<br>                        0)<br>
<!--l. 492--><p class="noindent" ></div>
</tt>
</div>
<!--l. 493--><p class="indent" >   Unfortunately, this incurs the overhead of creating a displaced array, and <b><a 
href="symbols.html#x188-376397r397">ﬁll</a></b>
cannot be applied to multidimensional arrays. Another approach would be to
handle each possible rank separately: <div class="lisp"><tt><div class="tabbing">
(ecase (array-rank tennis-scores)
                                                                          

                                                                          
   <br>                                                      (0 (setf (aref tennis-scores) 0))<br>
  (1 (dotimes (i0 (array-dimension tennis-scores 0))<br>
       (setf (aref tennis-scores i0) 0)))<br>  (2 (dotimes (i0 (array-dimension tennis-scores 0))<br>
       (dotimes (i1 (array-dimension tennis-scores 1))<br>
         (setf (aref tennis-scores i0 i1) 0))))<br>                            ...<br>
  (7 (dotimes (i0 (array-dimension tennis-scores 0))<br>
       (dotimes (i1 (array-dimension tennis-scores 1))<br>
         (dotimes (i2 (array-dimension tennis-scores 1))<br>
           (dotimes (i3 (array-dimension tennis-scores 1))<br>
             (dotimes (i4 (array-dimension tennis-scores 1))<br>
               (dotimes (i5 (array-dimension tennis-scores 1))<br>
                 (dotimes (i6 (array-dimension tennis-scores 1))<br>
                   (setf (aref tennis-scores i0 i1 i2 i3 i4 i5 i6)<br>
                         0)))))))))<br>                                   )<br>
<!--l. 515--><p class="noindent" ></div>
</tt>
</div>
<!--l. 516--><p class="indent" >   It is easy to get tired of writing such code. Furthermore, this approach is
undesirable because some implementations of Common Lisp will in fact correctly
support arrays of rank greater than 7 (though no implementation is required to do
so). A recursively nested loop does the job, but it is still pretty hairy:
<div class="lisp"><tt><div class="tabbing">
(labels
   <br>                                                     ((grok-any-rank (&#x0026;rest indices)<br>
     (let ((d (- (array-rank tennis-scores) (length indices)))<br>
       (if (= d 0)<br>              (setf (apply #&#x2019;row-major-aref indices) 0)<br>
           (dotimes (i (array-dimension tennis-scores (- d 1)))<br>
             (apply #&#x2019;grok-any-rank i indices))))))<br>     (grok-any-rank))<br>
<!--l. 530--><p class="noindent" ></div>
</tt>
</div>
<!--l. 531--><p class="indent" >   Whether this code is particularly eﬃcient depends on many implementation
parameters, such as how <b>&#x0026;rest</b> arguments are handled and how cleverly calls
to <b><a 
href="symbols.html#x188-376089r89">apply</a></b> are compiled. How much easier it is to use <b><a 
href="symbols.html#x188-376812r812">row-major-aref</a></b>!
<div class="lisp"><tt><div class="tabbing">
                                                                          

                                                                          
(dotimes (i (array-total-size tennis-scores))
   <br>                                         (setf (row-major-aref tennis-scores i) 0))<br>
<!--l. 538--><p class="noindent" ></div>
</tt>
</div>
<!--l. 539--><p class="indent" >   Surely this code is sweeter than the honeycomb.
<hr></div>
<div class="defun">
<div class="defunheader">
<em>
<!--l. 543--><p class="noindent" >[Function]</em><a 
 id="dx115-155009"></a> <b>adjustable-array-p</b> <i>array</i>
</div>
<!--l. 545--><p class="indent" >   This predicate is true if the argument (which must be an array) is adjustable,
and otherwise is false.
<div class="newer">
<!--l. 549--><p class="indent" >   X3J13 voted in June 1989 <a 
 id="dx115-155010"></a>to clarify that <b><a 
href="symbols.html#x188-376081r81">adjustable-array-p</a></b> is true of
an array if and only if <b><a 
href="symbols.html#x188-376080r80">adjust-array</a></b>, when applied to that array, will
return the same array, that is, an array <b><a 
href="symbols.html#x188-376366r366">eq</a></b> to the original array. If the
<b>:adjustable</b> argument to <b><a 
href="symbols.html#x188-376576r576">make-array</a></b> is non-<b><a 
href="symbols.html#x188-376658r658">nil</a></b> when an array is created, then
<b><a 
href="symbols.html#x188-376081r81">adjustable-array-p</a></b> must be true of that array. If an array is created with the
<b>:adjustable</b> argument <b><a 
href="symbols.html#x188-376658r658">nil</a></b> (or omitted), then <b><a 
href="symbols.html#x188-376081r81">adjustable-array-p</a></b> may
be true or false of that array, depending on the implementation. X3J13
further voted to <em>deﬁne</em> the terminology “adjustable array” to mean precisely
“an array of which <b><a 
href="symbols.html#x188-376081r81">adjustable-array-p</a></b> is true.” See <b><a 
href="symbols.html#x188-376576r576">make-array</a></b> and
<b><a 
href="symbols.html#x188-376080r80">adjust-array</a></b>.
</div>
<hr></div>
<div class="defun">
<div class="defunheader">
<em>
<!--l. 568--><p class="noindent" >[Function]</em><a 
 id="dx115-155011"></a> <b>array-displacement</b> <i>array</i>
                                                                          

                                                                          
</div>
<!--l. 570--><p class="indent" >   This returns two values. The ﬁrst value is the array displaced to and
the second is the displacement. If array is not a displaced array then
array-displacement returns the values nil and 0.
<hr></div>
                                                                          

                                                                          
<!--l. 575--><p class="indent" >   <div id="bottomlinks">&#x003C;<a 
href="clmse94.html" >Next</a>&#x003E;&#x003C;<a 
href="clmse92.html" >Prev</a>&#x003E;&#x003C;<a 
href="clmse92.html#tailclmse92.html" >PrevTail</a>&#x003E;&#x003C;<a 
href="clmse93.html" >Front</a>&#x003E;&#x003C;<a 
href="array.html#clmse93.html" >Up</a>&#x003E;<br>&lt;<a href="../index.html">Main Page</a>&gt; &lt;<a href="symbols.html">Symbols</a>&gt; </div><a 
 id="tailclmse93.html"></a>  
</body></html> 
