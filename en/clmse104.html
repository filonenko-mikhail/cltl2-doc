<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//RU"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>Defstruct Options</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- 3,next,fn-in,charset=utf-8,sections+,minitoc<,html --> 
<meta name="src" content="clm.tex"> 
<meta name="date" content="2012-06-05 16:06:00"> 
<link rel="stylesheet" type="text/css" href="clm.css"> 
<link rel="stylesheet" type="text/css" href="../cltl2ed.css"></head><body 
>
   <div id="toplinks"> &lt;<a href="../index.html">Main Page</a>&gt; &lt;<a href="symbols.html">Symbols</a>&gt; <br> &#x003C;<a 
href="clmse105.html" >Next</a>&#x003E;&#x003C;<a 
href="clmse103.html" >Prev</a>&#x003E;&#x003C;<a 
href="clmse103.html#tailclmse103.html" >PrevTail</a>&#x003E;&#x003C;<a 
href="#tailclmse104.html">Tail</a>&#x003E;&#x003C;<a 
href="struct.html#clmse104.html" >Up</a>&#x003E;</div><h3 class="sectionHead"><span class="titlemark">19.5   </span> <a 
href="clm.html#QQ2-128-198" id="x128-16800019.5">Defstruct Options</a></h3>
<!--l. 461--><p class="noindent" >The preceding description of <b><a 
href="symbols.html#x188-375313r313">defstruct</a></b> is all that the average user will need (or
want) to know in order to use structures. The remainder of this chapter discusses
more complex features of the <b><a 
href="symbols.html#x188-375313r313">defstruct</a></b> facility.
<!--l. 466--><p class="indent" >   This section explains each of the options that can be given to <b><a 
href="symbols.html#x188-375313r313">defstruct</a></b>. A
<b><a 
href="symbols.html#x188-375313r313">defstruct</a></b> option may be either a keyword or a list of a keyword and arguments
for that keyword. (Note that the syntax for <b><a 
href="symbols.html#x188-375313r313">defstruct</a></b> options diﬀers from
the pair syntax used for slot-options. No part of any of these options is
evaluated.)
<div class="flushdesc">
      <ul><li><b>
<b>:conc-name</b> </b></li>This  provides  for  automatic  preﬁxing  of  names  of  access
      functions.  It  is  conventional  to  begin  the  names  of  all  the  access
      functions of a structure with a speciﬁc preﬁx, the name of the structure
      followed by a hyphen. This is the default behavior.
      <!--l. 481--><p class="noindent" >The argument to the <b>:conc-name</b> option speciﬁes an alternative preﬁx
      to be used. (If a hyphen is to be used as a separator, it must be speciﬁed
      as part of the preﬁx.) If <b><a 
href="symbols.html#x188-375658r658">nil</a></b> is speciﬁed as an argument, then <em>no</em> preﬁx
      is used; then the names of the access functions are the same as the
      slot-names, and it is up to the user to name the slots reasonably.
      <!--l. 489--><p class="noindent" >Note that no matter what is speciﬁed for <b>:conc-name</b>, with a constructor
      function one uses slot keywords that match the slot-names, with no preﬁx
      attached. On the other hand, one uses the access-function name when using
      <b><a 
href="symbols.html#x188-375833r833">setf</a></b>. Here is an example: <div class="lisp"><tt><div class="tabbing">
      (defstruct door knob-color width material)
      <br>                                                                          (setq my-door<br>
                 (make-door :knob-color &#x2019;red :width 5.0))<br>
                                                                          

                                                                          
           (door-width my-door) <span class="math"> ⇒</span> 5.0<br>
           (setf (door-width my-door) 43.7)<br>
           (door-width my-door) <span class="math"> ⇒</span> 43.7<br>
           (door-knob-color my-door) <span class="math"> ⇒</span> red<br>
      <!--l. 502--><p class="noindent" ></div>
</tt>
</div>
      <li><b>
<b>:constructor</b> </b></li>This option takes one argument, a symbol, which speciﬁes the
      name of the constructor function. If the argument is not provided or if the
      option itself is not provided, the name of the constructor is produced by
      concatenating the string <b>&#x0022;MAKE-&#x0022;</b> and the name of the structure, putting
      the name in whatever package is current at the time the <b><a 
href="symbols.html#x188-375313r313">defstruct</a></b> form is
      processed (see <b><a 
href="symbols.html#x188-375026r26">*package*</a></b>). If the argument is provided and is <b><a 
href="symbols.html#x188-375658r658">nil</a></b>, no
      constructor function is deﬁned.
      <!--l. 515--><p class="noindent" >This option actually has a more general syntax that is explained in
      section <a 
href="clmse105.html#x129-16900019.6">19.6<!--tex4ht:ref: DEFSTRUCT-CONSTRUCTOR-SYNTAX --></a>.
      <li><b>
<b>:copier</b> </b></li>This option takes one argument, a symbol, which speciﬁes the name of
      the copier function. If the argument is not provided or if the option itself is
      not provided, the name of the copier is produced by concatenating the string
      <b>&#x0022;COPY-&#x0022;</b> and the name of the structure, putting the name in whatever
      package is current at the time the <b><a 
href="symbols.html#x188-375313r313">defstruct</a></b> form is processed (see
      <b><a 
href="symbols.html#x188-375026r26">*package*</a></b>). If the argument is provided and is <b><a 
href="symbols.html#x188-375658r658">nil</a></b>, no copier function is
      deﬁned.
      <!--l. 528--><p class="noindent" >The automatically deﬁned copier function simply makes a new structure and
      transfers all components verbatim from the argument into the newly created
      structure. No attempt is made to make copies of the components.
      Corresponding components of the old and new structures will therefore be
      <b><a 
href="symbols.html#x188-375367r367">eql</a></b>.
      <li><b>
<b>:predicate</b> </b></li>This option takes one argument, which speciﬁes the name of the type
      predicate. If the argument is not provided or if the option itself is not
      provided, the name of the predicate is made by concatenating the name of
                                                                          

                                                                          
      the structure to the string <b>&#x0022;-P&#x0022;</b>, putting the name in whatever package is
      current at the time the <b><a 
href="symbols.html#x188-375313r313">defstruct</a></b> form is processed (see <b><a 
href="symbols.html#x188-375026r26">*package*</a></b>).
      If the argument is provided and is <b><a 
href="symbols.html#x188-375658r658">nil</a></b>, no predicate is deﬁned. A
      predicate can be deﬁned only if the structure is “named”; if the <b>:type</b>
      option is speciﬁed and the <b>:named</b> option is not speciﬁed, then the
      <b>:predicate</b> option must either be unspeciﬁed or have the value
      <b><a 
href="symbols.html#x188-375658r658">nil</a></b>.
      <li><b>
<b>:include</b> </b></li>This option is used for building a new structure deﬁnition as an
      extension of an old structure deﬁnition. As an example, suppose you have a
      structure called <b>person</b> that looks like this: <div class="lisp"><tt><div class="tabbing">
      (defstruct person name age sex)
      <br>
      <!--l. 555--><p class="noindent" ></div>
</tt>
</div>
      <!--l. 556--><p class="noindent" >Now suppose you want to make a new structure to represent an astronaut.
      Since astronauts are people too, you would like them also to have the
      attributes of name, age, and sex, and you would like Lisp functions that
      operate on <b>person</b> structures to operate just as well on <b>astronaut</b>
      structures. You can do this by deﬁning <b>astronaut</b> with the <b>:include</b>
      option, as follows: <div class="lisp"><tt><div class="tabbing">
      (defstruct (astronaut (:include person)
      <br>                                                     (:conc-name astro-))<br>
              helmet-size<br>                       (favorite-beverage &#x2019;tang))<br>
      <!--l. 567--><p class="noindent" ></div>
</tt>
                                                                          

                                                                          
</div>
      <!--l. 569--><p class="noindent" >The <b>:include</b> option causes the structure being deﬁned to have the same
      slots as the included structure. This is done in such a way that the
      access functions for the included structure will also work on the
      structure being deﬁned. In this example, an <b>astronaut</b> will therefore
      have ﬁve slots: the three deﬁned in <b>person</b> and the two deﬁned in
      <b>astronaut</b> itself. The access functions deﬁned by the <b>person</b> structure
      can be applied to instances of the <b>astronaut</b> structure, and they
      will work correctly. Moreover, <b>astronaut</b> will have its own access
      functions for components deﬁned by the <b>person</b> structure. The
      following examples illustrate how you can use <b>astronaut</b> structures:
      <div class="lisp"><tt><div class="tabbing">
      (setq x (make-astronaut :name &#x2019;buzz
      <br>                                                                     :age 45<br>
                                   :sex t<br>
                                   :helmet-size 17.5))<br>                 <br>
           (person-name x) <span class="math"> ⇒</span> buzz<br>       (astro-name x) <span class="math"> ⇒</span> buzz<br>       <br>
           (astro-favorite-beverage x) <span class="math"> ⇒</span> tang<br>
      <!--l. 594--><p class="noindent" ></div>
</tt>
</div>
      <!--l. 595--><p class="noindent" >The diﬀerence between the access functions <b>person-name</b> and <b>astro-name</b>
      is that <b>person-name</b> may be correctly applied to any <b>person</b>, including an
      <b>astronaut</b>, while <b>astro-name</b> may be correctly applied only to an
      <b>astronaut</b>. (An implementation may or may not check for incorrect use of
      access functions.)
      <!--l. 601--><p class="noindent" >At most one <b>:include</b> option may be speciﬁed in a single <b><a 
href="symbols.html#x188-375313r313">defstruct</a></b> form.
      The argument to the <b>:include</b> option is required and must be the name of
      some previously deﬁned structure. If the structure being deﬁned
      has no <b>:type</b> option, then the included structure must also have
      had no <b>:type</b> option speciﬁed for it. If the structure being deﬁned
      has a <b>:type</b> option, then the included structure must have been
                                                                          

                                                                          
      declared with a <b>:type</b> option specifying the same representation
      type.
      <!--l. 611--><p class="noindent" >If no <b>:type</b> option is involved, then the structure name of the including
      structure deﬁnition becomes the name of a data type, of course, and
      therefore a valid type speciﬁer recognizable by <b><a 
href="symbols.html#x188-375966r966">typep</a></b>; moreover, it becomes
      a subtype of the included structure. In the above example, <b>astronaut</b> is a
      subtype of <b>person</b>; hence <div class="lisp"><tt><div class="tabbing">
      (typep (make-astronaut) &#x2019;person)
      <br>
      <!--l. 619--><p class="noindent" ></div>
</tt>
</div>
      <!--l. 620--><p class="noindent" >is true, indicating that all operations on persons will also work on
      astronauts.
      <!--l. 623--><p class="noindent" >The following is an advanced feature of the <b>:include</b> option. Sometimes,
      when one structure includes another, the default values or slot-options for
      the slots that came from the included structure are not what you want. The
      new structure can specify default values or slot-options for the included slots
      diﬀerent from those the included structure speciﬁes, by giving the <b>:include</b>
      option as <div class="lisp"><tt><div class="tabbing">
      (:include <em>name</em> <em>slot-description-1</em> <em>slot-description-2</em> ...)
      <br>
      <!--l. 631--><p class="noindent" ></div>
</tt>
</div>
      <!--l. 632--><p class="noindent" >Each <em>slot-description-j</em> must have a <em>slot-name</em> or <em>slot-keyword</em> that is the
      same as that of some slot in the included structure. If <em>slot-description-j</em> has
                                                                          

                                                                          
      no <em>default-init</em>, then in the new structure the slot will have no initial value.
      Otherwise its initial value form will be replaced by the <em>default-init</em> in
      <em>slot-description-j</em>. A normally writable slot may be made read-only. If a slot
      is read-only in the included structure, then it must also be so in the
      including structure. If a type is speciﬁed for a slot, it must be the same as,
      or a subtype of, the type speciﬁed in the included structure. If it is a strict
      subtype, the implementation may or may not choose to error-check
      assignments.
      <!--l. 645--><p class="noindent" >For example, if we had wanted to deﬁne <b>astronaut</b> so that the default age
      for an astronaut is <b>45</b>, then we could have said: <div class="lisp"><tt><div class="tabbing">
      (defstruct (astronaut (:include person (age 45)))
      <br>                                                                            helmet-size<br>
              (favorite-beverage &#x2019;tang))<br>
      <!--l. 651--><p class="noindent" ></div>
</tt>
</div>
<div class="new">
      <!--l. 654--><p class="noindent" >X3J13 voted in June 1988 <a 
 id="dx128-168001"></a>to require any structure type created by
      <b><a 
href="symbols.html#x188-375313r313">defstruct</a></b> (or <b><a 
href="symbols.html#x188-375298r298">defclass</a></b>) to be disjoint from any of the types <b>cons</b>, <b>symbol</b>,
      <b>array</b>, <b>number</b>, <b><a 
href="symbols.html#x188-375222r222">character</a></b>, <b>hash-table</b>, <b>readtable</b>, <b>package</b>,
      <b><a 
href="symbols.html#x188-375706r706">pathname</a></b>, <b>stream</b>, and <b>random-state</b>. A consequence of this
      requirement is that it is an error to specify any of these types, or any of
      their subtypes, to the <b><a 
href="symbols.html#x188-375313r313">defstruct</a></b> <b>:include</b> option. (The ﬁrst edition
      said nothing explicitly about this. Inasmuch as using such a type
      with the <b>:include</b> option was not deﬁned to work, one might argue
      that such use was an error in Common Lisp as deﬁned by the ﬁrst
      edition.)
      </div>
      <li><b>
<b>:print-function</b> </b></li>This option may be used only if the <b>:type</b> option is not
      speciﬁed. The argument to the <b>:print-function</b> option should be a function
      of three arguments, in a form acceptable to the <b><a 
href="symbols.html#x188-375434r434">function</a></b> special operator,
                                                                          

                                                                          
      to be used to print structures of this type. When a structure of this type is
      to be printed, the function is called on three arguments: the structure to be
      printed, a stream to print to, and an integer indicating the current depth (to
      be compared against <b><a 
href="symbols.html#x188-375034r34">*print-level*</a></b>). The printing function should observe
      the values of such printer-control variables as <b><a 
href="symbols.html#x188-375031r31">*print-escape*</a></b> and
      <b><a 
href="symbols.html#x188-375038r38">*print-pretty*</a></b>.
      <!--l. 685--><p class="noindent" >If the <b>:print-function</b> option is not speciﬁed and the <b>:type</b> option
      also not speciﬁed, then a default printing function is provided for
      the structure that will print out all its slots using <b>#S</b> syntax (see
      section <a 
href="clmse112.html#x139-18600022.1.4">22.1.4<!--tex4ht:ref: SHARP-SIGN-MACRO-CHARACTER-SECTION --></a>).
<div class="new">
      <!--l. 691--><p class="noindent" >X3J13 voted in January 1989 <a 
 id="dx128-168002"></a>to specify that user-deﬁned printing
      functions for the <b><a 
href="symbols.html#x188-375313r313">defstruct</a></b> <b>:print-function</b> option may print objects
      to the supplied stream using <b><a 
href="symbols.html#x188-376015r1015">write</a></b>, <b>print1</b>, <b><a 
href="symbols.html#x188-375737r737">princ</a></b>, <b><a 
href="symbols.html#x188-375426r426">format</a></b>, or
      <b><a 
href="symbols.html#x188-375741r741">print-object</a></b> and expect circularities to be detected and printed
      using <b>#<em>n</em>#</b> syntax (when <b><a 
href="symbols.html#x188-375030r30">*print-circle*</a></b> is non-<b><a 
href="symbols.html#x188-375658r658">nil</a></b>, of course). See
      <b><a 
href="symbols.html#x188-375030r30">*print-circle*</a></b>.
      </div>
<div class="new">
      <!--l. 703--><p class="noindent" >X3J13 voted in January 1989 <a 
 id="dx128-168003"></a>to clarify that if the <b>:print-function</b> option is
      not speciﬁed but the <b>:include</b> option <em>is</em> speciﬁed, then the print function is
      inherited from the included structure type. Thus, for example, an
      <b>astronaut</b> will be printed by the same printing function that is used for
      <b>person</b>.
      <!--l. 711--><p class="noindent" >X3J13 in the same vote extended the <b>print-function</b> option as follows:
      If the <b>print-function</b> option is speciﬁed but with no argument,
      then the standard default printing function (that uses <b>#S</b> syntax)
      will be used. This provides a means of overriding the inheritance
      rule. For example, if <b>person</b> and <b>astronaut</b> had been deﬁned as
      <div class="lisp"><tt><div class="tabbing">
      (defstruct (person
      <br>                           (:print-function     ;Special print function<br>
                        (lambda (p s k)<br>                     (format s &#x0022;&#x003C;~A, age ~D&#x003E;&#x0022;<br>
                                                                          

                                                                          
                                  (person-name p)<br>
                                  (person-age p)))))<br>
             name age sex)<br>                                               <br>
           (defstruct (astronaut<br>                        (:include person)<br>
                        (:conc-name astro-)<br>
                        (:print-function))     ;Use default print function<br>
              helmet-size<br>                       (favorite-beverage &#x2019;tang))<br>
      <!--l. 732--><p class="noindent" ></div>
</tt>
</div>
      <!--l. 733--><p class="noindent" >then an ordinary person would be printed as “<b>&#x003C;Joe Schmoe, age 27&#x003E;</b>”
      but an astronaut would be printed as, for example, <div class="lisp"><tt><div class="tabbing">
      #S(ASTRONAUT NAME BUZZ AGE 45 SEX T
      <br>                  HELMET-SIZE 17.5 FAVORITE-BEVERAGE TANG)<br>
      <!--l. 738--><p class="noindent" ></div>
</tt>
</div>
      <!--l. 739--><p class="noindent" >using the default <b>#S</b> syntax (yuk).
      <!--l. 741--><p class="noindent" >These changes make the behavior of <b><a 
href="symbols.html#x188-375313r313">defstruct</a></b> with respect to the <b>:include</b>
      option a bit more like the behavior of classes in CLOS.
      </div>
      <li><b>
<b>:type</b> </b></li>The <b>:type</b> option explicitly speciﬁes the representation to be used for the
      structure. It takes one argument, which must be one of the types
      enumerated below.
      <!--l. 750--><p class="noindent" >Specifying this option has the eﬀect of forcing a speciﬁc representation and
      of forcing the components to be stored in the order speciﬁed in the
      <b><a 
href="symbols.html#x188-375313r313">defstruct</a></b> form in corresponding successive elements of the speciﬁed
      representation. It also <em>prevents</em> the structure name from becoming a valid
      type speciﬁer recognizable by <b><a 
href="symbols.html#x188-375966r966">typep</a></b> (see section <a 
href="clmse106.html#x130-17000019.7">19.7<!--tex4ht:ref: EXPLICIT-TYPE-STRUCTURES --></a>).
                                                                          

                                                                          
      <!--l. 758--><p class="noindent" >Normally this option is not speciﬁed, in which case the structure is
      represented in an implementation-dependent manner.
      <!--l. 761--><p class="noindent" >
              <div class="quotation">
<div class="flushdesc">
    <ul><li><b>
<b><a 
href="symbols.html#x188-375992r992">vector</a></b> </b></li>This produces the same result as specifying <b>(vector
    t)</b>.  The  structure  is  represented  as  a  general  vector,
    storing   components   as   vector   elements.   The   ﬁrst
    component  is  vector  element  1  if  the  structure  is
    <b>:named</b>, and element 0 otherwise.
    <li><b>
<b>(vector <em>element-type</em>)</b> </b></li>The structure is represented as a
    (possibly  specialized)  vector,  storing  components  as
    vector  elements.  Every  component  must  be  of  a  type
    that can be stored in a vector of the type speciﬁed. The
    ﬁrst component is vector element 1 if the structure is
    <b>:named</b>, and element 0 otherwise. The structure may
    be <b>:named</b> only if the type <b>symbol</b> is a subtype of the
    speciﬁed <b>element-type</b>.
    <li><b>
<b><a 
href="symbols.html#x188-375535r535">list</a></b> </b></li>The  structure  is  represented  as  a  list.  The  ﬁrst
    component is the <em>cadr</em> if the structure is <b>:named</b>, and
    the <em>car</em> if it is <b>:unnamed</b>.</ul>
</div>
           </div>
      <li><b>
<b>:named</b> </b></li>The <b>:named</b> option speciﬁes that the structure is “named”; this option
      takes no argument. If no <b>:type</b> option is speciﬁed, then the structure is
      always named; so this option is useful only in conjunction with
      the <b>:type</b> option. See section <a 
href="clmse106.html#x130-17000019.7">19.7<!--tex4ht:ref: EXPLICIT-TYPE-STRUCTURES --></a> for a further description of this
      option.
      <li><b>
                                                                          

                                                                          
<b>:initial-oﬀset</b> </b></li>This allows you to tell <b><a 
href="symbols.html#x188-375313r313">defstruct</a></b> to skip over a certain number of
      slots before it starts allocating the slots described in the body. This option
      requires an argument, a non-negative integer, which is the number of slots
      you want <b><a 
href="symbols.html#x188-375313r313">defstruct</a></b> to skip. The <b>:initial-oﬀset</b> option may be used only if
      the <b>:type</b> option is also speciﬁed. See section <a 
href="clmse106.html#x130-17300019.7.3">19.7.3<!--tex4ht:ref: DEFSTRUCT-INITIAL-OFFSET --></a> for a further description
      of this option.</ul>
</div>
                                                                          

                                                                          
<!--l. 806--><p class="indent" >   <div id="bottomlinks">&#x003C;<a 
href="clmse105.html" >Next</a>&#x003E;&#x003C;<a 
href="clmse103.html" >Prev</a>&#x003E;&#x003C;<a 
href="clmse103.html#tailclmse103.html" >PrevTail</a>&#x003E;&#x003C;<a 
href="clmse104.html" >Front</a>&#x003E;&#x003C;<a 
href="struct.html#clmse104.html" >Up</a>&#x003E;<br>&lt;<a href="../index.html">Main Page</a>&gt; &lt;<a href="symbols.html">Symbols</a>&gt; </div><a 
 id="tailclmse104.html"></a>  
</body></html> 
