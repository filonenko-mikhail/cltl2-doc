<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//RU"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>End-Test Control</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- 3,next,fn-in,charset=utf-8,sections+,minitoc<,html --> 
<meta name="src" content="clm.tex"> 
<meta name="date" content="2012-05-16 18:03:00"> 
<link rel="stylesheet" type="text/css" href="clm.css"> 
<link rel="stylesheet" type="text/css" href="../cltl2ed.css"></head><body 
>
   <div id="toplinks"> &lt;<a href="../index.html">Main Page</a>&gt; &lt;<a href="symbols.html">Symbols</a>&gt; <br> &#x003C;<a 
href="clmse132.html" >Next</a>&#x003E;&#x003C;<a 
href="clmse130.html" >Prev</a>&#x003E;&#x003C;<a 
href="clmse130.html#tailclmse130.html" >PrevTail</a>&#x003E;&#x003C;<a 
href="#tailclmse131.html">Tail</a>&#x003E;&#x003C;<a 
href="loop.html#clmse131.html" >Up</a>&#x003E;</div><h3 class="sectionHead"><span class="titlemark">25.7   </span> <a 
href="clm.html#QQ2-161-274" id="x161-23500025.7">End-Test Control</a></h3>
<!--l. 1019--><p class="noindent" >The loop keywords <b><a 
href="symbols.html#x188-375085r85">always</a></b>, <b><a 
href="symbols.html#x188-375656r656">never</a></b>, <b><a 
href="symbols.html#x188-375947r947">thereis</a></b>, <b><a 
href="symbols.html#x188-375972r972">until</a></b>, and <b><a 
href="symbols.html#x188-375998r998">while</a></b> designate
constructs that use a single test condition to determine when loop iteration should
terminate.
<!--l. 1023--><p class="indent" >   The constructs <b><a 
href="symbols.html#x188-375085r85">always</a></b>, <b><a 
href="symbols.html#x188-375656r656">never</a></b>, and <b><a 
href="symbols.html#x188-375947r947">thereis</a></b> provide speciﬁc values to be
returned when a loop terminates. Using <b><a 
href="symbols.html#x188-375085r85">always</a></b>, <b><a 
href="symbols.html#x188-375656r656">never</a></b>, or <b><a 
href="symbols.html#x188-375947r947">thereis</a></b> with
value-returning accumulation clauses can produce unpredictable results.
In all other respects these constructs behave like the <b><a 
href="symbols.html#x188-375998r998">while</a></b> and <b><a 
href="symbols.html#x188-375972r972">until</a></b>
constructs.
<!--l. 1030--><p class="indent" >   The macro <b><a 
href="symbols.html#x188-375566r566">loop-ﬁnish</a></b> can be used at any time to cause normal termination.
In normal termination, <b><a 
href="symbols.html#x188-375400r400">ﬁnally</a></b> clauses are executed and default return values are
returned.
<!--l. 1034--><p class="indent" >   End-test control constructs can be used anywhere within the loop
body. The termination conditions are tested in the order in which they
appear.
<div class="defloop">
<div class="defmacheader">
<!--l. 1039--><p class="indent" >   <div class="tabbing">
 <em>[Loop clause]</em> <b>while</b> <a 
 id="dx161-235001"></a>expr
   <br>
<!--l. 1039--><p class="noindent" ></div>
</div>
<div class="defmacheader">
<!--l. 1039--><p class="indent" >   <div class="tabbing">
 <em>[Loop clause]</em> <b>until</b> <a 
 id="dx161-235002"></a>expr
   <br>
<!--l. 1041--><p class="noindent" ></div>
</div>
<!--l. 1042--><p class="indent" >   The <b><a 
href="symbols.html#x188-375998r998">while</a></b> construct allows iteration to continue until the speciﬁed expression
                                                                          

                                                                          
<em>expr</em> evaluates to <b><a 
href="symbols.html#x188-375658r658">nil</a></b>. The expression is re-evaluated at the location of the <b><a 
href="symbols.html#x188-375998r998">while</a></b>
clause.
<!--l. 1046--><p class="indent" >   The <b><a 
href="symbols.html#x188-375972r972">until</a></b> construct is equivalent to <b><a 
href="symbols.html#x188-375998r998">while</a></b> (<b><a 
href="symbols.html#x188-375664r664">not</a></b> <em>expr</em>). If the value of the
speciﬁed expression is non-<b><a 
href="symbols.html#x188-375658r658">nil</a></b>, iteration terminates.
<!--l. 1050--><p class="indent" >   You can use <b><a 
href="symbols.html#x188-375998r998">while</a></b> and <b><a 
href="symbols.html#x188-375972r972">until</a></b> at any point in a loop. If a <b><a 
href="symbols.html#x188-375998r998">while</a></b> or <b><a 
href="symbols.html#x188-375972r972">until</a></b>
clause causes termination, any clauses that precede it in the source are still
evaluated.
<!--l. 1055--><p class="indent" >   Examples: <div class="lisp"><tt><div class="tabbing">
;;; A classic &#x0022;while-loop&#x0022;.
   <br>                                                     (loop while (hungry-p) do (eat))<br>
<br>                                  ;;; UNTIL NOT is equivalent to WHILE.<br>
(loop until (not (hungry-p)) do (eat))<br>                                     <br>
;;; Collect the length and the items of STACK.<br>   (let ((stack &#x2019;(a b c d e f)))<br>
  (loop while stack<br>            for item = (length stack) then (pop stack)<br>
        collect item))<br>                              <span class="math"> ⇒</span> (6 A B C D E F)<br>
<br>                ;;; Use WHILE to terminate a loop that otherwise wouldn&#x2019;t<br>
;;; terminate. Note that WHILE occurs after the WHEN.<br>
(loop for i ﬁxnum from 3<br>      when (oddp i) collect i<br>      while (&#x003C; i 5))<br>
   <span class="math"> ⇒</span> (3 5)<br>
<!--l. 1076--><p class="noindent" ></div>
</tt>
</div>
<hr>
</div>
<div class="defloop">
<div class="defmacheader">
<!--l. 1081--><p class="indent" >   <div class="tabbing">
 <em>[Loop clause]</em> <b>always</b> <a 
 id="dx161-235003"></a>expr
   <br>
<!--l. 1081--><p class="noindent" ></div>
</div>
<div class="defmacheader">
                                                                          

                                                                          
<!--l. 1081--><p class="indent" >   <div class="tabbing">
 <em>[Loop clause]</em> <b>never</b> <a 
 id="dx161-235004"></a>expr
   <br>
<!--l. 1082--><p class="noindent" ></div>
</div>
<div class="defmacheader">
<!--l. 1082--><p class="indent" >   <div class="tabbing">
 <em>[Loop clause]</em> <b>thereis</b> <a 
 id="dx161-235005"></a>expr
   <br>
<!--l. 1084--><p class="noindent" ></div>
</div>
<!--l. 1085--><p class="indent" >   The <b><a 
href="symbols.html#x188-375085r85">always</a></b> construct takes one form and terminates the loop if the form ever
evaluates to <b><a 
href="symbols.html#x188-375658r658">nil</a></b>; in this case, it returns <b><a 
href="symbols.html#x188-375658r658">nil</a></b>. Otherwise, it provides a default return
value of <b><a 
href="symbols.html#x188-375939r939">t</a></b>.
<!--l. 1089--><p class="indent" >   The <b><a 
href="symbols.html#x188-375656r656">never</a></b> construct takes one form and terminates the loop if the form ever
evaluates to non-<b><a 
href="symbols.html#x188-375658r658">nil</a></b>; in this case, it returns <b><a 
href="symbols.html#x188-375658r658">nil</a></b>. Otherwise, it provides a default
return value of <b><a 
href="symbols.html#x188-375939r939">t</a></b>.
<!--l. 1093--><p class="indent" >   The <b><a 
href="symbols.html#x188-375947r947">thereis</a></b> construct takes one form and terminates the loop if the form ever
evaluates to non-<b><a 
href="symbols.html#x188-375658r658">nil</a></b>; in this case, it returns that value.
<!--l. 1097--><p class="indent" >   If the <b><a 
href="symbols.html#x188-375998r998">while</a></b> or <b><a 
href="symbols.html#x188-375972r972">until</a></b> construct causes termination, control is passed to the
loop epilogue, where any <b><a 
href="symbols.html#x188-375400r400">ﬁnally</a></b> clauses will be executed. Since <b><a 
href="symbols.html#x188-375085r85">always</a></b>, <b><a 
href="symbols.html#x188-375656r656">never</a></b>,
and <b><a 
href="symbols.html#x188-375947r947">thereis</a></b> use the Common Lisp macro <b><a 
href="symbols.html#x188-375804r804">return</a></b> to terminate iteration, any
<b><a 
href="symbols.html#x188-375400r400">ﬁnally</a></b> clause that is speciﬁed is not evaluated.
<!--l. 1104--><p class="indent" >   Examples: <div class="lisp"><tt><div class="tabbing">
;;; Make sure I is always less than 11 (two ways).
   <br>                                   ;;; The FOR construct terminates these loops.<br>
<!--l. 1108--><p class="noindent" ></div>
</tt>
</div>
<div class="lisp">
                                                                          

                                                                          
<tt>
<!--l. 1109--><p class="indent" >   <div class="tabbing">
(loop for i from 0 to 10
   <br>                                                                      always (&#x003C; i 11))<br>
   <span class="math"> ⇒</span> T<br>
<!--l. 1113--><p class="noindent" ></div>
</tt>
</div>
<div class="lisp">
<tt>
<!--l. 1114--><p class="indent" >   <div class="tabbing">
(loop for i from 0 to 10
   <br>                                                                        never (&#x003E; i 11))<br>
   <span class="math"> ⇒</span> T<br>
<!--l. 1118--><p class="noindent" ></div>
</tt>
</div>
<div class="lisp">
<tt>
<!--l. 1119--><p class="indent" >   <div class="tabbing">
;;; If I exceeds 10, return I; otherwise, return NIL.
   <br>                               ;;; The THEREIS construct terminates this loop.<br>
<!--l. 1122--><p class="noindent" ></div>
</tt>
</div>
<div class="lisp">
<tt>
<!--l. 1123--><p class="indent" >   <div class="tabbing">
                                                                          

                                                                          
(loop for i from 0
   <br>                                                         thereis (when (&#x003E; i 10) i) )<br>
   <span class="math"> ⇒</span> 11<br>
<!--l. 1127--><p class="noindent" ></div>
</tt>
</div>
<div class="lisp">
<tt>
<!--l. 1128--><p class="indent" >   <div class="tabbing">
;;; The FINALLY clause is not evaluated in these examples.
   <br>
<!--l. 1130--><p class="noindent" ></div>
</tt>
</div>
<div class="lisp">
<tt>
<!--l. 1131--><p class="indent" >   <div class="tabbing">
(loop for i from 0 to 10
   <br>           always (&#x003C; i 9)<br>           ﬁnally (print &#x0022;you won&#x2019;t see this&#x0022;))<br>
   <span class="math"> ⇒</span> NIL<br>
<!--l. 1136--><p class="noindent" ></div>
</tt>
</div>
<div class="lisp">
<tt>
<!--l. 1137--><p class="indent" >   <div class="tabbing">
                                                                          

                                                                          
(loop never t
   <br>                                             ﬁnally (print &#x0022;you won&#x2019;t see this&#x0022;))<br>
   <span class="math"> ⇒</span> NIL<br>
<!--l. 1141--><p class="noindent" ></div>
</tt>
</div>
<div class="lisp">
<tt>
<!--l. 1142--><p class="indent" >   <div class="tabbing">
(loop thereis &#x0022;Here is my value&#x0022;
   <br>                                             ﬁnally (print &#x0022;you won&#x2019;t see this&#x0022;))<br>
   <span class="math"> ⇒</span> &#x0022;Here is my value&#x0022;<br>
<!--l. 1146--><p class="noindent" ></div>
</tt>
</div>
<div class="lisp">
<tt>
<!--l. 1147--><p class="indent" >   <div class="tabbing">
;;; The FOR construct terminates this loop,
   <br>                                           ;;; so the FINALLY clause is evaluated.<br>
<!--l. 1150--><p class="noindent" ></div>
</tt>
</div>
<div class="lisp">
<tt>
<!--l. 1151--><p class="indent" >   <div class="tabbing">
(loop for i from 1 to 10
                                                                          

                                                                          
   <br>                                                                       thereis (&#x003E; i 11)<br>
      ﬁnally (print i))                                       ;Prints 1 line<br>
11<br>                                                                <span class="math"> ⇒</span> NIL<br>
<!--l. 1157--><p class="noindent" ></div>
</tt>
</div>
<div class="lisp">
<tt>
<!--l. 1159--><p class="indent" >   <div class="tabbing">
(defstruct mountain height diﬃculty (why &#x0022;because it is there&#x0022;))
   <br>                   (setq everest (make-mountain :height &#x2019;(2.86e-13 parsecs)))<br>
(setq chocorua (make-mountain :height &#x2019;(1059180001 microns)))<br>
(defstruct desert area (humidity 0))<br>(setq sahara (make-desert :area &#x2019;(212480000 square furlongs)))<br>
       ;First there is a mountain, then there is no mountain, then there is <span class="math">…</span><br>
(loop for x in (list everest sahara chocorua)                        ; —GLS<br>
      thereis (and (mountain-p x) (mountain-height x)))<br>
   <span class="math"> ⇒</span> (2.86E-13 PARSECS)<br>                                             <br>
;;; If you could use this code to ﬁnd a counterexample to<br>
;;; Fermat&#x2019;s last theorem, it would still not return the value<br>
;;; of the counterexample because all of the THEREIS clauses<br>
;;; in this example return only T.   Of course, this code has<br>
;;; never been observed to terminate.<br>                                      <br>
(loop for z upfrom 2<br>                                               thereis<br>
        (loop for n upfrom 3 below (log z 2)<br>                    thereis<br>
                (loop for x below z<br>                          thereis<br>
                        (loop for y below z<br>
                              thereis (= (+ (expt x n)<br>
                                            (expt y n))<br>
                                         (expt z n))))))<br>
<!--l. 1186--><p class="noindent" ></div>
</tt>
</div>
<hr>
</div>
                                                                          

                                                                          
<div class="defmac">
<div class="defmacheader">
<!--l. 1190--><p class="indent" >   <div class="tabbing">
 <em>[Macro]</em> <b>loop-ﬁnish</b> <a 
 id="dx161-235006"></a><b></b>
   <br>
<!--l. 1191--><p class="noindent" ></div>
</div>
<!--l. 1192--><p class="indent" >   The macro <b><a 
href="symbols.html#x188-375566r566">loop-ﬁnish</a></b> terminates iteration normally and returns any
accumulated result. If speciﬁed, a <b><a 
href="symbols.html#x188-375400r400">ﬁnally</a></b> clause is evaluated.
<!--l. 1196--><p class="indent" >   In most cases it is not necessary to use <b><a 
href="symbols.html#x188-375566r566">loop-ﬁnish</a></b> because other loop control
clauses terminate the loop. Use <b><a 
href="symbols.html#x188-375566r566">loop-ﬁnish</a></b> to provide a normal exit from a
nested condition inside a loop.
<!--l. 1201--><p class="indent" >   You can use <b><a 
href="symbols.html#x188-375566r566">loop-ﬁnish</a></b> inside nested Lisp code to provide a normal exit from
a loop. Since <b><a 
href="symbols.html#x188-375566r566">loop-ﬁnish</a></b> transfers control to the loop epilogue, using <b><a 
href="symbols.html#x188-375566r566">loop-ﬁnish</a></b>
within a <b><a 
href="symbols.html#x188-375400r400">ﬁnally</a></b> expression can cause inﬁnite looping.
<!--l. 1208--><p class="indent" >   Implementations are allowed to provide this construct as a local macro by
using <b><a 
href="symbols.html#x188-375575r575">macrolet</a></b>.
<!--l. 1211--><p class="indent" >   Examples: <div class="lisp"><tt><div class="tabbing">
;;; Print a date in February, but exclude leap day.
   <br>
;;; LOOP-FINISH exits from the nested condition.<br>(loop for date in date-list<br>
      do (case date<br>                     (29 (when (eq month &#x2019;february)<br>
                     (loop-ﬁnish))<br>
             (format t &#x0022;~:@(~A~) ~A&#x0022; month date))))<br>
<br>                  ;;; Terminate the loop, but return the accumulated count.<br>
(loop for i in &#x2019;(1 2 3 stop-here 4 5 6)<br>
      when (symbolp i) do (loop-ﬁnish)<br>           count i)<br>        <span class="math"> ⇒</span> 3<br>
<br>                   ;;; This loop works just as well as the previous example.<br>
(loop for i in &#x2019;(1 2 3 stop-here 4 5 6)<br>      until (symbolp i)<br>      count i)<br>
   <span class="math"> ⇒</span> 3<br>
<!--l. 1232--><p class="noindent" ></div>
</tt>
                                                                          

                                                                          
</div>
<hr>
</div>
                                                                          

                                                                          
<!--l. 1235--><p class="indent" >   <div id="bottomlinks">&#x003C;<a 
href="clmse132.html" >Next</a>&#x003E;&#x003C;<a 
href="clmse130.html" >Prev</a>&#x003E;&#x003C;<a 
href="clmse130.html#tailclmse130.html" >PrevTail</a>&#x003E;&#x003C;<a 
href="clmse131.html" >Front</a>&#x003E;&#x003C;<a 
href="loop.html#clmse131.html" >Up</a>&#x003E;<br>&lt;<a href="../index.html">Main Page</a>&gt; &lt;<a href="symbols.html">Symbols</a>&gt; </div><a 
 id="tailclmse131.html"></a>  
</body></html> 
