<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//RU"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>How to Use Defstruct</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- 3,next,fn-in,charset=utf-8,sections+,minitoc<,html --> 
<meta name="src" content="clm.tex"> 
<meta name="date" content="2012-05-16 18:03:00"> 
<link rel="stylesheet" type="text/css" href="clm.css"> 
<link rel="stylesheet" type="text/css" href="../cltl2ed.css"></head><body 
>
   <div id="toplinks"> &lt;<a href="../index.html">Main Page</a>&gt; &lt;<a href="symbols.html">Symbols</a>&gt; <br> &#x003C;<a 
href="clmse102.html" >Next</a>&#x003E;&#x003C;<a 
href="clmse100.html" >Prev</a>&#x003E;&#x003C;<a 
href="clmse100.html#tailclmse100.html" >PrevTail</a>&#x003E;&#x003C;<a 
href="#tailclmse101.html">Tail</a>&#x003E;&#x003C;<a 
href="struct.html#clmse101.html" >Up</a>&#x003E;</div><h3 class="sectionHead"><span class="titlemark">19.2   </span> <a 
href="clm.html#QQ2-125-195" id="x125-16500019.2">How to Use Defstruct</a></h3>
<!--l. 154--><p class="noindent" >All structures are deﬁned through the <b><a 
href="symbols.html#x188-375313r313">defstruct</a></b> construct. A call to <b><a 
href="symbols.html#x188-375313r313">defstruct</a></b>
deﬁnes a new data type whose instances have named slots.
<div class="defmac">
<div class="defmacheader">
<!--l. 159--><p class="indent" >   <div class="tabbing">
 <em>[Macro]</em> <b>defstruct</b> <a 
 id="dx125-165001"></a>name-and-options [doc-string] {slot-description}+
   <br>
<!--l. 160--><p class="noindent" ></div>
</div>
<div class="new">
<!--l. 161--><p class="noindent" >X3J13 voted in June 1988 <a 
 id="dx125-165002"></a>to allow a <b><a 
href="symbols.html#x188-375313r313">defstruct</a></b> deﬁnition to have no
<em>slot-description</em> at all; in other words, the occurrence of {<i><em>slot-description</em></i>}+ in
the preceding header line would be replaced by  {<i><em>slot-description</em></i>}* .
<!--l. 169--><p class="indent" >   Such structure deﬁnitions are particularly useful if the <b>:include</b> option is used,
perhaps with other options; for example, one can have two structures that are
exactly alike except that they print diﬀerently (having diﬀerent <b>:print-function</b>
options).
<!--l. 174--><p class="indent" >   Implementors are encouraged to permit this simple extension as soon as
convenient. Users, however, may wish to maximize portability of their code by
avoiding the use of this extension unless and until it is adopted as part of the
ANSI standard.
</div>
<!--l. 180--><p class="indent" >   This deﬁnes a record-structure data type. A general call to <b><a 
href="symbols.html#x188-375313r313">defstruct</a></b> looks
like the following example. <div class="lisp"><tt><div class="tabbing">
(defstruct (<em>name</em> <em>option-1</em> <em>option-2</em> ... <em>option-m</em>)
   <br>                                                                            <em>doc-string</em><br>
           <em>slot-description-1</em><br>                         <em>slot-description-2</em><br>
                                                                          

                                                                          
           ...<br>                                       <em>slot-description-n</em>)<br>
<br>
<!--l. 189--><p class="noindent" ></div>
</tt>
</div>
<!--l. 190--><p class="indent" >   The <em>name</em> must be a symbol; it becomes the name of a new data type
consisting of all instances of the structure. The function <b><a 
href="symbols.html#x188-375964r964">typep</a></b> will accept and
use this name as appropriate. The <em>name</em> is returned as the value of the <em>defstruct</em>
form.
<!--l. 196--><p class="indent" >   Usually no options are needed at all. If no options are speciﬁed, then one may
write simply <em>name</em> instead of <b>(<em>name</em>)</b> after the word <b><a 
href="symbols.html#x188-375313r313">defstruct</a></b>. The syntax of
options and the options provided are discussed in section <a 
href="clmse104.html#x128-16800019.5">19.5<!--tex4ht:ref: DEFSTRUCT-OPTIONS --></a>.
<!--l. 201--><p class="indent" >   If the optional documentation string <em>doc-string</em> is present, then it is
attached to the <em>name</em> as a documentation string of type <b>structure</b>; see
<b><a 
href="symbols.html#x188-375340r340">documentation</a></b>.
<!--l. 205--><p class="indent" >   Each <em>slot-description-j</em> is of the form <div class="lisp"><tt><div class="tabbing">
(<em>slot-name</em> <em>default-init</em>
   <br>                                       <em>slot-option-name-1</em> <em>slot-option-value-1</em><br>
     <em>slot-option-name-2</em> <em>slot-option-value-2</em><br>                            ...<br>
     <em>slot-option-name-k<span class="math"><sub>j</sub></span></em> <em>slot-option-value-k<span class="math"><sub>j</sub></span></em>)<br>
<!--l. 212--><p class="noindent" ></div>
</tt>
</div>
<!--l. 213--><p class="indent" >   Each <em>slot-name</em> must be a symbol; an access function is deﬁned for each slot. If
no options and no <em>default-init</em> are speciﬁed, then one may write simply <em>slot-name</em>
instead of <b>(<em>slot-name</em>)</b> as the slot description.
<em>
<!--l. 218--><p class="indent" >   default-init</em> form is evaluated only if the corresponding argument is
not supplied to the constructor function. The <em>default-init</em> is a form that
is evaluated <em>each time</em> its value is to be used as the initial value of the
slot.
<!--l. 224--><p class="indent" >   If no <em>default-init</em> is speciﬁed, then the initial contents of the slot are undeﬁned
and implementation-dependent. The available slot-options are described in
section <a 
href="clmse103.html#x127-16700019.4">19.4<!--tex4ht:ref: Defstruct-Slot-Options --></a>.
                                                                          

                                                                          
<div class="new">
<!--l. 230--><p class="indent" >   X3J13 voted in January 1989 <a 
 id="dx125-165003"></a>to specify that it is an error for two slots to
have the same name; more precisely, no two slots may have names for
whose print names <b><a 
href="symbols.html#x188-375912r912">string=</a></b> would be true. Under this interpretation
<div class="lisp"><tt><div class="tabbing">
(defstruct lotsa-slots slot slot)
   <br>
<!--l. 238--><p class="noindent" ></div>
</tt>
</div>
<!--l. 239--><p class="indent" >   obviously is incorrect but the following one is also in error, even assuming that
the symbols <b>coin:slot</b> and <b>blot:slot</b> really are distinct (non-<b><a 
href="symbols.html#x188-375367r367">eql</a></b>) symbols:
<div class="lisp"><tt><div class="tabbing">
(defstruct no-dice coin:slot blot:slot)
   <br>
<!--l. 244--><p class="noindent" ></div>
</tt>
</div>
<!--l. 245--><p class="indent" >   To illustrate another case, the ﬁrst <b><a 
href="symbols.html#x188-375313r313">defstruct</a></b> form below is correct, but the
second one is in error. <div class="lisp"><tt><div class="tabbing">
(defstruct one-slot slot)
   <br>                                    (defstruct (two-slots (:include one-slot)) slot)<br>
<!--l. 250--><p class="noindent" ></div>
</tt>
</div>__________________________________________________________________________<div class="rationale">
<!--l. 253--><p class="noindent" ><b>Rationale:</b> Print names are the criterion for slot-names being the same, rather
than the symbols themselves, because <b><a 
href="symbols.html#x188-375313r313">defstruct</a></b> constructs names of accessor
functions from the print names and interns the resulting new names in the current
                                                                          

                                                                          
package.
</div>
__________________________________________________________________________
<!--l. 261--><p class="indent" >     X3J13 recommended that expanding a <b><a 
href="symbols.html#x188-375313r313">defstruct</a></b> form violating this
restriction should signal an error and noted, with an eye to the Common Lisp
Object System <a 
 id="dx125-165004"></a>, that the restriction applies only to the operation of the
<b><a 
href="symbols.html#x188-375313r313">defstruct</a></b> macro as such and not to the <b>structure-class</b> or structures deﬁned
with <b><a 
href="symbols.html#x188-375298r298">defclass</a></b>.
</div>
<div class="newer">
<!--l. 271--><p class="indent" >     X3J13 voted in March 1989 <a 
 id="dx125-165005"></a>to clarify that, while deﬁning forms normally
appear at top level, it is meaningful to place them in non-top-level contexts;
<b><a 
href="symbols.html#x188-375313r313">defstruct</a></b> must treat slot <em>default-init</em> forms and any initialization forms within
                                                                          

                                                                          
the speciﬁcation of a by-position constructor function as occurring within the
enclosing lexical environment, not within the global environment.
</div>
<b>
<!--l. 282--><p class="indent" >   <a 
href="symbols.html#x188-375313r313">defstruct</a></b> not only deﬁnes an access function for each slot, but also arranges
for <b><a 
href="symbols.html#x188-375832r832">setf</a></b> to work properly on such access functions, deﬁnes a predicate named
<b><em>name</em>-p</b>, deﬁnes a constructor function named <b>make-<em>name</em></b>, and deﬁnes a
copier function named <b>copy-<em>name</em></b>. All names of automatically created
functions are interned in whatever package is current at the time the
<b><a 
href="symbols.html#x188-375313r313">defstruct</a></b> form is processed (see <b><a 
href="symbols.html#x188-375026r26">*package*</a></b>). Also, all such functions may
be declared <b>inline</b> at the discretion of the implementation to improve
eﬃciency; if you do not want some function declared <b>inline</b>, follow the
<b><a 
href="symbols.html#x188-375313r313">defstruct</a></b> form with a <b>notinline</b> declaration to override any automatic <b>inline</b>
declaration.
<div class="newer">
<!--l. 297--><p class="indent" >   X3J13 voted in January 1989 <a 
 id="dx125-165006"></a>to specify that the results of redeﬁning a
<b><a 
href="symbols.html#x188-375313r313">defstruct</a></b> structure (that is, evaluating more than one <b><a 
href="symbols.html#x188-375313r313">defstruct</a></b> structure for
the same name) are undeﬁned.
<!--l. 302--><p class="indent" >   The problem is that if instances have been created under the old deﬁnition and
then remain accessible after the new deﬁnition has been evaluated, the accessors
and other functions for the new deﬁnition may be incompatible with the old
instances. Conversely, functions associated with the old deﬁnition may have been
declared <b>inline</b> and compiled into code that remains accessible after the new
deﬁnition has been evaluated; such code may be incompatible with the new
instances.
<!--l. 310--><p class="indent" >   In practice this restriction aﬀects the development and debugging process
rather than production runs of fully developed code. The <b><a 
href="symbols.html#x188-375313r313">defstruct</a></b> feature is
intended to provide “the most eﬃcient” structure class. CLOS classes
deﬁned by <b><a 
href="symbols.html#x188-375298r298">defclass</a></b> allow much more ﬂexible structures to be deﬁned and
redeﬁned.
<!--l. 317--><p class="indent" >   Programming environments are allowed and encouraged to permit <b><a 
href="symbols.html#x188-375313r313">defstruct</a></b>
redeﬁnition, perhaps with warning messages about possible interactions with
other parts of the programming environment or memory state. It is beyond the
scope of the Common Lisp language standard to deﬁne those interactions except
to note that they are not portable.
</div>
<hr></div>
                                                                          

                                                                          
<!--l. 326--><p class="indent" >   <div id="bottomlinks">&#x003C;<a 
href="clmse102.html" >Next</a>&#x003E;&#x003C;<a 
href="clmse100.html" >Prev</a>&#x003E;&#x003C;<a 
href="clmse100.html#tailclmse100.html" >PrevTail</a>&#x003E;&#x003C;<a 
href="clmse101.html" >Front</a>&#x003E;&#x003C;<a 
href="struct.html#clmse101.html" >Up</a>&#x003E;<br>&lt;<a href="../index.html">Main Page</a>&gt; &lt;<a href="symbols.html">Symbols</a>&gt; </div><a 
 id="tailclmse101.html"></a>  
</body></html> 
