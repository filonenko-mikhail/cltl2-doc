%Part{Struct, Root = "CLM.MSS"}
%%%Chapter of Common Lisp Manual.  Copyright 1984, 1988, 1989 Guy L. Steele Jr.

\clearpage\def\pagestatus{FINAL PROOF}

\ifx \rulang\Undef

\chapter{Structures}

Common Lisp provides a facility for creating named record structures
with named components.  In effect, the user can define a new data type;
every data structure of that type has components with specified names.
Constructor, access, and assignment constructs are automatically
defined when the data type is defined.

This chapter is divided into two parts.  The first part discusses
the basics of the structure facility, which is very simple and allows
the user to take advantage of the type-checking, modularity, and
convenience of user-defined record data types.  The second part,
beginning with section~\ref{Defstruct-Hairy-Stuff},
discusses a number of specialized features of the facility that
have advanced applications.  These features are completely optional,
and you needn't even know they exist in order to take
advantage of the basics.

\section{Introduction to Structures}
\label{DEFSTRUCT-INTRO-SECTION}

The structure facility is embodied in the \cdf{defstruct} macro,
which allows the user to create and use
aggregate data types with named elements.  These are like
``structures'' in {PL/I}, or ``records'' in Pascal.

As an example, assume you are writing a Lisp
program that deals with space ships in a two-dimensional plane.
In your program, you need to
represent a space ship by a Lisp object of some kind.  The interesting
things about a space ship, as far as your program is concerned, are
its position (represented as \emph{x} and \emph{y} coordinates),
velocity (represented as components along the \emph{x} and \emph{y} axes), and
mass.

A ship might therefore be represented as a record structure with five
components: \emph{x}-position, \emph{y}-position, \emph{x}-velocity, \emph{y}-velocity, and mass.
This structure could in turn be implemented as a Lisp object in a
number of ways.  It could be a list of five elements; the \emph{x}-position
could be the \emph{car}, the \emph{y}-position the \emph{cadr}, and so on.  Equally
well it could be a vector of five elements: the \emph{x}-position could be
element 0, the \emph{y}-position element 1, and so on.  The problem with either
of these representations is that the components occupy places in the
object that are quite arbitrary and hard to remember.  Someone looking at
\cd{(cadddr~ship1)} or \cd{(aref~ship1~3)} in a piece of code might
find it difficult to determine that this is accessing the \emph{y}-velocity
component of \cd{ship1}.  Moreover, if the representation of a ship should
have to be changed, it would be very difficult to find all the places
in the code to be changed to match (not all occurrences of \cdf{cadddr}
are intended to extract the \emph{y}-velocity from a ship).

Ideally components of record structures should have names.  One would
like to write something like
\cd{(ship-y-velocity ship1)} instead of \cd{(cadddr ship1)}.
One would also like a more mnemonic way to create a ship than this:
\begin{lisp}
(list 0 0 0 0 0)
\end{lisp}
Indeed, one would like \cdf{ship} to be a new data type, just like other
Lisp data types, that one could test with \cdf{typep}, for example.
The \cdf{defstruct} facility provides all of this.

\cdf{defstruct} itself is a macro that defines a structure.  For the
space ship example, one might define the structure by saying:
\begin{lisp}
(defstruct ship \\
~~x-position \\
~~y-position \\
~~x-velocity \\
~~y-velocity \\
~~mass)
\end{lisp}
This declares that every \cdf{ship} is an object with five named components.
The evaluation of this form does several things:

\begin{itemize}
\item
It defines \cdf{ship-x-position} to be a function
of one argument, a ship, that returns the \emph{x}-position
of the ship; \cdf{ship-y-position}
and the other components are given similar function definitions.
These functions are called the \emph{access functions}, as they
are used to access elements of the structure.

\item
The symbol \cdf{ship} becomes the name of a data type of which instances
of ships are elements.  This name becomes acceptable to \cdf{typep},
for example; \cd{(typep x 'ship)} is true if \cdf{x} is a ship
and false if \cdf{x} is any object other than a ship.

\item
A function named \cdf{ship-p} of one argument is defined; it is a predicate
that is true if its argument is a ship and is false otherwise.

\item
A function called \cdf{make-ship} is defined that, when invoked,
will create a data structure with five components, suitable for use with
the access functions.  Thus executing
\begin{lisp}
(setq ship2 (make-ship))
\end{lisp}
sets \cd{ship2} to a newly created \cdf{ship} object.
One can specify the initial values of any desired component in the call
to \cdf{make-ship} by using keyword arguments in this way:
\begin{lisp}
(setq ship2 (make-ship \cd{:mass} *default-ship-mass* \\
~~~~~~~~~~~~~~~~~~~~~~~\cd{:x-position} 0 \\
~~~~~~~~~~~~~~~~~~~~~~~\cd{:y-position} 0))
\end{lisp}
This constructs a new ship and initializes three of its components.
This function is called the \emph{constructor function}
because it constructs a new structure.

\item
The \cd{\#S} syntax can be used to read instances of \cdf{ship}
structures, and a printer function is provided for printing
out ship structures.  For example, the value of the
variable \cd{ship2} shown above might be printed as
\begin{lisp}
\#S(ship  x-position 0  y-position 0  x-velocity nil \\
~~~~~~~~~y-velocity nil  mass 170000.0)
\end{lisp}

\item
A function called \cdf{copy-ship} of one argument
is defined that, when given a \cdf{ship} object,
will create a new \cdf{ship} object that is a copy of the given one.
This function is called the \emph{copier function}.

\item
One may use \cdf{setf} to alter the components of a \cdf{ship}:
\begin{lisp}
(setf (ship-x-position ship2) 100)
\end{lisp}
This alters the \emph{x}-position of \emph{ship2} to be \cd{100}.
This works because \cdf{defstruct} behaves as if
it generates an appropriate \cdf{defsetf}
form for each access function.
\end{itemize}

This simple example illustrates the power of \cdf{defstruct} to provide
abstract record structures in a convenient manner.
\cdf{defstruct} has many other features as well for specialized purposes.

\section{How to Use Defstruct}

All structures are defined through the \cdf{defstruct} construct.
A call to \cdf{defstruct} defines a new data type whose instances
have named slots.

\begin{defmac}
defstruct name-and-options [doc-string] {slot-description}+

\begin{new}\noindent
X3J13 voted in June 1988
\issue{DEFSTRUCT-SLOTS-CONSTRAINTS-NUMBER}
to allow a \cdf{defstruct} definition
to have no \emph{slot-description} at all; in other words, the
occurrence of \Mplus{\emph{slot-description}} in the preceding
header line would be replaced by \Mstar{\emph{slot-description}}.

Such structure definitions are particularly useful if the
\cd{:include} option is used, perhaps with other options; for example,
one can have two structures that are exactly alike except that they
print differently (having different \cd{:print-function} options).

Implementors are encouraged to permit this simple extension as soon as
convenient.  Users, however, may wish to maximize portability of their
code by avoiding the use of this extension unless and until it is
adopted as part of the ANSI standard.
\end{new}

This defines a record-structure data type.
A general call to \cdf{defstruct} looks like the following example.
\begin{lisp}
(defstruct (\emph{name} \emph{option-1} \emph{option-2} ... \emph{option-m}) \\
~~~~~~~~~~~\emph{doc-string} \\
~~~~~~~~~~~\emph{slot-description-1} \\
~~~~~~~~~~~\emph{slot-description-2} \\
~~~~~~~~~~~... \\
~~~~~~~~~~~\emph{slot-description-n}) \\
\end{lisp}
The \emph{name} must be a symbol; it becomes the name of a new data type
consisting of all instances of the structure.
The function \cdf{typep} will accept and use this name
as appropriate.  The \emph{name} is returned as the value of the \emph{defstruct}
form.

Usually no options are needed at all.
If no options are specified, then one may write simply \emph{name} instead
of \cd{(\emph{name})} after the word \cdf{defstruct}.  The syntax of options
and the options provided are discussed in section~\ref{DEFSTRUCT-OPTIONS}.

If the optional documentation string \emph{doc-string} is present,
then it is attached to the \emph{name}
as a documentation string of type \cdf{structure}; see \cdf{documentation}.

Each \emph{slot-description-j} is of the form
\begin{lisp}
(\emph{slot-name} \emph{default-init} \\
~~~~~\emph{slot-option-name-1} \emph{slot-option-value-1} \\
~~~~~\emph{slot-option-name-2} \emph{slot-option-value-2} \\
~~~~~... \\
~~~~~\emph{slot-option-name-k${}_{j}$} \emph{slot-option-value-k${}_{j}$})
\end{lisp}
Each \emph{slot-name} must be a symbol; an access function is defined
for each slot. If no options and no \emph{default-init} are specified,
then one may write simply \emph{slot-name} instead of \cd{(\emph{slot-name})}
as the slot description.

\emph{default-init} form is evaluated only if the corresponding
argument is not supplied to the constructor function. 
The \emph{default-init} is a form that is
evaluated \emph{each time} its value
is to be used as the initial value of the slot.

If no \emph{default-init}
is specified, then the initial contents of the slot are undefined
and implementation-dependent.  The available slot-options are
described in section~\ref{Defstruct-Slot-Options}.

\begin{new}
X3J13 voted in January 1989
\issue{DEFSTRUCT-SLOTS-CONSTRAINTS-NAME}
to specify that it is an error for
two slots to have the same name; more precisely, no two slots may
have names for whose print names \cdf{string=} would be true.
Under this interpretation
\begin{lisp}
(defstruct lotsa-slots slot slot)
\end{lisp}
obviously is incorrect
but the following one is also in error, even assuming that the symbols
\cd{coin:slot} and \cd{blot:slot} really are distinct (non-\cdf{eql}) symbols:
\begin{lisp}
(defstruct no-dice coin:slot blot:slot)
\end{lisp}
To illustrate another case, the first \cdf{defstruct} form below is
correct, but the second one is in error.
\begin{lisp}
(defstruct one-slot slot) \\*
(defstruct (two-slots (:include one-slot)) slot)
\end{lisp}

\beforenoterule
\begin{rationale}
Print names are the criterion for slot-names being the same, rather
than the symbols themselves, because \cdf{defstruct} constructs names
of accessor functions from the print names and interns the resulting
new names in the current package.
\end{rationale}
\afternoterule

X3J13 recommended that expanding
a \cdf{defstruct} form violating this
restriction should signal an error and noted, with an eye to the Common Lisp
Object System
\issue{CLOS}, that the restriction applies only to the operation of the
\cdf{defstruct} macro as such and not to the \cdf{structure-class} or
structures defined with \cdf{defclass}.
\end{new}

\begin{newer}
X3J13 voted in March 1989 \issue{DEFINING-MACROS-NON-TOP-LEVEL}
to clarify that, while defining forms normally appear at top level,
it is meaningful to place them in non-top-level contexts;
\cdf{defstruct} must treat slot \emph{default-init} forms
and any\vadjust{\penalty-10000}
initialization forms within the specification of a by-position
constructor function as occurring
within the enclosing lexical environment, not within the global
environment.
\end{newer}

\cdf{defstruct} not only defines an access function for each slot, but also
arranges for \cdf{setf} to work properly on such access functions,
defines a predicate named \cd{\emph{name}-p},
defines a constructor function named \cd{make-\emph{name}},
and defines a copier function named \cd{copy-\emph{name}}.
All names of automatically created functions are interned
in whatever package is current at the time the \cdf{defstruct}
form is processed (see \cdf{*package*}).
Also, all such functions may be declared \cdf{inline}
at the discretion of the implementation to improve efficiency;
if you do not want some function declared \cdf{inline},
follow the \cdf{defstruct} form with a \cdf{notinline} declaration
to override any automatic \cdf{inline} declaration.

\begin{newer}
X3J13 voted in January 1989 \issue{DEFSTRUCT-REDEFINITION}
to specify that the results of redefining a \cdf{defstruct} structure
(that is, evaluating more than one \cdf{defstruct} structure
for the same name) are undefined.

The problem is that if instances have been created under the old definition
and then remain accessible after the new definition has been evaluated,
the accessors and other functions for the new definition may be incompatible
with the old instances.  Conversely, functions associated with the
old definition may have been declared \cdf{inline} and compiled
into code that remains accessible after the new definition has been
evaluated; such code may be incompatible with the new instances.

In practice this restriction affects the development
and debugging process rather than production runs of fully developed code.
The \cdf{defstruct} feature is intended to provide
``the most efficient'' structure class.
CLOS classes defined by \cdf{defclass}
allow much more flexible structures to be defined and redefined.

Programming environments are allowed and encouraged to permit \cdf{defstruct}
redefinition, perhaps with warning messages about possible interactions
with other parts of the programming environment or memory state.
It is beyond the scope of the Common Lisp
language standard to define those interactions except to note that they
are not portable.
\end{newer}
\end{defmac}

\section{Using the Automatically Defined Constructor Function}

After you have defined a new structure with \cdf{defstruct}, you can
create instances of this structure by using the constructor function.
By default, \cdf{defstruct} defines this function automatically.
For a structure named \cdf{foo}, the constructor function is normally
named \cdf{make-foo};
you can specify a different name
by giving it as the argument to the
\cd{:constructor} option, or specify that you don't
want a normal
constructor function at all by using {\false} as the argument
(in which case one or more ``by-position'' constructors should be
requested; see section~\ref{DEFSTRUCT-CONSTRUCTOR-SYNTAX}).

A call to a constructor function, in general, has the form
\begin{lisp}
(\emph{name-of-constructor-function} \\*
~~~~~~~~\emph{slot-keyword-1} \emph{form-1} \\*
~~~~~~~~\emph{slot-keyword-2} \emph{form-2} \\*
~~~~~~~~...)
\end{lisp}
All arguments are keyword arguments.  Each \emph{slot-keyword} should be a
keyword whose name matches the name of a slot of the structure
(\cdf{defstruct} determines the possible keywords simply by interning each
slot-name in the keyword package).  All the \emph{keywords} and \emph{forms}
are evaluated.  In short, it is just as if the constructor function
took all its arguments as \cd{\&key} parameters.  For example, the
\cdf{ship} structure shown in section~\ref{DEFSTRUCT-INTRO-SECTION}
has a constructor function that takes arguments roughly as if its definition
were
\begin{lisp}
(defun make-ship (\&key x-position y-position \\
~~~~~~~~~~~~~~~~~~~~~~~x-velocity y-velocity mass) \\
~~...)
\end{lisp}

\label{defstruct-initialization}
If \emph{slot-keyword-j} names a slot, then that element of
the created structure will be initialized to the value of \emph{form-j}.
If no pair \emph{slot-keyword-j} and \emph{form-j}
is present for a given slot, then the slot will be
initialized by evaluating the \emph{default-init} form specified
for that slot in the call to \cdf{defstruct}.
(In other words, the initialization specified in the \cdf{defstruct}
defers to any specified in a call to the constructor function.)
If the default initialization form is used, it is evaluated
at construction time, but
in the lexical environment of the \cdf{defstruct} form in which it appeared.
If the \cdf{defstruct} itself also did not
specify any initialization, the element's initial value is undefined.
You should always specify the initialization, either in the \cdf{defstruct}
or in the call to the constructor function,
if you care about the initial value of the slot.

Each initialization form specified for a \cdf{defstruct} component,
when used by the constructor function for an otherwise unspecified
component, is re-evaluated on every call to the
constructor function.  It is as if the initialization forms were
used as \emph{init} forms for the keyword parameters of the
constructor function.
For example, if the form \cd{(gensym)}
were used as an initialization form,
either in the constructor-function call or as the default initialization form
in the \cdf{defstruct} form,
then every call to the constructor
function would call \cdf{gensym} once to generate a new symbol.

\begin{newer}
X3J13 voted in October 1988 \issue{DEFSTRUCT-DEFAULT-VALUE-EVALUATION}
to clarify that the default value in a defstruct slot is not evaluated 
        unless it is needed in the creation of a particular structure
        instance.  If it is never needed, there can be no type-mismatch
        error, even if the type of the slot is specified, and no warning
        should be issued.


For example, in the following sequence only the last form is in error.
\begin{lisp}
(defstruct person (name .007 :type string)) \\*
\\*
(make-person :name "James") \\*
\\*
(make-person)~~~~~;\textrm{Error to give \cdf{name} the value \cd{.007}}
\end{lisp}
\end{newer}


\section{Defstruct Slot-Options}
\label{Defstruct-Slot-Options}

Each \emph{slot-description} in a \cdf{defstruct} form may specify one or more
slot-options.  A slot-option consists of a pair of a keyword and
a value (which is not a form to be evaluated, but the value itself).
For example:
\begin{lisp}
(defstruct ship \\
~~(x-position 0.0 \cd{:type} short-float) \\
~~(y-position 0.0 \cd{:type} short-float) \\
~~(x-velocity 0.0 \cd{:type} short-float) \\
~~(y-velocity 0.0 \cd{:type} short-float) \\
~~(mass *default-ship-mass* \cd{:type} short-float \cd{:read-only} t))
\end{lisp}
This specifies that each slot will always contain a
short-format floating-point number,
and that the last slot may not be altered once a ship is constructed.

The available slot-options are as follows.
\begin{flushdesc}
\item[\cd{:type}]
The option \cd{\cd{:type} \emph{type}} specifies that the contents of the
slot will always be of the specified data type.  This is entirely
analogous to the declaration of a variable or function; indeed, it
effectively declares the result type of the access function.  An
implementation may or may not choose to check the type of the new object
when initializing or assigning to a slot.
Note that the argument form \emph{type} is not evaluated;
it must be a valid type specifier.

\item[\cd{:read-only}]
The option \cd{\cd{:read-only} \emph{x}}, where \emph{x} is not {\false},
specifies that this slot may not be
altered; it will always contain the value specified at construction time.
\cdf{setf} will not accept the access function for this slot.
If \emph{x} is {\false}, this slot-option has no effect.
Note that the argument form \emph{x} is not evaluated.
\end{flushdesc}

Note that it is impossible to specify a slot-option unless
a default value is specified first.

\section{Defstruct Options}
\label{DEFSTRUCT-OPTIONS}
\label{Defstruct-Hairy-Stuff}

The preceding description of \cdf{defstruct} is all that the average
user will need (or want) to know in order to use structures.
The remainder of this chapter discusses more complex features of
the \cdf{defstruct} facility.

This section explains each of the options that can be given to \cdf{defstruct}.
A \cdf{defstruct} option may be either a keyword
or a list of a keyword and arguments for that keyword.
(Note that the syntax for \cdf{defstruct} options differs from
the pair syntax used for slot-options.  No part of any of these options
is evaluated.)

\begin{flushdesc}
\item[\cd{:conc-name}]
This provides for automatic prefixing of names of access functions.
It is conventional to begin the names of all the access functions of
a structure with a specific prefix,
the name of the structure followed by a hyphen.
This is the default behavior.

The argument to the \cd{:conc-name} option specifies an alternative
prefix to be used.  (If a hyphen is to be used as a separator,
it must be specified as part of the prefix.)
If {\false} is specified as an argument, then \emph{no} prefix is used;
then the names of the access functions
are the same as the slot-names, and it is up to the user
to name the slots reasonably.

Note that no matter what is specified for \cd{:conc-name},
with a constructor function one uses
slot keywords that match the slot-names, with no prefix attached.
On the other hand, one uses the access-function name
when using \cdf{setf}.  Here is an example:
\begin{lisp}
(defstruct door knob-color width material) \\
(setq my-door \\
~~~~~~(make-door :knob-color 'red :width 5.0)) \\
(door-width my-door) \EV\ 5.0 \\
(setf (door-width my-door) 43.7) \\
(door-width my-door) \EV\ 43.7 \\
(door-knob-color my-door) \EV\ red
\end{lisp}

\item[\cd{:constructor}]
This option takes one argument, a symbol,
which specifies the name of the constructor
function.  If the argument is not provided or if the option itself is not
provided, the name of the constructor is produced by concatenating the
string \cd{"MAKE-"} and the name of the structure, putting the name
in whatever package is current at the time the \cdf{defstruct}
form is processed (see \cdf{*package*}).
If the argument is
provided and is {\false}, no constructor function is defined.

This option actually has a more general syntax that is explained
in section~\ref{DEFSTRUCT-CONSTRUCTOR-SYNTAX}.

\item[\cd{:copier}]
This option takes one argument, a symbol,
which specifies the name of the copier
function.  If the argument is not provided or if the option itself is not
provided, the name of the copier is produced by concatenating the
string \cd{"COPY-"} and the name of the structure, putting the name
in whatever package is current at the time the \cdf{defstruct}
form is processed (see \cdf{*package*}).
If the argument is provided and is {\false}, no copier function is defined.

The automatically defined copier function simply makes a new structure
and transfers all components verbatim from the argument into the
newly created structure.  No attempt is made to make copies
of the components.  Corresponding components of the old and
new structures will therefore be \cdf{eql}.

\item[\cd{:predicate}]
This option takes one argument, which specifies the name of the type predicate.
If the argument is not provided or if the option itself is not
provided, the name of the predicate is made by concatenating the
name of the structure to the string \cd{"-P"}, putting the name
in whatever package is current at the time the \cdf{defstruct}
form is processed (see \cdf{*package*}).
If the argument is
provided and is {\false}, no predicate is defined.  A predicate can be defined
only if the structure is ``named'';
if the \cd{:type} option is specified
and the \cd{:named} option is
not specified, then the \cd{:predicate} option must either be unspecified
or have the value {\false}.

\item[\cd{:include}]
This option is used for building a new structure definition as
an extension of an old structure definition.  As an example,
suppose you have a structure called \cdf{person} that looks like this:
\begin{lisp}
(defstruct person name age sex)
\end{lisp}
Now suppose you want to make a new structure to represent an astronaut.
Since astronauts are people too, you would like them also to have the
attributes of name, age, and sex, and you would like Lisp functions
that operate on \cdf{person} structures to operate just as well on
\cdf{astronaut} structures.  You can do this by defining \cdf{astronaut}
with the \cd{:include} option, as follows:
\begin{lisp}
(defstruct (astronaut (:include person) \\
~~~~~~~~~~~~~~~~~~~~~~(:conc-name astro-)) \\
~~~helmet-size \\
~~~(favorite-beverage 'tang))
\end{lisp}

The \cd{:include} option causes the structure being defined
to have the same slots as the included structure.
This is done in such a way
that the access functions for the included
structure will also work on the structure being defined.
In this example, an
\cdf{astronaut} will therefore have five slots: the three defined in
\cdf{person} and the two defined in \cdf{astronaut}
itself.  The access functions defined by the \cdf{person} structure
can be applied to instances of the \cdf{astronaut} structure, and they
will work correctly.
Moreover, \cdf{astronaut} will have its own access functions for
components defined by the \cdf{person} structure.
The following examples illustrate how you can
use \cdf{astronaut} structures:
\begin{lisp}
(setq x (make-astronaut :name 'buzz \\
~~~~~~~~~~~~~~~~~~~~~~~~:age 45 \\
~~~~~~~~~~~~~~~~~~~~~~~~:sex t \\
~~~~~~~~~~~~~~~~~~~~~~~~:helmet-size 17.5)) \\
 \\
(person-name x) \EV\ buzz \\
(astro-name x) \EV\ buzz \\
\\
(astro-favorite-beverage x) \EV\ tang
\end{lisp}
The difference between the access functions \cdf{person-name} and \cdf{astro-name}
is that \cdf{person-name} may be correctly applied to any \cdf{person},
including an \cdf{astronaut}, while \cdf{astro-name} may be correctly
applied only to an \cdf{astronaut}.  (An implementation may or may not
check for incorrect use of access functions.)

At most one \cd{:include} option may be specified in a single
\cdf{defstruct} form.
The argument to the \cd{:include} option is required and must be the
name of some previously defined structure.  If the structure being
defined has no \cd{:type} option, then the included structure must
also have had no \cd{:type} option specified for it.
If the structure being defined has a \cd{:type} option,
then the included structure must have been declared with a \cd{:type}
option specifying the same representation type.

If no \cd{:type} option is involved, then
the structure name of the including structure definition
becomes the name of a data type, of course, and therefore
a valid type specifier recognizable by \cdf{typep}; moreover, it becomes
a subtype of the included structure.  In the above example,
\cdf{astronaut} is a subtype of \cdf{person}; hence
\begin{lisp}
(typep (make-astronaut) 'person)
\end{lisp}
is true, indicating that all operations on persons will also
work on astronauts.

The following is an advanced feature of the \cd{:include} option.
Sometimes, when one structure includes another, the default values or
slot-options for the slots that came from the included structure are not
what you want.  The new structure can specify default values or
slot-options for the included slots different from those the included
structure specifies, by giving the \cd{:include} option as
\begin{lisp}
(:include \emph{name} \emph{slot-description-1} \emph{slot-description-2} ...)
\end{lisp}
Each \emph{slot-description-j} must have a \emph{slot-name} or \emph{slot-keyword} that is the same
as that of some slot in the included structure.
If \emph{slot-description-j} has no \emph{default-init},
then in the new structure the slot will have no initial
value.  Otherwise its initial value form will be replaced by
the \emph{default-init} in \emph{slot-description-j}.
A normally writable slot may be made read-only.
If a slot is read-only in the included structure, then it
must also be so in the including structure.
If a type is specified for a slot, it must be the same as, or a subtype of, the
type specified in the included structure.  If it is a strict subtype,
the implementation may or may not choose to error-check assignments.

For example, if we had wanted to define \cdf{astronaut} so that the
default age for an astronaut is \cd{45}, then we could have said:
\begin{lisp}
(defstruct (astronaut (:include person (age 45))) \\
~~~helmet-size \\
~~~(favorite-beverage 'tang))
\end{lisp}

\begin{new}
X3J13 voted in June 1988
\issue{DATA-TYPES-HIERARCHY-UNDERSPECIFIED}
to require any structure type created by \cdf{defstruct}
(or \cdf{defclass}) to be disjoint from any of the types
\cdf{cons}, \cdf{symbol}, \cdf{array}, \cdf{number}, \cdf{character},
\cdf{hash-table}, \cdf{readtable}, \cdf{package}, \cdf{pathname},
\cdf{stream}, and \cdf{random-state}.  A consequence of this requirement
is that it is an error to specify any of these types, or any of their
subtypes, to the \cdf{defstruct} \cd{:include} option.
(The first edition said nothing explicitly about this.
Inasmuch as using such a type with the \cd{:include} option was
not defined to work, one might argue that such use was an error
in Common Lisp as defined by the first edition.)
\end{new}

\item[\cd{:print-function}]
This option may be used only if the \cd{:type}
option is not specified.
The argument to the \cd{:print-function} option
should be a function of three arguments,
in a form acceptable to the \cdf{function} special operator,
to be used to print structures of this type.
When a structure of this type is to be printed, the function
is called on three arguments:
the structure to be printed, a stream to print to,
and an integer indicating the current depth (to be compared against
\cdf{*print-level*}).
The printing function should observe the values of
such printer-control variables as \cdf{*print-escape*}
and \cdf{*print-pretty*}.

If the \cd{:print-function} option is not specified and the \cd{:type}
option also not specified, then a default printing function is
provided for the structure that will print out all its slots
using \cd{\#S} syntax (see section~\ref{SHARP-SIGN-MACRO-CHARACTER-SECTION}).

\begin{new}
X3J13 voted in January 1989
\issue{PRINT-CIRCLE-STRUCTURE}
to specify that user-defined printing functions for the \cdf{defstruct}
\cd{:print-function} option may print objects to the
supplied stream using \cdf{write}, \cd{print1}, \cdf{princ}, \cdf{format},
or \cdf{print-object} and expect circularities to be detected and printed
using \cd{\#\emph{n\/}\#} syntax (when \cdf{*print-circle*} is non-\cdf{nil}, of course).
See \cdf{*print-circle*}.
\end{new}


\begin{new}
X3J13 voted in January 1989
\issue{DEFSTRUCT-PRINT-FUNCTION-INHERITANCE}
to clarify that if the \cd{:print-function}
option is not specified but the \cd{:include} option \emph{is} specified,
then the print function is inherited from the included structure type.
Thus, for example, an \cdf{astronaut} will be printed by the same
printing function that is used for \cdf{person}.

X3J13 in the same vote extended the \cdf{print-function} option
as follows: If the \cdf{print-function} option is specified but with
no argument, then the standard default printing function (that uses
\cd{\#S} syntax) will be used.  This provides a means of overriding the
inheritance rule.  For example, if \cdf{person} and \cdf{astronaut}
had been defined as
\begin{lisp}
(defstruct (person \\*
~~~~~~~~~~~~~(:print-function~~~~~;\textrm{Special print function}\\*
~~~~~~~~~~~~~(lambda (p s k) \\*
~~~~~~~~~~~~~~~(format s "<{\Xtilde}A, age {\Xtilde}D>" \\*
~~~~~~~~~~~~~~~~~~~~~~~(person-name p) \\*
~~~~~~~~~~~~~~~~~~~~~~~(person-age p))))) \\*
~~name age sex) \\
\\
(defstruct (astronaut \\*
~~~~~~~~~~~~~(:include person) \\*
~~~~~~~~~~~~~(:conc-name astro-) \\*
~~~~~~~~~~~~~(:print-function))~~~~~;\textrm{Use default print function} \\*
~~~helmet-size \\*
~~~(favorite-beverage 'tang))
\end{lisp}
then an ordinary person would be printed as ``\cd{<Joe Schmoe, age 27>}''
but an astronaut would be printed as, for example,
\begin{lisp}
\#S(ASTRONAUT NAME BUZZ AGE 45 SEX T \\*
~~~HELMET-SIZE 17.5 FAVORITE-BEVERAGE TANG)
\end{lisp}
using the default \cd{\#S} syntax (yuk).

These changes make the behavior of \cdf{defstruct} with respect to the
\cd{:include} option a bit more like the behavior of classes in CLOS.
\end{new}

\item[\cd{:type}]
The \cd{:type} option explicitly specifies the representation to be used for
the structure.  It takes one argument, which must
be one of the types enumerated below.

Specifying this option has the effect of forcing
a specific representation and of forcing the components to be
stored in the order specified in the \cdf{defstruct} form
in corresponding successive elements of the specified representation.
It also \emph{prevents} the structure name from becoming a valid
type specifier recognizable by \cdf{typep}
(see section~\ref{EXPLICIT-TYPE-STRUCTURES}).

Normally this option is not specified, in which case the structure
is represented in an implementation-dependent manner.

\begin{quotation}    % Merely to advance the left margin
\begin{flushdesc}
\item[\cdf{vector}]
This produces the same result as specifying \cd{(vector t)}.
The structure is represented
as a general vector, storing components as vector elements.
The first component is vector
element 1 if the structure is \cd{:named}, and element 0 otherwise.

\item[\cd{(vector \emph{element-type})}]
The structure is represented as a (possibly specialized) vector, storing
components as vector elements.  Every component must be of a type that can be
stored in a vector of the type specified.  The first component is vector
element 1 if the structure is \cd{:named}, and element 0 otherwise.
The structure may be \cd{:named} only if the type \cdf{symbol} is a subtype of
the specified \cdf{element-type}.

\item[\cdf{list}]
The structure is represented as a list.
The first component is the \emph{cadr}
if the structure is \cd{:named}, and the \emph{car} if
it is \cd{:unnamed}.
\end{flushdesc}
\end{quotation}

\item[\cd{:named}]
The \cd{:named} option specifies that the structure is ``named''; this
option takes no argument.  If no \cd{:type} option is specified,
then the structure is always named; so this option is useful only in
conjunction with the \cd{:type} option.
See section~\ref{EXPLICIT-TYPE-STRUCTURES} for a further description of this
option.

\item[\cd{:initial-offset}]
This allows you to tell \cdf{defstruct} to skip over a certain
number of slots before it starts allocating the slots described in the
body.  This option requires an argument,
a non-negative integer,
which is the number of slots you want \cdf{defstruct} to skip.
The \cd{:initial-offset} option may be used only if the
\cd{:type} option is also specified.
See section~\ref{DEFSTRUCT-INITIAL-OFFSET} for a further description
of this option.
\end{flushdesc}

\section{By-Position Constructor Functions}
\label{DEFSTRUCT-CONSTRUCTOR-SYNTAX}

If the \cd{:constructor} option is given as
\cd{(\cd{:constructor} \emph{name} \emph{arglist})},
then instead of making a keyword-driven constructor function,
\cdf{defstruct} defines a ``positional'' constructor function,
taking arguments whose meaning is determined by the argument's position
rather than by a keyword.
The \emph{arglist} is used to describe what the arguments to the
constructor will be.  In the simplest case something like
\cd{(\cd{:constructor} make-foo (a b c))} defines \cdf{make-foo} to be
a three-argument constructor function whose arguments are used to initialize the
slots named \cdf{a}, \cdf{b}, and \cdf{c}.

In addition, the keywords \cd{\&optional}, \cd{\&rest}, and \cd{\&aux} are
recognized in the argument list.  They work in the way you might expect,
but there are a few fine points worthy of explanation.
Consider this example:
\begin{lisp}
(\cd{:constructor} create-foo \\
~~~~~~~~(a \&optional b (c 'sea) \&rest d \&aux e (f 'eff)))
\end{lisp}
This defines \cdf{create-foo} to be a constructor of one or more arguments.
The first argument is used to initialize the \cdf{a} slot.  The second
argument is used to initialize the \cdf{b} slot.  If there isn't any
second argument, then the default value given in the body of the
\cdf{defstruct} (if given) is used instead.  The third argument is used to
initialize the \cdf{c} slot.  If there isn't any third argument, then the
symbol \cdf{sea} is used instead.  Any arguments following the third
argument are collected into a list and used to initialize the \cdf{d}
slot.  If there are three or fewer arguments, then {\false} is placed in
the \cdf{d} slot.  The \cdf{e} slot \emph{is not initialized}; its initial
value is undefined.  Finally, the \cdf{f} slot is initialized to contain
the symbol \cdf{eff}.

The actions taken in the \cdf{b} and \cdf{e} cases were carefully
chosen to allow the user to specify all possible behaviors.  Note that
the \cd{\&aux} ``variables'' can be used to completely override the default
initializations given in the body.

With this definition, one can write
\begin{lisp}
(create-foo 1 2)
\end{lisp}
instead of
\begin{lisp}
(make-foo \cd{:a} 1 \cd{:b} 2)
\end{lisp}
and of course \cdf{create-foo} provides defaulting different
from that of \cdf{make-foo}.

It is permissible to use the
\cd{:constructor} option more than once, so that you can define several
different constructor functions, each taking different parameters.

Because a constructor of this type operates By Order of Arguments,
it is sometimes known as a BOA constructor.

\begin{new}
X3J13 voted in January 1989
\issue{DEFSTRUCT-CONSTRUCTOR-KEY-MIXTURE}
to allow \cd{\&key} and \cd{\&allow-other-keys}
in the
parameter list of a ``positional'' constructor.  The initialization of slots
corresponding to keyword parameters
is performed in the same manner as for \cd{\&optional} parameters.
A variant of the example shown above illustrates this:
\begin{lisp}
(\cd{:constructor} create-foo \\*
~~~~~~~~(a \&optional b (c 'sea) \\*
~~~~~~~~~\&key p (q 'cue) ((:why y)) ((:you u) 'ewe) \\*
~~~~~~~~~\&aux e (f 'eff)))
\end{lisp}
The treatment of slots \cdf{a}, \cdf{b}, \cdf{c}, \cdf{e}, and \cdf{f}
is the same as in the original example.  In addition,
if there is a \cd{:p} keyword argument, it is
used to initialize the \cdf{p} slot;  if there isn't any
\cd{:p} keyword argument, then the default value given in the body of the
\cdf{defstruct} (if given) is used instead.  Similarly,
if there is a \cd{:q} keyword argument, it is
used to initialize the \cdf{q} slot;  if there isn't any
\cd{:q} keyword argument, then
the symbol \cdf{cue} is used instead.

In order thoroughly to flog this presumably already dead horse,
we further observe that if there is a \cd{:why} keyword argument, it is
used to initialize the \cdf{y} slot; otherwise
the default value for slot \cdf{y} is used instead.  Similarly,
if there is a \cd{:you} keyword argument, it is
used to initialize the \cdf{u} slot;  otherwise
the symbol \cdf{ewe} is used instead.

If memory serves me correctly, \cdf{defstruct} was included in the original
design for Common Lisp some time before keyword arguments were approved.
The failure of positional constructors to accept keyword arguments may well
have been an oversight on my part; there is no logical reason to exclude
them.  I am grateful to X3J13 for rectifying this.

A remaining difficulty is that the possibility of keyword arguments
renders the term ``positional constructor'' a misnomer.  Worse yet,
it ruins the term ``BOA constructor.''  I suggest that
they continue to be called BOA constructors, as I refuse to abandon
a good pun.  (I regret appearing to have more compassion for puns than
for horses.)

As part of the same vote X3J13 also changed \cdf{defstruct}
to allow BOA constructors to have
parameters (including supplied-p parameters)
that do not correspond to any
slot.  Such parameters may be used in subsequent initialization forms in the
parameter list. Consider this example:
\begin{lisp}
(defstruct (ice-cream-factory \\*
~~~~~~~~~~~~~(:constructor fabricate-factory \\*
~~~~~~~~~~~~~~~(\&key (capacity 5) \\*
~~~~~~~~~~~~~~~~~~~~~~location \\
~~~~~~~~~~~~~~~~~~~~~~(local-flavors \\*
~~~~~~~~~~~~~~~~~~~~~~~~(case location \\*
~~~~~~~~~~~~~~~~~~~~~~~~~~((hawaii) '(pineapple macadamia guava)) \\*
~~~~~~~~~~~~~~~~~~~~~~~~~~((massachusetts) '(lobster baked-bean)) \\*
~~~~~~~~~~~~~~~~~~~~~~~~~~((california) '(ginger lotus avocado \\*
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~bean-sprout garlic)) \\*
~~~~~~~~~~~~~~~~~~~~~~~~~~((texas) '(jalapeno barbecue)))) \\
~~~~~~~~~~~~~~~~~~~~~~(flavors (subseq (append local-flavors \\*
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~'(vanilla \\*
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~chocolate \\*
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~strawberry \\
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~pistachio \\
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~maple-walnut \\*
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~peppermint)) \\*
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~0 capacity))))) \\*
~~(capacity 3) \\*
~~(flavors '(vanilla chocolate strawberry mango)))
\end{lisp}

The structure type \cdf{ice-cream-factory} has two constructors.
The standard constructor, \cdf{make-ice-cream-factory},
takes two keyword arguments named \cd{:capacity} and \cd{:flavors}.
For this constructor, the default for the \cdf{capacity} slot is \cd{3}
and the default list of \cdf{flavors} is America's favorite threesome
and a dark horse (not a dead one).
The BOA constructor \cdf{fabricate-factory}
accepts four different keyword arguments.  The \cd{:capacity}
argument defaults to \cd{5}, and the \cd{:flavors} argument
defaults in a complicated manner based on the other three.
The \cd{:local-flavors} argument may be specified directly,
or may be allowed to default based on the \cd{:location} of the factory.
Here are examples of various factories:

\vskip0pt plus 2pt%manual
\begin{lisp}
(setq houston (fabricate-factory :capacity 4 :location 'texas)) \\*
(setq cambridge (fabricate-factory :location 'massachusetts)) \\
(setq seattle (fabricate-factory :local-flavors '(salmon))) \\
(setq wheaton (fabricate-factory :capacity 4 :location 'illinois)) \\*
(setq pittsburgh (fabricate-factory :capacity 4)) \\*
(setq cleveland (make-factory :capacity 4)) \\
 \\
(ice-cream-factory-flavors houston) \\*
~\EV~(jalapeno barbecue vanilla chocolate)
\end{lisp}
\newpage%manual
\begin{lisp}
(ice-cream-factory-flavors cambridge) \\*
~\EV~(lobster baked-bean vanilla chocolate strawberry) \\
\\
(ice-cream-factory-flavors seattle) \\*
~\EV~(salmon vanilla chocolate strawberry pistachio) \\
\\
(ice-cream-factory-flavors wheaton) \\*
~\EV~(vanilla chocolate strawberry pistachio) \\
\\
(ice-cream-factory-flavors pittsburgh) \\*
~\EV~(vanilla chocolate strawberry pistachio) \\
\\
(ice-cream-factory-flavors cleveland) \\*
~\EV~(vanilla chocolate strawberry mango)
\end{lisp}
\end{new}


\section{Structures of Explicitly Specified Representational Type}
\label{EXPLICIT-TYPE-STRUCTURES}

Sometimes it is important to have explicit control
over the representation of a structure.  The \cd{:type}
option allows one to specify that a structure must be implemented
in a particular way, using a list or a specific kind of vector,
and to specify the exact allocation of structure slots to
components of the representation.
A structure may also be ``unnamed'' or ``named,'' according to whether
the structure name is stored in (and thus recoverable from) the structure.

\subsection{Unnamed Structures}

Sometimes a particular data representation is imposed by external requirements,
and yet it is desirable to document the data format as a \cdf{defstruct}-style
structure.  For example, consider expressions built up from numbers,
symbols, and binary operations such as \cdf{+} and \cdf{*}.  An operation
might be represented as it is in Lisp, as a list of the operator
and the two operands.  This fact can be expressed succinctly with \cdf{defstruct}
in this manner:
ะต\begin{lisp}
(defstruct (binop (:type list)) \\
~~(operator '? :type symbol) \\
~~operand-1 \\
~~operand-2)
\end{lisp}
This will define a constructor function \cdf{make-binop} and three
selector functions, namely \cdf{binop-operator}, \cd{binop-operand-1},
and \cd{binop-operand-2}.  (It will \emph{not}, however, define a predicate
\cdf{binop-p}, for reasons explained below.)

The effect of \cdf{make-binop} is simply to construct a list of length 3:
\begin{lisp}
(make-binop :operator '+ :operand-1 'x :operand-2 5) \\*
~~~\EV\ (+ x 5) \\
\\
(make-binop :operand-2 4 :operator '*) \\*
~~~\EV\ (* {\nil} 4)
\end{lisp}
It is just like the function \cdf{list} except that it takes
keyword arguments and performs slot defaulting appropriate to the \cdf{binop}
conceptual data type.  Similarly, the selector functions
\cdf{binop-operator}, \cd{binop-operand-1},
and \cd{binop-operand-2} are essentially equivalent to \cdf{car},
\cdf{cadr}, and \cdf{caddr}, respectively.  (They might not be
completely equivalent because,
for example, an implementation would be justified in adding error-checking
code to ensure that the argument to each selector function is a length-3
list.)

We speak of \cdf{binop} as being a ``conceptual'' data type because \cdf{binop}
is not made a part of the Common Lisp type system.  The predicate
\cdf{typep} will not recognize \cdf{binop} as a type specifier, and \cdf{type-of}
will return \cdf{list} when given a \cdf{binop} structure.  Indeed, there is
no way to distinguish a data structure constructed by \cdf{make-binop}
from any other list that happens to have the correct structure.

There is not even any way to recover the structure name \cdf{binop} from
a structure created by \cdf{make-binop}.  This can be done, however,
if the structure is ``named.''

\subsection{Named Structures}

A ``named'' structure has the property that, given an instance of the
structure, the structure name (that names the type) can be reliably
recovered.  For structures defined
with no \cd{:type} option, the structure name actually becomes part
of the Common Lisp data-type system.  The function \cdf{type-of},
when applied to such a structure, will return the structure name
as the type of the object; the predicate \cdf{typep} will recognize
the structure name as a valid type specifier.

For structures defined with a \cd{:type} option, \cdf{type-of} will
return a type specifier such as \cdf{list} or \cd{(vector t)},
depending on the type specified to the \cd{:type} option.
The structure name does not become a valid type specifier.
However,
if the \cd{:named} option is also specified, then the first component
of the structure (as created by a \cdf{defstruct} constructor function)
will always contain the structure name.  This allows the structure name
to be recovered from an instance of the structure and allows a reasonable
predicate for the conceptual type to be defined:
the automatically defined
\cd{\emph{name}-p} predicate for the structure operates by first
checking that its argument is of the proper type (\cdf{list}, \cd{(vector t)},
or whatever) and then checking whether the first component contains
the appropriate type name.

Consider the \cdf{binop} example shown above, modified only to
include the \cd{:named} option:
\begin{lisp}
(defstruct (binop (:type list) :named) \\
~~(operator '? :type symbol) \\
~~operand-1 \\
~~operand-2)
\end{lisp}
As before, this will define a constructor function \cdf{make-binop} and three
selector functions \cdf{binop-operator}, \cd{binop-operand-1},
and \cd{binop-operand-2}.  It will also define a predicate \cdf{binop-p}.

The effect of \cdf{make-binop} is now to construct a list of length 4:
\begin{lisp}
(make-binop :operator '+ :operand-1 'x :operand-2 5) \\*
~~~\EV\ (binop + x 5) \\
\\
(make-binop :operand-2 4 :operator '*) \\*
~~~\EV\ (binop * {\nil} 4)
\end{lisp}
The structure has the same layout as before except that the structure name
\cdf{binop} is included as the first list element.
The selector functions
\cdf{binop-operator}, \cd{binop-operand-1},
and \cd{binop-operand-2} are essentially equivalent to \cdf{cadr},
\cdf{caddr}, and \cdf{cadddr}, respectively.
The predicate \cdf{binop-p} is more or less equivalent to the following
definition.
\begin{lisp}
(defun binop-p (x) \\
~~(and (consp x) (eq (car x) 'binop)))
\end{lisp}
The name \cdf{binop} is still not a valid type specifier recognizable
to \cdf{typep}, but at least there is a way of distinguishing \cdf{binop}
structures from other similarly defined structures.

\subsection{Other Aspects of Explicitly Specified Structures}
\label{DEFSTRUCT-INITIAL-OFFSET}

The \cd{:initial-offset} option allows one
to specify that slots be allocated beginning at a representational
element other than the first.  For example, the form
\begin{lisp}
(defstruct (binop (:type list) (:initial-offset 2)) \\*
~~(operator '? :type symbol) \\*
~~operand-1 \\*
~~operand-2)
\end{lisp}
would result in the following behavior for \cdf{make-binop}:
\begin{lisp}
(make-binop :operator '+ :operand-1 'x :operand-2 5) \\*
~~~\EV\ (nil nil + x 5) \\
\\
(make-binop :operand-2 4 :operator '*) \\*
~~~\EV\ (nil nil * {\nil} 4)
\end{lisp}
The selectors
\cdf{binop-operator}, \cd{binop-operand-1},
and \cd{binop-operand-2} would be essentially equivalent to \cdf{caddr},
\cdf{cadddr}, and \cdf{car} of \cdf{cddddr}, respectively.
Similarly, the form
\begin{lisp}
(defstruct (binop (:type list) :named (:initial-offset 2)) \\*
~~(operator '? :type symbol) \\*
~~operand-1 \\*
~~operand-2)
\end{lisp}
would result in the following behavior for \cdf{make-binop}:
\begin{lisp}
(make-binop :operator '+ :operand-1 'x :operand-2 5) \\*
~~~\EV\ (nil nil binop + x 5) \\
\\
(make-binop :operand-2 4 :operator '*) \\*
~~~\EV\ (nil nil binop * {\nil} 4)
\end{lisp}

If the \cd{:include} is used with the \cd{:type}
option, then the effect is first to skip over as many representation
elements as needed to represent the included structure, then to
skip over any additional elements specified by the \cd{:initial-offset}
option, and then to begin allocation of elements from that point.
For example:
\begin{lisp}
(defstruct (binop (:type list) :named (:initial-offset 2)) \\
~~(operator '? :type symbol) \\
~~operand-1 \\
~~operand-2) \\
 \\
(defstruct (annotated-binop (:type list) \\
~~~~~~~~~~~~~~~~~~~~~~~~~~~~(:initial-offset 3) \\
~~~~~~~~~~~~~~~~~~~~~~~~~~~~(:include binop)) \\
~~commutative associative identity) \\
 \\
(make-annotated-binop :operator '* \\
~~~~~~~~~~~~~~~~~~~~~~:operand-1 'x \\
~~~~~~~~~~~~~~~~~~~~~~:operand-2 5 \\
~~~~~~~~~~~~~~~~~~~~~~:commutative t \\
~~~~~~~~~~~~~~~~~~~~~~:associative t \\
~~~~~~~~~~~~~~~~~~~~~~:identity 1) \\
~~~\EV\ (nil nil binop * x 5 nil nil nil t t 1)
\end{lisp}
The first two {\nil} elements stem from the \cd{:initial-offset} of \cd{2}
in the definition of \cdf{binop}.  The next four elements contain the
structure name and three slots for \cdf{binop}.  The next three {\nil} elements
stem from the \cd{:initial-offset} of \cd{3} in the definition of
\cdf{annotated-binop}.  The last three list elements contain the additional
slots for an \cdf{annotated-binop}.

%RUSSIAN
\else

\chapter{ะกัััะบัััั}

Common Lisp ะฟัะตะดะพััะฐะฒะปัะตั ััะฝะบัะธะพะฝะฐะปัะฝะพััั ะดะปั ัะพะทะดะฐะฝะธั ััััะบััั (ะฟะพััะธ ัะฐะบะธั
ะถะต, ะบะฐะบ ะฒ ะดััะณะธั ัะทัะบะฐั, ั ะธะผะตะฝะตะผ ััััะบัััั, ะฟะพะปัะผะธ, ะธ ั.ะด.). ะคะฐะบัะธัะตัะบะธ,
ะฟะพะปัะทะพะฒะฐัะตะปั ะผะพะถะตั ะพะฟัะตะดะตะปะธัั ะฝะพะฒัะน ัะธะฟ ะดะฐะฝะฝัั.ะะฐะถะดะฐั ััััะบัััะฐ ะดะฐะฝะฝัั
ััะพะณะพ ัะธะฟะฐ ะธะผะตะตั ะบะพะผะฟะพะฝะตะฝัั ั ะทะฐะดะฐะฝะฝัะผะธ ะธะผะตะฝะฐะผะธ.
ะัะธ ัะพะทะดะฐะฝะธะธ ััััะบัััั ะฐะฒัะพะผะฐัะธัะตัะบะธ ัะพะทะดะฐัััั ะบะพะฝััััะบัะพั ะธ ะบะพะฝััััะบัะธะธ ะดะพัััะฟะฐ
ะธ ะฟัะธัะฒะฐะธะฒะฐะฝะธั ะทะฝะฐัะตะฝะธะน ะดะปั ะฟะพะปะตะน.

ะะฐะฝะฝะฐั ะณะปะฐะฒะฐ ัะฐะทะดะตะปะตะฝะฐ ะฝะฐ ะดะฒะต ัะฐััะธ. ะะตัะฒะฐั ัะฐััั ะพะฟะธััะฒะฐะตั ะพัะฝะพะฒะฝัั
ััะฝะบัะธะพะฝะฐะปัะฝะพััั ััััะบััั, ะบะพัะพัะฐั ะพัะตะฝั ะฟัะพััะฐ ะธ ะฟะพะทะฒะพะปัะตั ะฟะพะปัะทะพะฒะฐัะตะปั
ะฒะพัะฟะพะปัะทะพะฒะฐัััั ะฟัะพะฒะตัะบะพะน ัะธะฟะพะฒ, ะผะพะดัะปัะฝะพัััั ะธ ัะดะพะฑััะฒะพะผ ะพะฟัะตะดะตะปัะฝะฝัั ะธะผ ัะธะฟะพะฒ
ะดะฐะฝะฝัั. ะัะพัะฐั ัะฐััั ะฝะฐัะธะฝะฐะตััั ั ัะฐะทะดะตะปะฐ~\ref{Defstruct-Hairy-Stuff},
ะพะฟะธััะฒะฐััะตะณะพ ัะฟะตัะธะฐะปะธะทะธัะพะฒะฐะฝะฝัะต ะฒะพะทะผะพะถะฝะพััะธ ะดะปั ัะปะพะถะฝัั ะฟัะธะปะพะถะตะฝะธะน. ะญัะธ
ะฒะพะทะผะพะถะฝะพััะธ ัะพะฒะตััะตะฝะฝะพ ะฝะตะพะฑัะทะฐัะตะปัะฝั ะบ ะธัะฟะพะปัะทะพะฒะฐะฝะธั, ะธ ะฒะฐะผ ะดะฐะถะต ะฝะต ะฝัะถะฝะพ ะพ ะฝะธั
ะทะฝะฐัั ะดะปั ัะพะณะพ, ััะพะฑั ะดะตะปะฐัั ัะพัะพัะธะต ะฟัะพะณัะฐะผะผั.

\section{ะะฒะตะดะตะฝะธะต ะฒ ััััะบัััั}
\label{DEFSTRUCT-INTRO-SECTION}

ะคัะฝะบัะธะพะฝะฐะปัะฝะพััั ััััะบััั ะฒะพะฟะปะพัะตะฝะฐ ะฒ ะผะฐะบัะพัะต \cdf{defstruct}, ะบะพัะพััะน ะฟะพะทะฒะพะปัะตั
ะฟะพะปัะทะพะฒะฐัะตะปั ัะพะทะดะฐะฒะฐัั ะธ ะธัะฟะพะปัะทะพะฒะฐัั ัะณััะฟะฟะธัะพะฒะฐะฝะฝัะต ัะธะฟั ะดะฐะฝะฝัั ั ะธะผะตะฝะพะฒะฐะฝะฝัะผะธ
ัะปะตะผะตะฝัะฐะผะธ. ะะฝะฐ ะฟะพัะพะถะฐ ะฝะฐ ััะฝะบัะธะพะฝะฐะปัะฝะพััั <<ััััะบััั (structures)>> ะฒ {PL/I}
ะธะปะธ <<ะทะฐะฟะธัะตะน (records)>> ะฒ Pascal'ะต.

ะ ะบะฐัะตััะฒะต ะฟัะธะผะตัะฐ, ะฟัะตะดะฟะพะปะพะถะธะผ, ััะพ ะฒั ะฟะธัะตัะต ะฟัะพะณัะฐะผะผั ะฝะฐ Lisp'ะต, ะบะพัะพัะฐั
ัะฟัะฐะฒะปัะตั ะบะพัะผะธัะตัะบะธะผะธ ะบะพัะฐะฑะปัะผะธ ะฒ ะดะฒััะผะตัะฝะพะผ ะฟัะพัััะฐะฝััะฒะต.
ะ ะฒะฐัะตะน ะฟัะพะณัะฐะผะผะต, ะฒะฐะผ ะฝะตะพะฑัะพะดะธะผะพ ะฟัะตะดััะฐะฒะธัั ะบะพัะผะธัะตัะบะธะน ะบะพัะฐะฑะปั ะบะฐะบ ะฝะตะบะพัะพัะพะณะพ
ะฒะธะดะฐ Lisp'ะพะฒัะน ะพะฑัะตะบั. ะะฝัะตัะตััััะธะต ะฒะฐัั ะฟัะพะณัะฐะผะผั ัะฒะพะนััะฒะฐ ะบะพัะฐะฑะปั ัะฒะปััััั: ะตะณะพ
ะฟะพะทะธัะธั (ะฟัะตะดััะฐะฒะปะตะฝะฝะฐั ะบะฐะบ \emph{x} ะธ \emph{y} ะบะพะพัะดะธะฝะฐัั), ัะบะพัะพััั
(ะฟัะตะดััะฐะฒะปะตะฝะฝะฐั ะบะฐะบ ะพััะตะทะบะธ ะฟะพ ะพััะผ \emph{x} ะธ \emph{y}) ะธ ะผะฐััะฐ.

ะขะฐะบะธะผ ะพะฑัะฐะทะพะผ, ะบะพัะฐะฑะปั ะผะพะถะตั ะฑััั ะฟัะตะดััะฐะฒะปะตะฝ ะบะฐะบ ะทะฐะฟะธัั ััััะบัััั ั ะฟัััั
ะบะพะผะฟะพะฝะตะฝัะฐะผะธ: ะฟะพะทะธัะธั-\emph{x}, ะฟะพะทะธัะธั-\emph{y}, ัะบะพัะพััั-\emph{x},
ัะบะพัะพััั-\emph{y} ะธ ะผะฐััะฐ.
ะญัะฐ ััััะบัััะฐ ะผะพะถะตั ะฑััั ัะตะฐะปะธะทะพะฒะฐะฝะฐ ะบะฐะบ Lisp'ะพะฒัะน ะพะฑัะตะบั ะฝะตัะบะพะปัะบะธะผะธ ัะฟะพัะพะฑะฐะผะธ.
ะะฝะฐ ะผะพะถะตั ะฑััั ัะฟะธัะบะพะผ ะธะท ะฟััะธ ัะปะตะผะตะฝัะพะฒ; ะฟะพะทะธัะธั-\emph{x} ะฑัะดะตั \emph{car}
ัะปะตะผะตะฝัะพะผ, ะฟะพะทะธัะธั-\emph{y} ะฑัะดะตั \emph{cadr}, ะธ ัะฐะบ ะดะฐะปะตะต. ะะพะดะพะฑะฝัะผ ะพะฑัะฐะทะพะผ
ััััะบัััะฐ ะผะพะถะตั ะฑััั ะฒะตะบัะพัะพะผ ะธะท ะฟััะธ ัะปะตะผะตะฝัะพะฒ: ะฟะพะทะธัะธั-\emph{x} ะฑัะดะตั 0-ัะผ
ัะปะตะผะตะฝัะพะผ, ะฟะพะทะธัะธั-\emph{y} ะฑัะดะตั 1-ัะผ, ะธ ัะฐะบ ะดะฐะปะตะต. ะัะพะฑะปะตะผะฐ ะดะฐะฝะฝัั
ะฟัะตะดััะฐะฒะปะตะฝะธะน ัะพััะพะธั ะฒ ัะพะผ, ััะพ ะบะพะผะฟะพะฝะตะฝัั ะทะฐะฝะธะผะฐัั ัะพะฒะตััะตะฝะฝะพ ัะปััะฐะนะฝัะต
ะฟะพะทะธัะธะธ ะธ ะธั ัะปะพะถะฝะพ ะทะฐะฟะพะผะฝะธัั. ะัะพ-ะฝะธะฑัะดั ัะฒะธะดะตะฒ ะณะดะต-ัะพ ะฒ ะบะพะดะต
ัััะพะบะธ \cd{(cadddr~ship1)} ะธะปะธ \cd{(aref~ship1~3)}, ะพะฑะฝะฐััะถะธั ัะปะพะถะฝะพััั ะฒ
ะพะฟัะตะดะตะปะตะฝะธะธ ัะพะณะพ, ััะพ ััะพ ะฟัะพะธะทะฒะพะดะธััั ะดะพัััะฟ ะบ ะบะพะผะฟะพะฝะตะฝัั ัะบะพัะพััะธ-\emph{y}
ััััะบัััั \cd{ship1}. ะะพะปะตะต ัะพะณะพ, ะตัะปะธ ะฟัะตะดััะฐะฒะปะตะฝะธะต ะบะพัะฐะฑะปั ะดะพะปะถะฝะพ ะฑััั
ะธะทะผะตะฝะตะฝะพ, ัะพ ะฑัะดะตั ะพัะตะฝั ัะปะพะถะฝะพ ะฝะฐะนัะธ ะฒัะต ะผะตััะฐ ะฒ ะบะพะดะต ะดะปั ะธะทะผะตะฝะตะฝะธั ะฒ
ัะพะพัะฒะตัััะฒะธะต ั ะฝะพะฒัะผ ะฟัะตะดััะฐะฒะปะตะฝะธะตะผ (ะฝะต ะฒัะต ะฟะพัะฒะปะตะฝะธั \cdf{cadddr} ะพะทะฝะฐัะฐัั
ะดะพัััะฟ ะบ ัะบะพัะพััะธ-\emph{y} ะบะพัะฐะฑะปั). 

ะัััะต ะฑัะปะพ ะฑั ะตัะปะธ ะฑั ะทะฐะฟะธัะธ ััััะบััั ะธะผะตะปะธ ะธะผะตะฝะฐ. ะะพะถะฝะพ ะฑัะปะพ ะฑั ะฝะฐะฟะธัะฐัั ััะพ-ัะพ
ะฒัะพะดะต \cd{(ship-y-velocity ship1)} ะฒะผะตััะพ \cd{(cadddr ship1)}. ะัะพะผะต ัะพะณะพ ะฑัะปะพ
ะฑั ะฝะตะฟะปะพัะพ ะธะผะตัั ะฑะพะปะตะต ะธะฝัะพัะผะฐัะธะฒะฝัั ะทะฐะฟะธัั ะดะปั ัะพะทะดะฐะฝะธั ััััะบััั, ัะตะผ ััะฐ:
\begin{lisp}
(list 0 0 0 0 0)
\end{lisp}
ะะตัะพะผะฝะตะฝะฝะพ, ัะพัะตััั, ััะพะฑั \cdf{ship} ะฑัะป ะฝะพะฒัะผ ัะธะฟะพะผ ะดะฐะฝะฝัั, ะบะฐะบ ะธ ะปัะฑะพะน ะดััะณะพะน
ัะธะฟ Lisp'ะพะฒัั ะดะฐะฝะฝัั, ััะพะฑั, ะฝะฐะฟัะธะผะตั, ะพัััะตััะฒะธัั ะฟัะพะฒะตัะบั ั ะฟะพะผะพััั
\cdf{typep}.
ะคัะฝะบัะธะพะฝะฐะปัะฝะพััั \cdf{defstruct} ะฟัะตะดะพััะฐะฒะปัะตั ะฒัะต, ััะพ ะฒััะต ะฑัะปะพ ะฝะตะพะฑัะพะดะธะผะพ.

\cdf{defstruct} ัะฒะปัะตััั ะผะฐะบัะพัะพะผ, ะบะพัะพััะน ะพะฟัะตะดะตะปัะตั ััััะบัััั. ะะฐะฟัะธะผะตั, ะดะปั
ะบะพัะผะธัะตัะบะพะณะพ ะบะพัะฐะฑะปั, ะผะพะถะฝะพ ะพะฟัะตะดะตะปะธัั ััััะบัััั ัะฐะบ:
\begin{lisp}
(defstruct ship \\
~~x-position \\
~~y-position \\
~~x-velocity \\
~~y-velocity \\
~~mass)
\end{lisp}
ะะฐะฟะธัั ะดะตะบะปะฐัะธััะตั, ััะพ ะบะฐะถะดัะน ะพะฑัะตะบั \cdf{ship} ัะฒะปัะตััั ะพะฑัะตะบัะพะผ ั ะฟัััั
ะธะผะตะฝะพะฒะฐะฝะฝัะผะธ ะบะพะผะฟะพะฝะตะฝัะฐะผะธ. ะััะธัะปะตะฝะธะต ััะพะน ัะพัะผั ะดะตะปะฐะตั ะฝะตัะบะพะปัะบะพ ะฒะตัะตะน.

\begin{itemize}

\item 
ะะฝะฐ ะพะฟัะตะดะตะปัะตั \cdf{ship-x-position} ะบะฐะบ ััะฝะบัะธั ะพะดะฝะพะณะพ ะฐัะณัะผะตะฝัะฐ, ะฐ ะธะผะตะฝะฝะพ,
ะบะพัะฐะฑะปั, ะบะพัะพัะฐั ะฒะพะทะฒัะฐัะฐะตั ะฟะพะทะธัะธั-\emph{x} ะบะพัะฐะฑะปั.
\cdf{ship-y-position} ะธ ะดััะณะธะต ะบะพะผะฟะพะฝะตะฝัั ะฟะพะปััะฐัั ัะฐะบะธะต ะถะต ะพะฟัะตะดะตะปะตะฝะธั ััะฝะบัะธะน.
ะญัะธ ััะฝะบัะธะธ ะฝะฐะทัะฒะฐัััั \emph{ััะฝะบัะธัะผะธ ะดะพัััะฟะฐ}, ัะฐะบ ะบะฐะบ ะธัะฟะพะปัะทััััั ะดะปั
ะดะพัััะฟะฐ ะบ ะบะพะผะฟะพะฝะตะฝัะฐะผ ััััะบัััั.

\item 
ะกะธะผะฒะพะป \cdf{ship} ััะฐะฝะพะฒะธััั ะธะผะตะฝะตะผ ัะธะฟะฐ ะดะฐะฝะฝัั, ะบ ะบะพัะพัะพะผั ะฟัะธะฝะฐะดะปะตะถะฐั
ัะบะทะตะผะฟะปััั ะพะฑัะตะบัะพะผ ะบะพัะฐะฑะปะตะน. ะะฐะฟัะธะผะตั, ััะพ ะธะผั ะผะพะถะตั ะธัะฟะพะปัะทะพะฒะฐัััั ะฒ
\cdf{typep}.
\cd{(typep x 'ship)} ะธััะธะฝะตะฝ, ะตัะปะธ \cd{x} ัะฒะปัะตััั ะบะพัะฐะฑะปัะผ, ะธ ะปะพะถะตะฝ, ะตัะปะธ
\cdf{x} ัะฒะปัะตััั ะปัะฑัะผ ะดััะณะธะผ ะพะฑัะตะบัะพะผ.

\item 
ะะฟัะตะดะตะปัะตััั ััะฝะบัะธั ะพะดะฝะพะณะพ ะฐัะณัะผะตะฝัะฐ ั ะธะผะตะฝะตะผ \cdf{ship-p}. ะะฝะฐ ัะฒะปัะตััั
ะฟัะตะดะธะบะฐัะพะผ, ะบะพัะพััะน ะธััะธะฝะตะฝ, ะตัะปะธ ะฐัะณัะผะตะฝั ัะฒะปัะตััั ะบะพัะฐะฑะปัะผ, ะธ ะปะพะถะตะฝ ะฒ
ะฟัะพัะธะฒะฝัั ัะปััะฐัั. 

\item 
ะะฟัะตะดะตะปัะตััั ััะฝะบัะธั ั ะธะผะตะฝะตะผ \cdf{make-ship}, ะฟัะธ ะฒัะทะพะฒะต ะบะพัะพัะพะน ัะพะทะดะฐัััั
ััััะบัััะฐ ะดะฐะฝะฝัั ะธะท ะฟััะธ ะบะพะผะฟะพะฝะตะฝัะพะฒ, ะณะพัะพะฒะฐั ะบ ะธัะฟะพะปัะทะพะฒะฐะฝะธั ะฒ \emph{ััะฝะบัะธัั
  ะดะพัััะฟะฐ}.
ะขะฐะบ, ะฒัะฟะพะปะฝะตะฝะธะต
\begin{lisp}
(setq ship2 (make-ship))
\end{lisp}
ัััะฐะฝะฐะฒะปะธะฒะฐะตั ะฒ ship2 ัะฒะตะถะต ัะพะทะดะฐะฝะฝัะน ะพะฑัะตะบั \cdf{ship}.
ะะพะถะฝะพ ัะบะฐะทะฐัั ะฟะตัะฒะพะฝะฐัะฐะปัะฝัะต ะทะฝะฐัะตะฝะธั ะดะปั ะบะพะผะฟะพะฝะตะฝัะพะฒ ััััะบัััั ะธัะฟะพะปัะทัั
ะธะผะตะฝะพะฒะฐะฝะฝัะต ะฟะฐัะฐะผะตััั:
\begin{lisp}
(setq ship2 (make-ship \cd{:mass} *default-ship-mass* \\
~~~~~~~~~~~~~~~~~~~~~~~\cd{:x-position} 0 \\
~~~~~~~~~~~~~~~~~~~~~~~\cd{:y-position} 0))
\end{lisp}
ะคะพัะผะฐ ัะพะทะดะฐัั ะฝะพะฒัะน ะบะพัะฐะฑะปั ะธ ะธะฝะธัะธะฐะปะธะทะธััะตั ััะธ ะตะณะพ ะบะพะผะฟะพะฝะตะฝัะฐ.
ะญัะฐ ััะฝะบัะธั ะฝะฐะทัะฒะฐะตััั \emph{ััะฝะบัะธะตะน-ะบะพะฝััััะบัะพัะพะผ}, ะฟะพัะพะผั ััะพ ัะพะทะดะฐัั ะฝะพะฒัั
ััััะบัััั.

\item
ะกะธะฝัะฐะบัะธั \cd{\#S} ะผะพะถะตั ะธัะฟะพะปัะทะพะฒะฐัััั ะดะปั ััะตะฝะธั ัะบะทะตะผะฟะปััะพะฒ ััััะบััั
\cdf{ship}, ะธ ัะฐะบะถะต ะฟัะตะดะพััะฐะฒะปัะตััั ััะฝะบัะธั ะฒัะฒะพะดะฐ ะดะปั ะฟะตัะฐัะธ ััััะบััั ะบะพัะฐะฑะปะตะน.
ะะฐะฟัะธะผะตั, ะทะฝะฐัะตะฝะธะต ัะฐะฝะตะต ัะฟะพะผัะฝััะพะน ะฟะตัะตะผะตะฝะฝะพะน \cd{ship2} ะผะพะถะตั ะฑััั ะฒัะฒะตะดะตะฝะพ
ะบะฐะบ
\begin{lisp}
\#S(ship  x-position 0  y-position 0  x-velocity nil \\
~~~~~~~~~y-velocity nil  mass 170000.0)
\end{lisp}

\item 
ะะฟัะตะดะตะปัะตััั ััะฝะบัะธั ะพะดะฝะพะณะพ ะฐัะณัะผะตะฝัะฐ ั ะธะผะตะฝะตะผ \cdf{copy-ship}, ะบะพัะพัะฐั ะฟะพะปััะฐั
ะพะฑัะตะบั \cdf{ship}, ะฑัะดะตั ัะพะทะดะฐะฒะฐัั ะฝะพะฒัะน ะพะฑัะตะบั \cdf{ship}, ะบะพัะพััะน ัะฒะปัะตััั
ะบะพะฟะธะตะน ะธััะพะดะฝะพะณะพ.
ะญัะฐ ััะฝะบัะธั ะฝะฐะทัะฒะฐะตััั \emph{ััะฝะบัะธะตะน ะบะพะฟะธัะพะฒะฐะฝะธั}.

\item 
ะะพะถะฝะพ ะธัะฟะพะปัะทะพะฒะฐัั \cdf{setf} ะดะปั ะธะทะผะตะฝะตะฝะธั ะบะพะผะฟะพะฝะตะฝัะพะฒ ะพะฑัะตะบัะฐ \cdf{ship}:
\begin{lisp}
(setf (ship-x-position ship2) 100)
\end{lisp}
ะะฐะฝะฝะฐั ะทะฐะฟะธัั ะธะทะผะตะฝัะตั ะฟะพะทะธัะธั-\emph{x} ะฟะตัะตะผะตะฝะฝะพะน \emph{ship2} ะฒ \cd{100}.
ะะฝะฐ ัะฐะฑะพัะฐะตั, ะฟะพัะพะผั ััะพ \cdf{defstruct} ะฒะตะดัั ัะตะฑั ัะฐะบ, ะฑัะดัะพ ัะพะทะดะฐัั
ัะพะพัะฒะตัััะฒัััะธะต \cdf{defsetf} ัะพัะผั ะดะปั \emph{ััะฝะบัะธะน ะดะพัััะฟะฐ}.
\end{itemize}

ะญัะพั ะฟัะพััะพะน ะฟัะธะผะตั ะพัะพะฑัะฐะถะฐะตั ะผะพัั ะธ ัะดะพะฑััะฒะพ \cdf{defstruct} ะดะปั ะฟัะตะดััะฐะฒะปะตะฝะธั
ะทะฐะฟะธัะตะน ััััะบััั.
\cdf{defstruct} ะธะผะตะตั ะผะฝะพะณะพ ะดััะณะธั ะฒะพะทะผะพะถะฝะพััะตะน ะดะปั ัะฟะตัะธะฐะปะธะทะธัะพะฒะฐะฝะฝัั ัะตะปะตะน.

\section{ะะฐะบ ะธัะฟะพะปัะทะพะฒะฐัั defstruct}

ะัะต ััััะบัััั ะพะฟัะตะดะตะปััััั ั ะฟะพะผะพััั ะบะพะฝััััะบัะธะธ \cdf{defstruct}.
ะัะทะพะฒ \cdf{defstruct} ะพะฟัะตะดะตะปัะตั ะฝะพะฒัะน ัะธะฟ ะดะฐะฝะฝัั, ัะบะทะตะผะฟะปััั ะบะพัะพัะพะณะพ ัะพะดะตัะถะฐั
ะธะผะตะฝะพะฒะฐะฝะฝัะต ัะปะพัั.

\begin{defmac}
defstruct name-and-options [doc-string] {slot-description}+

ะญัะพั ะผะฐะบัะพั ะพะฟัะตะดะตะปัะตั ััััะบัััะฝัะน ัะธะฟ ะดะฐะฝะฝัั.
ะะฑััะฝะพ ะฒัะทะพะฒ \cdf{defstruct} ะฒัะณะปัะดะธั ะบะฐะบ ัะปะตะดัััะธะน ะฟัะธะผะตั.
\begin{lisp}
(defstruct (\emph{name} \emph{option-1} \emph{option-2} ... \emph{option-m}) \\
~~~~~~~~~~~\emph{doc-string} \\
~~~~~~~~~~~\emph{slot-description-1} \\
~~~~~~~~~~~\emph{slot-description-2} \\
~~~~~~~~~~~... \\
~~~~~~~~~~~\emph{slot-description-n}) \\
\end{lisp}
ะะผั ััััะบัััั \emph{name} ะดะพะปะถะฝะพ ะฑััั ัะธะผะฒะพะปะพะผ. ะะฝ ััะฐะฝะพะฒะธัััั ะธะผะตะฝะตะผ ะฝะพะฒะพะณะพ ัะธะฟะฐ ะดะฐะฝะฝัั,
ะบะพัะพััะน ะฒะบะปััะฐะตั ะฒ ัะตะฑั ะฒัะต ัะบะทะตะผะฟะปััั ะดะฐะฝะฝะพะน ััััะบัััั.
ะกะพะพัะฒะตัััะฒะตะฝะฝะพ ััะฝะบัะธั \cdf{typep} ะฑัะดะตั ะฟัะธะฝะธะผะฐัั ะธ ะธัะฟะพะปัะทะพะฒะฐัั ััะพ
ะธะผั. ะะผั ััััะบัััั \emph{name} ะฒะพะทะฒัะฐัะฐะตััั ะบะฐะบ ะทะฝะฐัะตะฝะธะต ัะพัะผั \emph{defstruct}.

ะะฑััะฝะพ ะพะฟัะธะธ ะฝะต ะฝัะถะฝั. ะัะปะธ ะพะฝะธ ะฝะต ะทะฐะดะฐะฝั, ัะพ ะฟะพัะปะต ัะปะพะฒะฐ \cdf{defstruct} ะฒะผะตััะพ
\cd{(\emph{name})} ะผะพะถะฝะพ ะทะฐะฟะธัะฐัั ะฟัะพััะพ \emph{name} . ะกะธะฝัะฐะบัะธั ะพะฟัะธะน ะธ ะธั
ัะผััะป ัะฐัะบััะฒะฐัััั ะฒ ัะฐะทะดะตะปะต~\ref{DEFSTRUCT-OPTIONS}.

ะัะปะธ ะฟัะธัััััะฒัะตั ะฝะตะพะฑัะทะฐัะตะปัะฝะฐั ัััะพะบะฐ ะดะพะบัะผะตะฝัะฐัะธะธ \emph{doc-string}, ัะพะณะดะฐ
ะพะฝะฐ ะฟัะธัะพะตะดะธะฝัะตััั ะบ ัะธะผะฒะพะปั \emph{name}, ะบะฐะบ ะดะพะบัะผะตะฝัะฐัะธั ะดะปั ัะธะฟะฐ
\cdf{structure}. ะกะผะพััะธัะต \cdf{documentation}.

ะะฐะถะดะพะต ะพะฟะธัะฐะฝะธะต ัะปะพัะฐ \emph{slot-description-j} ะฒัะณะปัะดะธั ัะฐะบ:
\begin{lisp}
(\emph{slot-name} \emph{default-init} \\
~~~~~\emph{slot-option-name-1} \emph{slot-option-value-1} \\
~~~~~\emph{slot-option-name-2} \emph{slot-option-value-2} \\
~~~~~... \\
~~~~~\emph{slot-option-name-k${}_{j}$} \emph{slot-option-value-k${}_{j}$})
\end{lisp}
ะะฐะถะดะพะต ะธะผั ัะปะพัะฐ \emph{slot-name} ะดะพะปะถะฝะพ ะฑััั ัะธะผะฒะพะปะพะผ. ะะปั ะบะฐะถะดะพะณะพ ัะปะพัะฐ
ะพะฟัะตะดะตะปัะตััั ััะฝะบัะธั ะดะพัััะฟะฐ. ะัะปะธ ะพะฟัะธะธ ะธ ะฟะตัะฒะพะฝะฐัะฐะปัะฝัะต ะทะฝะฐัะตะฝะธั ะฝะต ัะบะฐะทะฐะฝั,
ัะพะณะดะฐ ะฒ ะบะฐัะตััะฒะต ะพะฟะธัะฐะฝะธั ัะปะพัะฐ ะฒะผะตััะพ \cd{(slot-name)} ะผะพะถะฝะพ ะทะฐะฟะธัะฐัั ะฟัะพััะพ
\emph{slot-name}.

ะคะพัะผะฐ \emph{default-init} ะฒััะธัะปัะตััั, ัะพะปัะบะพ ะตัะปะธ ัะพะพัะฒะตัััะฒัััะธะน ะฐัะณัะผะตะฝั ะฝะต
ัะบะฐะทะฐะฝ ะฟัะธ ะฒัะทะพะฒะต ััะฝะบัะธะน-ะบะพะฝััััะบัะพัะพะฒ.
\emph{default-init} ะฒััะธัะปัะตััั \emph{ะบะฐะถะดัะน ัะฐะท}, ะบะพะณะดะฐ ะฝะตะพะฑัะพะดะธะผะพ ะฟะพะปััะธัั
ะฟะตัะฒะพะฝะฐัะฐะปัะฝะพะต ะทะฝะฐัะตะฝะธะต ะดะปั ัะปะพัะฐ.

ะัะปะธ \emph{default-init} ะฝะต ัะบะฐะทะฐะฝะพ, ัะพะณะดะฐ ะฟะตัะฒะพะฝะฐัะฐะปัะฝะพะต ะทะฝะฐัะตะฝะธะต ัะปะพัะฐ ะฝะต
ะพะฟัะตะดะตะปะตะฝะพ ะธ ะทะฐะฒะธัะธั ะพั ัะตะฐะปะธะทะฐัะธะธ. ะะพัััะฟะฝัะต ะพะฟัะธะธ ะดะปั ัะปะพัะพะฒ ัะฐะทะพะฑัะฐะฝั ะฒ
ัะฐะทะดะตะปะต~\ref{Defstruct-Slot-Options}.

\cdf{defstruct} ะฝะต ัะพะปัะบะพ ะพะฟัะตะดะตะปัะตั ััะฝะบัะธะธ ะดะพัััะฟะฐ ะบ ัะปะพัะฐะผ, ะฝะพ ัะฐะบะถะต
ะฒัะฟะพะปะฝัะตั ะธะฝัะตะณัะฐัะธั ั \cdf{setf} ะดะปั ััะธั ััะฝะบัะธะน, ะพะฟัะตะดะตะปัะตั ะฟัะตะดะธะบะฐั ั
ะธะผะตะฝะตะผ \cd{\emph{name}-p}, ะพะฟัะตะดะตะปัะตั ััะฝะบัะธั-ะบะพะฝััััะบัะพั ั ะธะผะตะฝะตะผ
\cd{make-\emph{name}} ะธ ะพะฟัะตะดะตะปัะตั ััะฝะบัะธั ะบะพะฟะธัะพะฒะฐะฝะธั ั ะธะผะตะฝะตะผ
\cd{copy-\emph{name}}.
ะัะต ะธะผะตะฝะฐ ะฐะฒัะพะผะฐัะธัะตัะบะธ ัะพะทะดะฐะฒะฐะตะผัั ััะฝะบัะธะน ะธะฝัะตัะฝะธัััััั ะฒ ัะตะบััะธะน ะฟะฐะบะตั ะฝะฐ ะฒัะตะผั
ะฒัะฟะพะปะฝะตะฝะธั \cdf{defstruct} (ัะผะพััะธัะต \cdf{*package*}).
ะัะพะผะต ัะพะณะพ, ะฒัะต ััะธ ััะฝะบัะธะธ ะผะพะณัั ะฑััั ะทะฐะดะตะบะปะฐัะธัะพะฒะฐะฝั ะบะฐะบ \cdf{inline} ะฝะฐ
ััะผะพััะตะฝะธะต ัะตะฐะปะธะทะฐัะธะธ ะดะปั ะฟะพะฒััะตะฝะธั ะฟัะพะธะทะฒะพะดะธัะตะปัะฝะพััะธ.
ะัะปะธ ะฒั ะฝะต ัะพัะธัะต, ััะพะฑั ััะฝะบัะธะธ ะฑัะปะธ ะทะฐะดะตะบะปะฐัะธัะพะฒะฐะฝั ะบะฐะบ \cdf{inline}, ัะบะฐะถะธัะต
ะดะตะบะปะฐัะฐัะธั \cdf{notinline} ะฟะพัะปะต ัะพัะผั \cdf{defstruct} ะดะปั ะฟะตัะตะทะฐะฟะธัะธ ะดะตะบะปะฐัะฐัะธะธ
\cdf{inline}.
\end{defmac}

\section{ะัะฟะพะปัะทะพะฒะฐะฝะธะต ะฐะฒัะพะผะฐัะธัะตัะบะธ ะพะฟัะตะดะตะปัะตะผะพะณะพ ะบะพะฝััััะบัะพัะฐ}

ะะพัะปะต ัะพะณะพ, ะบะฐะบ ะฒั ะพะฟัะตะดะตะปะธะปะธ ะฝะพะฒัั ััััะบัััั ั ะฟะพะผะพััั \cdf{defstruct}, ะฒั
ะผะพะถะตัะต ัะพะทะดะฐะฒะฐัั ัะบะทะตะผะฟะปััั ะดะฐะฝะฝะพะน ััััะบัััั ั ะฟะพะผะพััั ััะฝะบัะธะธ-ะบะพะฝััััะบัะพัะฐ.
ะะพ-ัะผะพะปัะฐะฝะธั \cdf{defstruct} ะฐะฒัะพะผะฐัะธัะตัะบะธ ะพะฟัะตะดะตะปัะตั ััั ััะฝะบัะธั.
ะะปั ััััะบัััั ั ะธะผะตะฝะตะผ \cdf{foo}, ััะฝะบัะธั-ะบะพะฝััััะบัะพั ะพะฑััะฝะพ ะฝะฐะทัะฒะฐะตััั
\cdf{make-foo}.
ะั ะผะพะถะตัะต ัะบะฐะทะฐัั ะดััะณะพะต ะธะผั, ะฟะตัะตะดะฐะฒ ะตะณะพ ะฒ ะบะฐัะตััะฒะต ะฐัะณัะผะตะฝัะฐ ะดะปั ะพะฟัะธะธ
\cd{:constructor}, ะธะปะธ, ะตัะปะธ ะฒั ะฒะพะพะฑัะต ะฝะต ัะพัะธัะต ะพะฑััะฝัั ััะฝะบัะธั-ะบะพะฝััััะบัะพั, ัะบะฐะทะฐะฒ ะฒ ะบะฐัะตััะฒะฐ ะฐัะณัะผะตะฝัะฐ {\false}. 
ะ ะฟะพัะปะตะดะฝะตะผ ัะปััะฐะต ะดะพะปะถะฝั ะฑััั ะทะฐะฟัะพัะตะฝั ะพะดะธะฝ ะธะปะธ ะฑะพะปะตะต ะบะพะฝััััะบัะพัะพะฒ
ั <<ะฟะพะทะธัะธะพะฝะฝัะผะธ>> ะฐัะณัะผะตะฝัะฐะผะธ FIXME, ัะผะพััะธัะต ัะฐะทะดะตะป~\ref{DEFSTRUCT-CONSTRUCTOR-SYNTAX}.

ะะฑัะฐั ัะพัะผะฐ ะฒัะทะพะฒะฐ ััะฝะบัะธะธ-ะบะพะฝััััะบัะพัะฐ ะฒัะณะปัะดะธั ัะฐะบ:
\begin{lisp}
(\emph{name-of-constructor-function} \\*
~~~~~~~~\emph{slot-keyword-1} \emph{form-1} \\*
~~~~~~~~\emph{slot-keyword-2} \emph{form-2} \\*
~~~~~~~~...)
\end{lisp}
ะัะต ะฐัะณัะผะตะฝัั ัะฒะปััััั ะธะผะตะฝะพะฒะฐะฝะฝัะผะธ. ะะฐะถะดัะน \emph{slot-keyword} ะดะพะปะถะตะฝ ะฑััั
ะบะปััะตะฒัะผ ัะธะผะฒะพะปะพะผ, ะธะผั ะบะพัะพัะพะณะพ ัะพะฒะฟะฐะดะฐะตั ัะพ ะธะผะตะฝะตะผ ัะปะพัะฐ ััััะบัััั
(\cdf{defstruct} ะพะฟัะตะดะตะปัะตั ะฒะพะทะผะพะถะฝัะต ะบะปััะตะฒัะต ัะธะผะฒะพะปั ะธะฝัะตัะฝะธััั ะบะฐะถะดะพะต ะธะผั
ัะปะพัะฐ ะฒ ะฟะฐะบะตั ะบะปััะตะฒัั ัะธะผะฒะพะปะพะฒ (keyword). ะัะต ะบะปััะตะฒัะต ัะธะผะฒะพะปั \emph{keywords}
ะธ ัะพัะผั \emph{forms} ะฒััะธัะปััััั. ะ ัะตะปะพะผ, ััะพ ะฒัะณะปัะดะธั ะบะฐะบ ะตัะปะธ ััะฝะบัะธั-ะบะพะฝััััะบัะพั ะฟัะธะฝะธะผะฐะตั ะฒัะต ะฐัะณัะผะตะฝัั ะบะฐะบ \cd{\&key} ะฟะฐัะฐะผะตััั. ะะฐะฟัะธะผะตั,
ััััะบัััะฐ \cd{ship} ัะฟะพะผัะฝััะฐั ัะฐะฝะตะต ะฒ ัะฐะทะดะตะปะต~\ref{DEFSTRUCT-INTRO-SECTION}
ะธะผะตะตั ััะฝะบัะธั-ะบะพะฝััััะบัะพั, ะบะพัะพัะฐั ะฟัะธะฝะธะผะฐะตั ะฐัะณัะผะตะฝัั ะฒ ัะพะพัะฒะตััะฒะธะต ัะพ
ัะปะตะดัััะธะผ ะพะฟัะตะดะตะปะตะฝะธะตะผ:
\begin{lisp}
(defun make-ship (\&key x-position y-position \\
~~~~~~~~~~~~~~~~~~~~~~~x-velocity y-velocity mass) \\
~~...)
\end{lisp}

\label{defstruct-initialization}
ะัะปะธ \emph{slot-keyword-j} ะทะฐะดะฐัั ะธะผั ัะปะพัะฐ, ัะพะณะดะฐ ัะปะตะผะตะฝั ัะพะทะดะฐะฝะฝะพะน ััััะบัััั
ะฑัะดะตั ะธะฝะธัะธะฐะปะธะทะธัะพะฒะฐะฝ ะทะฝะฐัะตะฝะธะตะผ \emph{form-j}.
ะัะปะธ ะฟะฐัะฐ \emph{slot-keyword-j} ะธ \emph{form-j} ะดะปั ัะปะพัะฐ ะฝะต ัะบะฐะทะฐะฝะฐ, ัะพะณะดะฐ ัะปะพั
ะฑัะดะตั ะธะฝะธัะธะฐะปะธะทะธัะพะฒะฐะฝ ัะตะทัะปััะฐัะพะผ ะฒััะธัะปะตะฝะธั ัะบะฐะทะฐะฝะฝะพะน ะฒ ะฒัะทะพะฒะต \cdf{defstruct}
ะดะปั ััะพะณะพ ัะปะพัะฐ ัะพัะผะพะน \emph{default-init}.
(ะััะณะธะผะธ ัะปะพะฒะฐะผะธ, ะธะฝะธัะธะฐะปะธะทะฐัะธั ัะบะฐะทะฐะฝะฝะฐั ะฒ \cdf{defstruct} ะทะฐะผะตัะฐะตััั
ะธะฝะธัะธะฐะปะธะทะฐัะธะตะน ัะบะฐะทะฐะฝะฝะพะน ะฒ ะฒัะทะพะฒะต ััะฝะบัะธะธ-ะบะพะฝััััะบัะพัะฐ.)
ะัะปะธ ะธัะฟะพะปัะทัะตััั ัะพัะผะฐ ะธะฝะธัะธะฐะปะธะทะฐัะธะธ \emph{default-init}, ะพะฝะฐ ะฒััะธัะปัะตััั ะฒ
ะฒัะตะผั ัะพะทะดะฐะฝะธั ัะบะทะตะผะฟะปััะฐ ััััะบัััั, ะฝะพ ะฒ ะปะตะบัะธัะตัะบะพะผ ะพะบััะถะตะฝะธะธ ัะพัะผั
\cdf{defstruct}, ะฒ ะบะพัะพัะพะน ะพะฝะฐ ะธัะฟะพะปัะทัะตััั.
ะัะปะธ ััะฐ ัะพัะผะฐ ะธะฝะธัะธะฐะปะธะทะฐัะธะธ ะฝะต ัะบะฐะทะฐะฝะฐ, ะฟะตัะฒะพะฝะฐัะฐะปัะฝะพะต ะทะฝะฐัะตะฝะธะต ัะปะพัะฐ ะฝะต
ะพะฟัะตะดะตะปะตะฝะพ.
ะัะปะธ ะฒะฐะผ ะฝะตะพะฑัะพะดะธะผะพ ะธะฝะธัะธะฐะปะธะทะธัะพะฒะฐัั ัะปะพัั ะฝะตะบะพัะพััะผะธ ะทะฝะฐัะตะฝะธัะผะธ, ะฒั ะดะพะปะถะฝั
ะฒัะตะณะดะฐ ัะบะฐะทัะฒะฐัั ะฟะตัะฒะพะฝะฐัะฐะปัะฝะพะต ะทะฝะฐัะตะฝะธะต ะธะปะธ ะฒ \cdf{defstruct}, ะธะปะธ ะฒ 
ะฒัะทะพะฒะต ััะฝะบัะธะธ-ะบะพะฝััััะบัะพัะฐ. 

ะะฐะถะดะฐั ัะพัะผะฐ ะธะฝะธัะธะฐะปะธะทะฐัะธะธ, ัะบะฐะทะฐะฝะฝะฐั ะฒ ะบะพะผะฟะพะฝะตะฝัะต ัะพัะผั \cdf{defstruct}, ะบะพะณะดะฐ
ะธัะฟะพะปัะทัะตััั ััะฝะบัะธะตะน-ะบะพะฝััััะบัะพัะพะผ, ะฟะตัะตะฒััะธัะปัะตััั ะฟัะธ ะบะฐะถะดะพะผ ะฒัะทะพะฒะต
ััะฝะบัะธะธ. ะญัะพ, ะบะฐะบ ะตัะปะธ ะฑั ัะพัะผั ะธะฝะธัะธะฐะปะธะทะฐัะธะธ ะธัะฟะพะปัะทะพะฒะฐะปะธัั ะบะฐะบ ัะพัะผั
\emph{init} ะดะปั ะธะผะตะฝะพะฒะฐะฝะฝัั ะฟะฐัะฐะผะตััะพะฒ ััะฝะบัะธะธ-ะบะพะฝััััะบัะพัะฐ.
ะะฐะฟัะธะผะตั, ะตัะปะธ ัะพัะผะฐ \cd{(gensym)} ะธัะฟะพะปัะทัะตััั ะบะฐะบ ัะพัะผะฐ ะธะฝะธัะธะฐะปะธะทะฐัะธะธ ะธะปะธ ะฒ
ะฒัะทะพะฒะต ััะฝะบัะธะธ-ะบะพะฝััััะบัะพัะฐ, ะธะปะธ ัะพัะผะต ะธะฝะธัะธะฐะปะธะทะฐัะธะธ ัะปะพัะฐ ะฒ ัะพัะผะต
\cdf{defstruct}, ัะพะณะดะฐ ะบะฐะถะดัะน ะฒัะทะพะฒ ััะฝะบัะธะธ-ะบะพะฝััััะบัะพัะฐ ะฒัะทัะฒะฐะป ะฑั \cdf{gensym}
ะดะปั ัะพะทะดะฐะฝะธั ะฝะพะฒะพะณะพ ัะธะผะฒะพะปะฐ.

\section{ะะฟัะธะธ ัะปะพัะพะฒ ะดะปั defstruct}
\label{Defstruct-Slot-Options}

ะะฐะถะดะฐั ัะพัะผะฐ \emph{slot-description} ะฒ ัะพัะผะต \cdf{defstruct} ะผะพะถะตั ัะบะฐะทัะฒะฐัั
ะพะดะฝะพ ะธะปะธ ะฑะพะปะตะต ะพะฟัะธะน ัะปะพัะฐ. \emph{slot-option} ัะฒะปัะตััั ะฟะฐัะพะน ะบะปััะตะฒะพะณะพ ัะธะผะฒะพะปะฐ ะธ
ะทะฝะฐัะตะฝะธั (ะบะพัะพัะพะต ะฝะต ัะฒะปัะตััั ัะพัะผะพะน ะดะปั ะฒััะธัะปะตะฝะธั, ะฐ ัะฒะปัะตััั ะฟัะพััะพ
ะทะฝะฐัะตะฝะธะตะผ).
ะะฐะฟัะธะผะตั:
\begin{lisp}
(defstruct ship \\
~~(x-position 0.0 \cd{:type} short-float) \\
~~(y-position 0.0 \cd{:type} short-float) \\
~~(x-velocity 0.0 \cd{:type} short-float) \\
~~(y-velocity 0.0 \cd{:type} short-float) \\
~~(mass *default-ship-mass* \cd{:type} short-float \cd{:read-only} t))
\end{lisp}
ะญัะพั ะฟัะธะผะตั ัะพะดะตัะถะธั ะพะฟัะตะดะตะปะตะฝะธะต, ััะพ ะบะฐะถะดัะน ัะปะพั ะฑัะดะตั ะฒัะตะณะดะฐ ัะพะดะตัะถะฐัั
ะบะพัะพัะบะพะต ั ะฟะปะฐะฒะฐััะตะน ัะพัะบะพะน ัะธัะปะพ, ะธ ััะพ ะฟะพัะปะตะดะฝะธะน ัะปะพั ะฝะต ะผะพะถะตั ะฑััั ะธะทะผะตะฝัะฝ
ะฟะพัะปะต ัะพะทะดะฐะฝะธั ะบะพัะฐะฑะปั.
ะะพัััะฟะฝัะต ะพะฟัะธะธ ะดะปั ัะปะพัะพะฒ \emph{slot-options}:
\begin{flushdesc}
\item[\cd{:type}]
ะะฟัะธั \cd{\cd{:type} \emph{type}} ัะบะฐะทัะฒะฐะตั, ััะพ ัะพะดะตัะถะธะผะพะต ัะปะพัะฐ ะฑัะดะตั ะฒัะตะณะดะฐ
ะฟัะธะฝะฐะดะปะตะถะฐัั ัะบะฐะทะฐะฝะฝะพะผั ัะธะฟั ะดะฐะฝะฝัั. ะะฝะฐ ะฟะพัะพะถะฐ ะฝะฐ ะฐะฝะฐะปะพะณะธัะฝัั ะดะตะบะปะฐัะฐัะธั ะดะปั
ะฟะตัะตะผะตะฝะฝะพะน ะธะปะธ ััะฝะบัะธะธ. ะ ะบะพะฝะตัะฝะพ ะถะต, ะพะฝะฐ ัะฐะบะถะต ะดะตะบะปะฐัะธััะตั ะฒะพะทะฒัะฐัะฐะตะผัะน
\emph{ััะฝะบัะธะตะน ะดะพัััะฟะฐ} ัะธะฟ. ะะตะฐะปะธะทะฐัะธั ะผะพะถะตั ะฟัะพะฒะตัััั ะธะปะธ ะฝะต ะฟัะพะฒะตัััั ัะธะฟ
ะฝะพะฒะพะณะพ ะพะฑัะตะบัะฐ ะฟัะธ ะธะฝะธัะธะฐะปะธะทะฐัะธะธ ะธะปะธ ะฟัะธัะฒะฐะธะฒะฐะฝะธะธ ัะปะพัะฐ.
ะกะปะตะดัะตั ะพัะผะตัะธัั, ััะพ ัะพัะผะฐ ะฐัะณัะผะตะฝัะฐ \emph{type} ะฝะต ะฒััะธัะปัะตััั, ะธ
ัะปะตะดะพะฒะฐัะตะปัะฝะพ ะดะพะปะถะฝะฐ ะฑััั ะบะพััะตะบัะฝัะผ ัะฟะตัะธัะธะบะฐัะพัะพะผ ัะธะฟะฐ.

\item[\cd{:read-only}]
ะะฟัะธั \cd{\cd{:read-only} \emph{x}}, ะฟัะธ \emph{x} ะฝะต {\false}, ัะบะฐะทัะฒะฐะตั , ััะพ
ััะพั ัะปะพั ะฝะต ะผะพะถะตั ะฑััั ะธะทะผะตะฝัะฝ. ะะฝ ะฑัะดะตั ะฒัะตะณะดะฐ ัะพะดะตัะถะฐัั ะทะฝะฐัะตะฝะธะต, ัะบะฐะทะฐะฝะฝะพะต
ะฒะพ ะฒัะตะผั ัะพะทะดะฐะฝะธั ัะบะทะตะผะฟะปััะฐ ััััะบัััั.
\cdf{setf} ะฝะต ะฟัะธะฝะธะผะฐะตั \emph{ััะฝะบัะธั ะดะพัััะฟะฐ} ะบ ะดะฐะฝะฝะพะผั ัะปะพัั.
ะัะปะธ \emph{x} {\false}, ััะฐ ะพะฟัะธั ะฝะธัะตะณะพ ะฝะต ะผะตะฝัะตั.
ะกะปะตะดัะตั ะพัะผะตัะธัั, ััะพ ัะพัะผะฐ ะฐัะณัะผะตะฝัะฐ \emph{x} ะฝะต ะฒััะธัะปัะตััั.
\end{flushdesc}

ะกะปะตะดัะตั ะพัะผะตัะธัั, ััะพ ะฝะตะฒะพะทะผะพะถะฝะพ ะพะฟัะตะดะตะปะธัั ะพะฟัะธั ะดะปั ัะปะพัะฐ ะฑะตะท ัะบะฐะทะฐะฝะธั
ะทะฝะฐัะตะฝะธะต ะฟะพ-ัะผะพะปัะฐะฝะธั.

\section{ะะฟัะธะธ defstruct}
\label{DEFSTRUCT-OPTIONS}
\label{Defstruct-Hairy-Stuff}

ะัะตะดัะดััะตะต ะพะฟะธัะฐะฝะธะต \cdf{defstruct} ะดะพััะฐัะพัะฝะพ ะดะปั ััะตะดะฝะตััะฐัะธััะธัะตัะบะพะณะพ
ะธัะฟะพะปัะทะพะฒะฐะฝะธั. ะััะฐะฒััััั ัะฐััั ััะพะน ะณะปะฐะฒั ะทะฐะฝะธะผะฐะตั ะพะฟะธัะฐะฝะธะต ะฑะพะปะตะต ัะปะพะถะฝัั
ะฒะพะทะผะพะถะฝะพััะตะน ััะฝะบัะธะพะฝะฐะปะฐ \cdf{defstruct}.

ะะฐะฝะฝัะน ัะฐะทะดะตะป ะพะฑัััะฝัะตั ะบะฐะถะดัั ะพะฟัะธั, ะบะพัะพัะฐั ะผะพะถะตั ะฑััั ะธัะฟะพะปัะทะพะฒะฐะฝะฐ ะฒ
\cdf{defstruct}.
ะะฟัะธั ะดะปั \cdf{defstruct} ะผะพะถะตั ะฑััั ะธะปะธ ะบะปััะตะฒัะผ ัะธะผะฒะพะปะพะผ, ะธะปะธ ัะฟะธัะบะพะผ ะธะท
ะบะปััะตะฒะพะณะพ ัะธะผะฒะพะปะฐ ะธ ะฐัะณัะผะตะฝัะฐ ะดะปั ะฝะตะณะพ.
(ะกะปะตะดัะตั ะพัะผะตัะธัั, ััะพ ัะธะฝัะฐะบัะธั ะดะปั ะพะฟัะธะน \cdf{defstruct} ะพัะปะธัะฐะตััั ะพั
ัะธะฝัะฐะบัะธัะฐ ะฟะฐั, ะธัะฟะพะปัะทัะตะผัั ะดะปั ะพะฟัะธะน ัะปะพัะฐ. ะะธะบะฐะบะฐั ัะฐััั ััะธั ะพะฟัะธะน ะฝะต
ะฒััะธัะปัะตััั.)

\begin{flushdesc}

\item[\cd{:conc-name}]
ะะฐะฝะฝะฐั ะพะฟัะธั ะฟัะตะดะพััะฐะฒะปัะตั ะฟัะตัะธะบั ะดะปั ะธะผัะฝ ััะฝะบัะธะน ะดะพัััะฟะฐ.
ะะพ ัะพะณะปะฐัะตะฝะธั, ะธะผะตะฝะฐ ะฒัะตั ััะฝะบัะธะน ะดะพัััะฟะฐ ะบ ัะปะพัะฐะผ ััััะบัััะฐ ะฝะฐัะธะฝะฐัััั ั
ะฟัะตัะธะบัะฐ --- ะธะผะตะฝะธ ััััะบัััั ั ะฟะพัะปะตะดัััะธะผ ะดะตัะธัะพะผ. ะญัะพ ะฟะพะฒะตะดะตะฝะธะต
ะฟะพ-ัะผะพะปัะฐะฝะธั.

ะัะณัะผะตะฝั \cd{:conc-name} ัะบะฐะทัะฒะฐะตั ะฐะปััะตัะฝะฐัะธะฒะฝัะน ะฟัะตัะธะบั. (ะัะปะธ ะฒ ะบะฐัะตััะฒะต
ัะฐะทะดะตะปะธัะตะปั ะธัะฟะพะปัะทัะตััั ะดะตัะธั, ะพะฝ ัะบะฐะทัะฒะฐะตััั ะบะฐะบ ัะฐััั ะฟัะตัะธะบัะฐ.)
ะัะปะธ ะฒ ะบะฐัะตััะฒะต ะฐัะณัะผะตะฝัะฐ ัะบะฐะทะฐะฝะพ {\false}, ัะพะณะดะฐ ะฟัะตัะธะบั ะฝะต ัััะฐะฝะฐะฒะปะธะฒะฐะตััั
ะฒะพะพะฑัะต.
ะขะพะณะดะฐ ะธะผะตะฝะฐ ััะฝะบัะธะน ะดะพัััะฟะฐ ัะพะฒะฟะฐะดะฐัั ั ะธะผะตะฝะฐะผะธ ัะปะพัะพะฒ, ะธ ััะพ ะฟะพะฒะพะด ะดะฐะฒะฐัั
ัะปะพัะฐะผ ะธะฝัะพัะผะฐัะธะฒะฝัะต ะธะผะตะฝะฐ. 

ะกะปะตะดัะตั ะพัะผะตัะธัั, ััะพ ะฝะต ะทะฐะฒะธัะธะผะพ ะพั ัะพะณะพ, ััะพ ัะบะฐะทะฐะฝะฐ ะฒ \cd{:conc-name}, ะฒ
ััะฝะบัะธะธ-ะบะพะฝััััะบัะพัะต ะธัะฟะพะปัะทััััั ะบะปััะตะฒัะต ัะธะผะฒะพะปั, ัะพะฒะฟะฐะดะฐััะธะต ั ะธะผะตะฝะฐะผะธ
ัะปะพัะพะฒ ะฑะตะท ะฟัะธัะพะตะดะธะฝัะตะผะพะณะพ ะฟัะตัะธะบัะฐ.
ะก ะดััะณะพะน ััะพัะพะฝั ะฟัะตัะธะบั ะธัะฟะพะปัะทัะตััั ะฒ ะธะผะตะฝะฐั ััะฝะบัะธะน ะดะพัััะฟะฐ. ะะฐะฟัะธะผะตั:
\begin{lisp}
(defstruct door knob-color width material) \\
(setq my-door \\
~~~~~~(make-door :knob-color 'red :width 5.0)) \\
(door-width my-door) \EV\ 5.0 \\
(setf (door-width my-door) 43.7) \\
(door-width my-door) \EV\ 43.7 \\
(door-knob-color my-door) \EV\ red
\end{lisp}

\item[\cd{:constructor}]
ะะฐะฝะฝะฐั ะพะฟัะธั ะฟัะธะฝะธะผะฐะตั ะพะดะธะฝ ะฐัะณัะผะตะฝั, ัะธะผะฒะพะป, ะบะพัะพััะน ัะบะฐะทัะฒะฐะตั ะธะผั ััะฝะบัะธะธ-ะบะพะฝััััะบัะพัะฐ. ะัะปะธ ะฐัะณัะผะตะฝั ะฝะต ะฟัะตะดะพััะฐะฒะปะตะฝ, ะธะปะธ ะตัะปะธ ะพะฟัะธั ะฝะต ัะบะฐะทะฐะฝะฐ, ะธะผั
ะบะพะฝััััะบัะพัะฐ ัะพะทะดะฐัััั ัะพะตะดะธะฝะตะฝะธะตะผ ัััะพะบะธ \cd{"MAKE-"} ะธ ะธะผะตะฝะธ ััััะบัััั, ะธ
ะฟะพะผะตัะฐะตััั ะฒ ัะตะบััะธะน ะฟะฐะบะตั ะฒ ะฒัะตะผั ะฒัะฟะพะปะฝะตะฝะธั ัะพัะผั \cdf{defstruct} (ัะผะพััะธัะต
\cdf{*package*}).
ะัะปะธ ะฐัะณัะผะตะฝั ัะบะฐะทะฐะฝ ะธ ัะฐะฒะตะฝ {\false}, ัะพ ััะฝะบัะธั ะบะพะฝััััะบัะพั ะฝะต ัะพะทะดะฐัััั.

ะญัะฐ ะพะฟัะธั ะธะผะตะตั ะฑะพะปะตะต ัะปะพะถะฝัะน ัะธะฝัะฐะบัะธั, ะพะฟะธััะฒะฐะตะผัะน ะฒ
ัะฐะทะดะตะปะต~\ref{DEFSTRUCT-CONSTRUCTOR-SYNTAX}.

\item[\cd{:copier}]
ะะฐะฝะฝะฐั ะพะฟัะธั ะฟัะธะฝะธะผะฐะตั ะพะดะธะฝ ะฐัะณัะผะตะฝั, ัะธะผะฒะพะป, ะบะพัะพััะน ัะบะฐะทัะฒะฐะตั ะธะผั ััะฝะบัะธะธ
ะบะพะฟะธัะพะฒะฐะฝะธั. ะัะปะธ ะฐัะณัะผะตะฝั ะฝะต ะฟัะตะดะพััะฐะฒะปะตะฝ, ะธะปะธ ะตัะปะธ ะพะฟัะธั ะฝะต ัะบะฐะทะฐะฝะฐ, ะธะผั
ััะฝะบัะธะธ ะบะพะฟะธัะพะฒะฐะฝะธั ัะพะทะดะฐัััั ัะพะตะดะธะฝะตะฝะธะตะผ ัััะพะบะธ \cd{"COPY-"} ะธ ะธะผะตะฝะธ ััััะบัััั, ะธ
ะฟะพะผะตัะฐะตััั ะฒ ัะตะบััะธะน ะฟะฐะบะตั ะฒ ะฒัะตะผั ะฒัะฟะพะปะฝะตะฝะธั ัะพัะผั \cdf{defstruct} (ัะผะพััะธัะต
\cdf{*package*}).
ะัะปะธ ะฐัะณัะผะตะฝั ัะบะฐะทะฐะฝ ะธ ัะฐะฒะตะฝ {\false}, ัะพ ััะฝะบัะธั ะบะพะฟะธัะพะฒะฐะฝะธั ะฝะต ัะพะทะดะฐัััั.

ะะฒัะพะผะฐัะธัะตัะบะธ ัะพะทะดะฐะฒะฐะตะผะฐั ััะฝะบัะธั ะบะพะฟะธัะพะฒะฐะฝะธั ะฟัะพััะพ ัะพะทะดะฐัั ะฝะพะฒัั ััััะบัััั ะธ
ะฟะตัะตะฝะพัะธั ะฒัะต ะบะพะผะฟะพะฝะตะฝัั ะธะท ััััะบัััั ะฐัะณัะผะตะฝัะฐ ะฒ ัะฒะตะถะต ัะพะทะดะฐะฒะฐะตะผัั
ััััะบัััั. ะะพะฟะธัะพะฒะฐะฝะธะต ัะฐะผะธั ะบะพะผะฟะพะฝะตะฝัะพะฒ ััััะบัััั ะฝะต ะฟัะพะธะทะฒะพะดะธััั.
ะกะพะพัะฒะตัััะฒัััะธะต ัะปะตะผะตะฝัั ััะฐัะพะน ะธ ะฝะพะฒะพะน ััััะบัััั ัะฐะฒะฝั \cdf{eql} ะผะตะถะดั ัะพะฑะพะน.

\item[\cd{:predicate}]
ะญัะฐ ะพะฟัะธั ะฟัะธะฝะธะผะฐะตั ะพะดะธะฝ ะฐัะณัะผะตะฝั, ะบะพัะพััะน ะทะฐะดะฐัั ะธะผั ะฟัะตะดะธะบะฐัะฐ ัะธะฟะฐ.
ะัะปะธ ะฐัะณัะผะตะฝั ะฝะต ัะบะฐะทะฐะฝ, ะธะปะธ ะตัะปะธ ะฝะต ัะบะฐะทะฐะฝะฐ ะพะฟัะธั, ัะพ ะธะผั ะฟัะตะดะธะบะฐัะฐ ัะพะทะดะฐัััั
ัะพะตะดะธะฝะตะฝะธะตะผ ะธะผะตะฝะธ ััััะบัััั ะธ ัััะพะบะธ \cd{"-P"}, ะฟะพะผะตัะฐั ะธะผั ะฒ ัะตะบััะธะน ะฟะฐะบะตั ะฝะฐ
ะผะพะผะตะฝั ะฒััะธัะปะตะฝะธั ัะพัะผั \cdf{defstruct} (ัะผะพััะธัะต \cdf{*package*}).
ะัะปะธ ัะบะฐะทะฐะฝะฝัะน ะฐัะณัะผะตะฝั ัะฐะฒะตะฝ {\false}, ะฟัะตะดะธะบะฐั ะฝะต ัะพะทะดะฐัััั.
ะัะตะดะธะบะฐั ะผะพะถะตั ะฑััั ะพะฟัะตะดะตะปัะฝ, ัะพะปัะบะพ ะตัะปะธ ััััะบัััะฐ ะธะผะตะตั <<ะธะผั>>.
ะัะปะธ ัะบะฐะทะฐะฝะฐ ะพะฟัะธั \cd{:type} ะธ ะฝะต ัะบะฐะทะฐะฝะฐ \cd{:named}, ัะพะณะดะฐ ะพะฟัะธั
\cd{:predicate} ะฝะต ะดะพะปะถะฝะฐ ะธัะฟะพะปัะทะพะฒะฐัััั ะธะปะธ ะดะพะปะถะฝะฐ ะธะผะตัั ะทะฝะฐัะตะฝะธะต {\false}.

\item[\cd{:include}]
ะญัะฐ ะพะฟัะธั ะธัะฟะพะปัะทัะตััั ะดะปั ัะพะทะดะฐะฝะธั ะฝะพะฒะพะณะพ ะพะฟัะตะดะตะปะตะฝะธั ััััะบัััั ะบะฐะบ ัะฐััะธัะตะฝะธั
ะดะปั ััะฐัะพะณะพ ะพะฟัะตะดะตะปะตะฝะธั ััััะบัััั. ะ ะบะฐัะตััะฒะต ะฟัะธะผะตัะฐ, ะฟัะตะดะฟะพะปะพะถะธะผ ั ะฒะฐั ะตััั
ััััะบัััะฐ, ะฝะฐะทัะฒะฐะตะผะฐั \cdf{person}, ะบะพัะพัะฐั ะฒัะณะปัะดะธั ัะฐะบ:
\begin{lisp}
(defstruct person name age sex)
\end{lisp}
ะขะตะฟะตัั, ะฟัะตะดะฟะพะปะพะถะธะผ, ะฒั ัะพัะธัะต ัะพะทะดะฐัั ะฝะพะฒัั ััััะบัััั ะดะปั ะฟัะตะดััะฐะฒะปะตะฝะธั
ะฐัััะพะฝะฐะฒัะฐ.
ะขะฐะบ ะบะฐะบ ะฐัััะพะฝะฐะฒั ัะฐะบะถะต ัะตะปะพะฒะตะบ, ะฒั ัะพัะธัะต, ััะพะฑั ะพะฝ ัะฐะบะถะต ะธะผะตะป ัะฒะพะนััะฒะฐ ะธะผั,
ะฒะพะทัะฐัั ะธ ะฟะพะป, ะธ ะฒั ัะพัะธัะต ััะพะฑั Lisp'ะพะฒัะต ััะฝะบัะธะธ ัะฐะฑะพัะฐะปะธ ัะพ ััััะบัััะฐะผะธ \cdf{astronaut}
ัะฐะบะถะต ะบะฐะบ ะธ ั ััััะบัััะฐะผะธ \cdf{person}. ะั ะผะพะถะตัะต ัะดะตะปะฐัั ััะพ ะพะฟัะตะดะตะปะธะฒ
ััััะบัััั \cdf{astronaut} ั ะพะฟัะธะตะน \cd{:include}, ัะฐะบ:
\begin{lisp}
(defstruct (astronaut (:include person) \\
~~~~~~~~~~~~~~~~~~~~~~(:conc-name astro-)) \\
~~~helmet-size \\
~~~(favorite-beverage 'tang))
\end{lisp}

ะะฟัะธั \cd{:include} ะทะฐััะฐะฒะปัะตั ััััะบัััั, ะฑัะดััะธ ะพะฟัะตะดะตะปัะฝะฝะพะน, ะธะผะตัั ัะต ะถะต ัะปะพัั,
ััะพ ะธ ะฒะบะปััะฐะตะผะฐั ััััะบัััะฐ ะธะท ะพะฟัะธะธ.
ะญัะพ ะพัััะตััะฒะปัะตััั ั ะฟะพะผะพััั ัะพะณะพ, ััะพ ััะฝะบัะธะธ ะดะพัััะฟะฐ ะฒะบะปััะฐะตะผะพะน ััััะบัััั
ะฑัะดัั ัะฐะบะถะต ัะฐะฑะพัะฐัั ั ะพะฟัะตะดะตะปัะตะผะพะน ััััะบัััะพะน.
ะขะฐะบะธะผ ะพะฑัะฐะทะพะผ, ะฒ ััะพะผ ะฟัะธะผะตัะต, \cdf{astronaut} ะฑัะดะตั ะธะผะตัั ะฟััั ัะปะพัะพะฒ: ััะธ
ะพะฟัะตะดะตะปะตะฝั ะฒ \cdf{person} ะธ ะดะฒะฐ ะฒ ัะฐะผะพะผ \cdf{astronaut}.
ะคัะฝะบัะธะธ ะดะพัััะฟะฐ, ะพะฟัะตะดะตะปัะฝะฝัะต ั ะฟะพะผะพััั ััััะบัััั \cdf{person}, ะผะพะณัั ะฟัะธะผะตะฝััััั ะบ
ัะบะทะตะผะฟะปััะฐะผ ััััะบัััั \cdf{astronaut}, ะธ ะฑัะดัั ะบะพััะตะบัะฝะพ ัะฐะฑะพัะฐัั.
ะะพะปะตะต ัะพะณะพ, \cdf{astronaut} ะฑัะดะตั ะธะผะตัั ัะฒะพะธ ััะฝะบัะธะธ ะดะพัััะฟะฐ ะดะปั ะบะพะผะฟะพะฝะตะฝัะพะฒ
ัะฝะฐัะปะตะดะพะฒะฐะฝะฝัั ะพั ััััะบัััั \cdf{person}.
ะกะปะตะดัััะธะน ะฟัะธะผะตั ะธะปะปััััะธััะตั ัะพ, ะบะฐะบ ะฒั ะผะพะถะตัะต ะธัะฟะพะปัะทะพะฒะฐัั ััััะบัััั
\cd{astronaut}:
\begin{lisp}
(setq x (make-astronaut :name 'buzz \\
~~~~~~~~~~~~~~~~~~~~~~~~:age 45 \\
~~~~~~~~~~~~~~~~~~~~~~~~:sex t \\
~~~~~~~~~~~~~~~~~~~~~~~~:helmet-size 17.5)) \\
 \\
(person-name x) \EV\ buzz \\
(astro-name x) \EV\ buzz \\
\\
(astro-favorite-beverage x) \EV\ tang
\end{lisp}
ะะฐะทะปะธัะธะต ะผะตะถะดั ััะฝะบัะธัะผะธ ะดะพัััะฟะฐ \cdf{person-name} ะธ \cdf{astro-name} ะฒ ัะพะผ, ััะพ
\cdf{person-name} ะผะพะถะตั ะฑััั ะบะพััะตะบัะฝะพ ะฟัะธะผะตะฝะตะฝะฐ ะบ ะปัะฑะพะผั ัะบะทะตะผะฟะปััั
\cdf{person}, ะฒะบะปััะฐั \cdf{astronaut}, ัะพะณะดะฐ ะบะฐะบ \cdf{astro-name} ะผะพะถะตั ัะฐะฑะพัะฐัั
ัะพะปัะบะพ ั \cdf{astronaut}. (ะะตะฐะปะธะทะฐัะธั ะผะพะถะตั ะฟัะพะฒะตัััั ะธะปะธ ะฝะต ะฟัะพะฒะตัััั
ะบะพััะตะบัะฝะพะต ะธัะฟะพะปัะทะพะฒะฐัััั ัะฐะบะธั ััะฝะบัะธะน ะดะพัััะฟะฐ.)

ะ ะพะดะฝะพะน ัะพัะผะต \cdf{defstruct} ะผะพะถะตั ะธัะฟะพะปัะทะพะฒะฐัั ะฝะต ะฑะพะปะตะต ะพะดะฝะพะน ะพะฟัะธะธ
\cdf{:include}.
ะัะณัะผะตะฝั ะดะปั ะพะฟัะธะธ \cd{:include} ัะฒะปัะตััั ะพะฑัะทะฐัะตะปัะฝัะผ ะธ ะดะพะปะถะตะฝ ะฑััั ะธะผะตะฝะตะผ
ะพะฟัะตะดะตะปัะฝะฝะพะน ัะฐะฝะตะต ััััะบัััั. ะัะปะธ ััััะบัััะฐ, ะฑัะดััะธ ะพะฟัะตะดะตะปัะฝะฝะพะน, ะฝะต ะธะผะตะปะฐ
ะพะฟัะธะธ \cd{:type}, ัะพะณะดะฐ ะฝะฐัะปะตะดัะตะผะฐั ััััะบัััะฐ ัะฐะบะถะต ะฝะต ะดะพะปะถะฝะฐ ะฑัะปะฐ ัะพะดะตัะถะฐัั
ะพะฟัะธั \cd{:type}.
ะัะปะธ ััััะบัััะฐ, ะฑัะดััะธ ะพะฟัะตะดะตะปัะฝะฝะพะน, ะธะผะตะปะฐ ะพะฟัะธั \cd{:type}, ัะพะณะดะฐ ะฝะฐัะปะตะดัะตะผะฐั
ััััะบัััะฐ ะดะพะปะถะฝะฐ ะฑัะปะฐ ะธะผะตัั ะพะฟัะธั \cd{:type} ั ัะตะผ ะถะต ัะธะฟะพะผ.

ะัะปะธ ะพะฟัะธั \cd{:type} ะฝะต ัะบะฐะทะฐะฝะฐ, ัะพะณะดะฐ ะธะผั ััััะบัััั ััะฐะฝะพะฒะธัััั ะธะผะตะฝะตะผ ัะธะฟะฐ
ะดะฐะฝะฝัั. ะะพะปะตะต ัะพะณะพ, ัะธะฟ ะฑัะดะตั ัะฒะปัะตััั ะฟะพะดัะธะฟะพะผ ัะธะฟะฐ ััััะบัััั, ะพั ะบะพัะพัะพะน
ะฟัะพะธะทะพัะปะพ ะฝะฐัะปะตะดะพะฒะฐะฝะธะต. ะ ะฒััะตะฟัะธะฒะตะดัะฝะฝะพะผ ะฟัะธะผะตัะต, \cdf{astronaut} ัะฒะปัะตััั
ะฟะพะดัะธะฟะพะผ \cdf{person}. ะขะฐะบ,
\begin{lisp}
(typep (make-astronaut) 'person)
\end{lisp}
ะฝะพ ะธ ัะบะฐะทัะฒะฐะตั, ััะพ ะฒัะต ะพะฟะตัะฐัะธะธ ะฝะฐะด \cdf{person} ะฑัะดัั ัะฐะบะถะต ัะฐะฑะพัะฐัั ะดะปั
\cdf{astronaut}.

ะะฐะปะตะต ัะฐััะบะฐะทัะฒะฐะตััั ัััั ะฑะพะปะตะต ัะปะพะถะฝัะต ะฒะพะทะผะพะถะฝะพััะธ ะพะฟัะธะธ \cd{:include}.
ะะฝะพะณะดะฐ, ะบะพะณะดะฐ ะพะดะฝะฐ ััััะบัััะฐ ะฒะบะปััะฐะตั ะดััะณัั, ะฝะตะพะฑัะพะดะธะผะพ, ััะพะฑั ะทะฝะฐัะตะฝะธั
ะฟะพ-ัะผะพะปัะฐะฝะธั ะธะปะธ ะพะฟัะธะธ ัะปะพัะพะฒ ะธะท ัะพะดะธัะตะปััะบะพะน ััััะบัััั ะฟัะธ ะฝะฐัะปะตะดะพะฒะฐะฝะธะธ
ััะฐะปะธ ัะปะตะณะบะฐ ะดััะณะธะผะธ.  ะะพะฒะฐั ััััะบัััะฐ ะผะพะถะตั ะทะฐะดะฐัั ะทะฝะฐัะตะฝะธั ะฟะพ-ัะผะพะปัะฐะฝะธั ะธะปะธ
ะพะฟัะธะธ ะดะปั ะฝะฐัะปะตะดัะตะผัั ัะปะพัะพะฒ ะพัะปะธัะฝัะผะธ ะพั ัะพะดะธัะตะปััะบะธั, ั ะฟะพะผะพััั ะบะพะฝััััะบัะธะธ:
\begin{lisp}
(:include \emph{name} \emph{slot-description-1} \emph{slot-description-2} ...)
\end{lisp}
ะะฐะถะดะฐั ัะพัะผะฐ \emph{slot-description-j} ะดะพะปะถะฝะฐ ะธะผะตัั ะธะผั \emph{slot-name} ะธะปะธ
\emph{slot-keyword}, ัะฐะบะพะต ะถะต ะบะฐะบ ะฒ ัะพะดะธัะตะปััะบะพะน ััััะบัััะต.
ะัะปะธ \emph{slot-description-j} ะฝะต ะธะผะตะตั ัะพัะผั ะธะฝะธัะธะฐะปะธะทะฐัะธะธ \emph{default-init},
ัะพะณะดะฐ ะฒ ะฝะพะฒะพะน ััััะบัััะต ัะปะพั ัะฐะบะถะต ะฝะต ะฑัะดะตั ะธะผะตัั ะฟะตัะฒะพะฝะฐัะฐะปัะฝะพะณะพ ะทะฝะฐัะตะฝะธั. ะ
ะฟัะพัะธะฒะฝะพะผ ัะปััะฐะต ะตะณะพ ะฟะตัะฒะพะฝะฐัะฐะปัะฝะพะต ะทะฝะฐัะตะฝะธะต ะฑัะดะตั ะทะฐะผะตะฝะตะฝะพ ัะพัะผะพะน
\emph{default-init} ะธะท \emph{slot-description-j}.
ะะพัััะฟะฝัะน ะดะปั ะทะฐะฟะธัะธ ัะปะพั ะผะพะถะตั ะฑััั ะฟะตัะตะดะตะปะฐะฝ ะฒ ัะปะพั ัะพะปัะบะพ ะดะปั ััะตะฝะธั.
ะัะปะธ ัะปะพั ัะพะปัะบะพ ะดะปั ััะตะฝะธั ะฒ ัะพะดะธัะตะปััะบะพะน ััััะบัััะต, ัะพะณะดะฐ ะพะฝ ัะฐะบะถะต ะดะพะปะถะตะฝ ะฑััั
ัะพะปัะบะพ ะดะปั ััะตะฝะธั ะฒ ะดะพัะตัะฝะตะน.
ะัะปะธ ะดะปั ัะปะพัะฐ ัะบะฐะทะฐะฝ ัะธะฟ, ะพะฝ ะดะพะปะถะตะฝ ะฑััั ัะฐะบะธะผ ะถะต ะธะปะธ ะฟะพะดัะธะฟะพะผ ะฒ
ะดะพัะตัะฝะตะน ััััะบัััะต. ะัะปะธ ััะพ ัััะพะณะธะน ะฟะพะดัะธะฟ, ัะพ ัะตะฐะปะธะทะฐัะธั ะผะพะถะตั ะฟัะพะฒะตัััั ะธะปะธ
ะฝะต ะฟัะพะฒะตัััั ะพัะธะฑะบะธ ะฝะตัะพะฒะฟะฐะดะตะฝะธั ัะธะฟะพะฒ ะฟัะธ ะฟัะธัะฒะฐะธะฒะฐะฝะธะธ ะทะฝะฐัะตะฝะธะน ัะปะพัะฐะผ.

ะะฐะฟัะธะผะตั, ะตัะปะธ ะผั ัะพัะตะปะธ ะฑั ะพะฟัะตะดะตะปะธัั \cdf{astronaut} ัะฐะบ, ััะพะฑั ะฟะพ-ัะผะพะปัะฐะฝะธั
ะฒะพะทัะฐััะพะผ ะฐัััะพะฝะฐะฒัะฐ ะฑัะปะพ 45 ะปะตั, ัะพ ะผั ะผะพะณะปะธ ะฑั ัะบะฐะทะฐัั:
\begin{lisp}
(defstruct (astronaut (:include person (age 45))) \\
~~~helmet-size \\
~~~(favorite-beverage 'tang))
\end{lisp}

\item[\cd{:print-function}]
ะญัะฐ ะพะฟัะธั ะผะพะถะตั ะธัะฟะพะปัะทะพะฒะฐัััั, ัะพะปัะบะพ ะตัะปะธ ะฝะต ะพะฟัะธั \cd{:type} ะฝะต ะฑัะปะฐ ัะบะฐะทะฐะฝะฐ.
ะัะณัะผะตะฝั ะดะปั ะพะฟัะธะธ \cd{:print-function} ะดะพะปะถะตะฝ ะฑััั ััะฝะบัะธะตะน ัััั ะฐัะณัะผะตะฝัะพะฒ, ะฒ
ัะพัะผะต ะฟัะธะฝะธะผะฐะตะผะพะน ัะฟะตัะธะฐะปัะฝะพะน ัะพัะผะพะน \cdf{function}. ะญัะฐ ััะฝะบัะธั ะธัะฟะพะปัะทัะตััั
ะดะปั ะฒัะฒะพะดะฐ ัะฐััะผะฐััะธะฒะฐะตะผะพะน ััััะบัััั.
ะะพะณะดะฐ ััััะบัััะฐ ะฒัะฒะพะดะธััั ะฝะฐ ะบะพะฝัะพะปั, ะดะฐะฝะฝะฐั ััะฝะบัะธั ะฒัะทัะฒะฐะตััั ั ััะตะผั
ะฐัะณัะผะตะฝัะฐะผะธ:
ััััะบัััะฐ ะดะปั ะฟะตัะฐัะธ,
ะฟะพัะพะบ, ะฒ ะบะพัะพััะน ะฟัะพะธะทะฒะพะดะธัั ะฒัะฒะพะด,
ะธ ัะตะปะพะต ัะธัะปะพ, ะพัะพะฑัะฐะถะฐััะตะต ัะตะบัััั ะณะปัะฑะธะฝั (ะผะพะถะฝะพ ััะฐะฒะฝะธัั ั
\cdf{*print-level*}).
ะคัะฝะบัะธั ะฒัะฒะพะดะฐ ะดะพะปะถะฝะฐ ัะปะตะดะธัั ะทะฐ ะทะฝะฐัะตะฝะธัะผะธ ัะฐะบะธั ะฟะตัะตะผะตะฝะฝัั ะฝะฐัััะพะนะบะธ ะฒัะฒะพะดะฐ,
ะบะฐะบ \cdf{*print-escape*} ะธ \cdf{*print-pretty*}.

ะัะปะธ ะพะฟัะธะธ \cd{:print-function} ะธ \cd{:type} ะฝะต ัะบะฐะทะฐะฝั, ัะพะณะดะฐ ััะฝะบัะธั ะฒัะฒะพะดะฐ
ะฟะพ-ัะผะพะปัะฐะฝะธั ะฒัะฒะพะดะธั ะฒัะต ัะปะพัั ะธัะฟะพะปัะทัั ัะธะฝัะฐะบัะธั \cd{\#S} (ัะผะพััะธัะต
ัะฐะทะดะตะป~\ref{SHARP-SIGN-MACRO-CHARACTER-SECTION}).

\item[\cd{:type}]
ะะฟัะธั \cd{:type} ัะฒะฝะพ ะทะฐะดะฐัั ะฟัะตะดััะฐะฒะปะตะฝะธะต ะธัะฟะพะปัะทัะตะผะพะต ะดะปั ััััะบัััั. ะะฝะฐ
ะฟัะธะฝะธะผะฐะตั ะพะดะธะฝ ะฐัะณัะผะตะฝั, ะบะพัะพััะน ะดะพะปะถะตะฝ ะฑััั ะพะดะฝะธะผ ะธะท ะฟะตัะตัะธัะปะตะฝะฝัั ะฝะธะถะต.

ะะฐะดะฐะฝะธะต ััะพะน ะพะฟัะธะธ ะทะฐััะฐะฒะปัะตั ะธัะฟะพะปัะทะพะฒะฐัั ัะบะฐะทะฐะฝะฝะพะต ะฟัะตะดััะฐะฒะปะตะฝะธะต ะธ
ะทะฐััะฐะฒะปัะตั ะบะพะผะฟะพะฝะตะฝัั ะฑััั ัะฐะทะผะตััะฝะฝัะผะธ ะฒ ะฟะพััะดะบะต, ะฟัะตะดััะผะพััะตะฝะฝะพะผ
ะฒ \cdf{defstruct} ัะพัะผะต,
ะฒ ัะพะพัะฒะตัััะฒัััะธะต ะฟะพัะปะตะดะพะฒะฐัะตะปัะฝัะต ัะปะตะผะตะฝัั ัะบะฐะทะฐะฝะฝะพะณะพ ะฟัะตะดััะฐะฒะปะตะฝะธั.
ะะฟัะธั ัะฐะบะถะต ะพัะบะปััะฐะตั ะฒะพะทะผะพะถะฝะพััั ะธะผะตะฝะธ ััััะบัััั ััะฐัั ะธะผะตะฝะตะผ ัะธะฟะฐ.
(ัะผะพััะธัะต ัะฐะทะดะตะป~\ref{EXPLICIT-TYPE-STRUCTURES}).

ะะฑััะฝะพ ััะฐ ะพะฟัะธั ะฝะต ะธัะฟะพะปัะทัะตััั, ะธ ัะพะณะดะฐ ััััะบัััะฐ ะฟัะตะดััะฐะฒะปัะตััั ัะฐะบ, ะบะฐะบ
ะฟัะตะดััะผะพััะตะฝะพ ะฒ ัะตะฐะปะธะทะฐัะธะธ.

\begin{quotation}    % Merely to advance the left margin
\begin{flushdesc}

\item[\cdf{vector}]
ะกัััะบัััะฐ ะฟัะตะดััะฐะฒะปัะตััั ะบะฐะบ ะฒะตะบัะพั \cd{(vector t)}. ัะฐะทะผะตัะฐั
ะบะพะผะฟะพะฝะตะฝัั ะบะฐะบ ัะปะตะผะตะฝัั ะฒะตะบัะพัะฐ. ะะตัะฒัะน ะบะพะผะฟะพะฝะตะฝั ะฝะฐัะพะดะธััั ะฒ ะฟะตัะฒะพะผ
ัะปะตะผะตะฝัะต ะฒะตะบัะพัะฐ, ะตัะปะธ ััััะบัััะฐ ัะพะดะตัะถะธั ะพะฟัะธั \cd{:named}, ะธ ะฒ ะฝัะปะตะฒะพะผ, ะตัะปะธ
ััััะบัััะฐ ัะพะดะตัะถะธั \cd{:unnamed}.

\item[\cd{(vector \emph{element-type})}]
ะกัััะบัััะฐ ะฟัะตะดััะฐะฒะปัะตััั ะบะฐะบ (ะฒะพะทะผะพะถะฝะพ ัะฟะตัะธะฐะปะธะทะธัะพะฒะฐะฝะฝัะน) ะฒะตะบัะพั, ัะฐะทะผะตัะฐั
ะบะพะผะฟะพะฝะตะฝัั ะบะฐะบ ัะปะตะผะตะฝัั ะฒะตะบัะพัะฐ. ะะฐะถะดัะน ะบะพะผะฟะพะฝะตะฝั ะดะพะปะถะตะฝ ะฟัะธะฝะฐะดะปะตะถะฐัั ัะธะฟั,
ะบะพัะพััะน ะผะพะณ ะฑััั ัะบะฐะทะฐะฝ ะดะปั ะฒะตะบัะพัะฐ. ะะตัะฒัะน ะบะพะผะฟะพะฝะตะฝั ะฝะฐัะพะดะธััั ะฒ ะฟะตัะฒะพะผ
ัะปะตะผะตะฝัะต ะฒะตะบัะพัะฐ, ะตัะปะธ ััััะบัััะฐ ัะพะดะตัะถะธั ะพะฟัะธั \cd{:named}, ะธ ะฒ ะฝัะปะตะฒะพะผ, ะตัะปะธ
ััััะบัััะฐ ัะพะดะตัะถะธั \cd{:unnamed}.
ะกัััะบัััะฐ ะผะพะถะตั ะฑััั \cd{:named}, ัะพะปัะบะพ ะตัะปะธ ัะธะฟ \cdf{symbol} ัะฒะปัะตััั ะฟะพะดัะธะฟะพะผ
ัะบะฐะทะฐะฝะฝะพะณะพ ะฒ \cdf{element-type}.

\item[\cdf{list}]
ะกัััะบัััะฐ ะฟัะตะดััะฐะฒะปัะตััั ะบะฐะบ ัะฟะธัะพะบ.
ะะตัะฒัะน ะบะพะผะฟะพะฝะตะฝั ัะฒะปัะตััั \emph{cadr} ัะปะตะผะตะฝัะพะผ, ะตัะปะธ ััััะบัััะฐ ัะพะดะตัะถะธั \cd{:named}, ะธ
ัะฒะปัะตััั \emph{car} ัะปะตะผะตะฝัะพะผ, ะตัะปะธ ััััะบัััะฐ ัะพะดะตัะถะธั \cd{:unnamed}.
\end{flushdesc}
\end{quotation}

\item[\cd{:named}]
ะะฟัะธั \cd{:named} ัะบะฐะทัะฒะฐะตั, ััะพ ััััะบัััะฐ ะฑัะดะตั ะธะผะตัั <<ะธะผั>>. ะญัะฐ ะพะฟัะธั ะฝะต
ะฟัะธะฝะธะผะฐะตั ะฐัะณัะผะตะฝัะพะฒ. ะัะปะธ ะพะฟัะธั \cd{:type} ะฝะต ัะบะฐะทะฐะฝะฐ, ัะพะณะดะฐ ััััะบัััะฐ ะธะผะตะตั
ะธะผั. ะขะฐะบะธะผ ะพะฑัะฐะทะพะผ ััะฐ ะพะฟัะธั ะฟะพะปะตะทะฝะพ ัะพะปัะบะพ ะฟัะธ ะธัะฟะพะปัะทะพะฒะฐะฝะธะธ ะฒะผะตััะต ะพะฟัะธะตะน
\cd{:type}.
ะกะผะพััะธัะต ัะฐะทะดะตะป~\ref{EXPLICIT-TYPE-STRUCTURES} ะดะปั ะฟะพะดัะพะฑะฝะพะณะพ ะพะฟะธัะฐะฝะธั ััะพะน
ะพะฟัะธะธ.

\item[\cd{:initial-offset}]
ะญัะฐ ะพะฟัะธั ะฟะพะทะฒะพะปัะตั ะฒะฐะผ ัะบะฐะทะฐัั \cdf{defstruct} ะฟัะพะฟัััะธัั ัะบะฐะทะฐะฝะฝะพะต ะบะพะปะธัะตััะฒะพ
ัะปะพัะพะฒ, ะฟะตัะตะด ัะตะผ ะบะฐะบ ะฝะฐัะธะฝะฐัั ัะฐะทะผะตัะฐัั ัะบะฐะทะฐะฝะฝัะต ะฒ ัะตะปะต ัะปะพัั. ะญัะฐ ะพะฟัะธั
ััะตะฑัะตั ะฐัะณัะผะตะฝั, ะฐ ะธะผะตะฝะฝะพ, ะฝะตะพััะธัะฐัะตะปัะฝะพะต ัะตะปะพะต, ะพะฑะพะทะฝะฐัะฐััะตะต ะบะพะปะธัะตััะฒะพ
ะฟัะพะฟััะบะฐะตะผัั ัะปะพัะพะฒ.
ะะฟัะธั \cd{:initial-offset} ะผะพะถะตั ะธัะฟะพะปัะทะพะฒะฐัััั, ัะพะปัะบะพ ะตัะปะธ ัะฐะบะถะต ัะบะฐะทะฐะฝะฐ ะพะฟัะธั
\cd{:type}.
ะกะผะพััะธัะต ัะฐะทะดะตะป~\ref{DEFSTRUCTU-INIITAL-OFFSET} ะดะปั ะฟะพะดัะพะฑะฝะพะณะพ ะพะฟะธัะฐะฝะธั ััะพะน
ะพะฟัะธะธ.
\end{flushdesc}

\section{ะคัะฝะบัะธะธ-ะบะพะฝััััะบัะพัั ั ะฟะพะทะธัะธะพะฝะฝัะผะธ ะฐัะณัะผะตะฝัะฐะผะธ}
\label{DEFSTRUCT-CONSTRUCTOR-SYNTAX}

ะัะปะธ ะพะฟัะธั \cd{:constructor} ัะบะฐะทะฐะฝะฐ ัะฐะบ \cd{(\cd{:constructor} \emph{name}
  \emph{arglist})}, ัะพะณะดะฐ ะฒะผะตััะพ ัะพะทะดะฐะฝะธั ะบะพะฝััััะบัะพัะฐ ั ะธะผะตะฝะพะฒะฐะฝะฝัะผะธ
ะฟะฐัะฐะผะตััะฐะผะธ, \cdf{defstruct} ะพะฟัะตะดะตะปะธั ะบะพะฝััััะบัะพั ั ะฟะพะทะธัะธะพะฝะฝัะผะธ ะฐัะณัะผะตะฝัะฐะผะธ.
ะคะพัะผะฐ \emph{arglist} ะธัะฟะพะปัะทัะตััั ะดะปั ะพะฟะธัะฐะฝะธั ัะพะณะพ, ะบะฐะบะธะต ะฐัะณัะผะตะฝัั ะฑัะดะตั
ะฟัะธะฝะธะผะฐัั ะบะพะฝััััะบัะพั. ะ ะฟัะพััะตะนัะตะผ ัะปััะฐะต ััะพ-ัะพ ะฒัะพะดะต \cd{(\cd{:constructor}
  make-foo (a b c))} ะพะฟัะตะดะตะปัะตั ััะฝะบัะธั \cdf{make-foo} ั ััะตะผั ะฐัะณัะผะตะฝัะฐะผะธ,
ะบะพัะพััะต ะธัะฟะพะปัะทััััั ะดะปั ะธะฝะธัะธะฐะปะธะทะฐัะธะธ ัะปะพัะพะฒ \cdf{a}, \cdf{b} ะธ \cdf{c}.

ะัะพะผะต ัะพะณะพ ะฒ ัะฟะธัะพะบ ะฐัะณัะผะตะฝัะพะฒ ะผะพะณัั ะธัะฟะพะปัะทะพะฒะฐัััั \cd{\&optional}, \cd{\&rest}
ะธ \cd{\&aux}. ะะฝะธ ัะฐะฑะพัะฐัั ัะฐะบ, ะบะฐะบ ะธ ะพะถะธะดะฐะตััั, ะฝะพ ะตััั ะฝะตัะบะพะปัะบะพ ัะพะฝะบะพััะตะน
ะดะพััะพะนะฝัั ะพะฑัััะฝะตะฝะธั. ะะฐััะผะพััะธะผ ะฟัะธะผะตั:
\begin{lisp}
(\cd{:constructor} create-foo \\
~~~~~~~~(a \&optional b (c 'sea) \&rest d \&aux e (f 'eff)))
\end{lisp}
ะญัะฐ ะบะพะฝััััะบัะธั ะพะฟัะตะดะตะปัะตั ะบะพะฝััััะบัะพั \cdf{create-foo} ะดะปั ะธัะฟะพะปัะทะพะฒะฐะฝะธั ั
ะพะดะฝะธะผ ะธะปะธ ะฑะพะปะตะต ะฐัะณัะผะตะฝัะฐะผะธ. ะะตัะฒัะน ะฐัะณัะผะตะฝั ะธัะฟะพะปัะทัะตััั ะดะปั ะธะฝะธัะธะฐะปะธะทะฐัะธะธ
ัะปะพัะฐ \cdf{a}. ะัะปะธ ะฒัะพัะพะน ะฟะฐัะฐะผะตัั ะฝะต ัะบะฐะทะฐะฝ, ะธัะฟะพะปัะทัะตััั ะทะฝะฐัะตะฝะธะต (ะตัะปะธ
ัะบะฐะทะฐะฝะพ) ะฟะพ-ัะผะพะปัะฐะฝะธั ะธะท ัะตะปะฐ \cdf{defstruct}. ะขัะตัะธะน ะฐัะณัะผะตะฝั ะธัะฟะพะปัะทัะตััั ะดะปั
ะธะฝะธัะธะฐะปะธะทะฐัะธะธ ัะปะพัะฐ \cdf{c}. ะัะปะธ ััะตัะธะน ะฟะฐัะฐะผะตัั ะฝะต ัะบะฐะทะฐะฝ, ัะพะณะดะฐ ะธัะฟะพะปัะทัะตััั
ัะธะผะฒะพะป \cdf{sea}. ะัะต ะฟะฐัะฐะผะตััั ะฟะพัะปะต ััะตััะตะณะพ ัะพะฑะธัะฐัััั ะฒ ัะฟะธัะพะบ ะธ
ะธัะฟะพะปัะทััััั ะดะปั ะธะฝะธัะธะฐะปะธะทะฐัะธะธ ัะปะพัะฐ \cdf{d}. ะัะปะธ ัะบะฐะทะฐะฝะพ ััะธ ะธ ะฑะพะปะตะต
ะฟะฐัะฐะผะตััะพะฒ, ัะพะณะดะฐ ะฒ ัะปะพั \cdf{d} ะฟะพะผะตัะฐะตััั ะทะฝะฐัะตะฝะธะต {\false}. ะกะปะพั \cdf{e}
\emph{ะฝะต ะธะฝะธัะธะฐะปะธะทะธััะตััั}. ะะณะพ ะฟะตัะฒะพะฝะฐัะฐะปัะฝะพะต ะทะฝะฐัะตะฝะธะต ะฝะต ะพะฟัะตะดะตะปะตะฝะพ. ะะฐะบะพะฝะตั,
ัะปะพั \cdf{f} ะธะฝะธัะธะฐะปะธะทะธััะตััั ัะธะผะฒะพะปะพะผ \cdf{eff}.

ะะตะนััะฒะธั ัะพ ัะปะพัะฐะผะธ \cdf{b} ะธ \cdf{e} ะฒัะฑัะฐะฝั ะฝะต ัะปััะฐะนะฝะพ, ะฐ ะดะปั ัะพะณะพ ััะพะฑั
ะฟะพะบะฐะทะฐัั ะฒัะต ะฒะพะทะผะพะถะฝัะต ัะปััะฐะธ ะธัะฟะพะปัะทะพะฒะฐะฝะธั ะฐัะณัะผะตะฝัะพะฒ.
ะกะปะตะดัะตั ะพัะผะตัะธัั, ััะพ \cd{\&aux} (ะฒัะฟะพะผะพะณะฐัะตะปัะฝัะต) <<ะฟะตัะตะผะตะฝะฝัะต>> ะผะพะณัั
ะธัะฟะพะปัะทะพะฒะฐัััั ะดะปั ะฟะตัะตะบัััะธั ัะพัะผ ะธะฝะธัะธะฐะปะธะทะฐัะธะธ ะธะท ัะตะปะฐ \cdf{defstruct}.

ะกะปะตะดัั ััะพะผั ะพะฟัะตะดะตะปะตะฝะธั ะผะพะถะฝะพ ะทะฐะฟะธัะฐัั
\begin{lisp}
(create-foo 1 2)
\end{lisp}
ะฒะผะตััะพ
\begin{lisp}
(make-foo \cd{:a} 1 \cd{:b} 2)
\end{lisp}
ะธ, ะบะพะฝะตัะฝะพ, \cdf{create-foo} ะฟัะตะดะพััะฐะฒะปัะตั ะธะฝะธัะธะฐะปะธะทะฐัะธั ะพัะปะธัะฝัั ะพั
\cdf{make-foo}.

ะัะฟะพะปัะทะพะฒะฐัั \cd{:constructor} ะผะพะถะฝะพ ะฑะพะปะตะต ะพะดะฝะพะณะพ ัะฐะทะฐ. ะขะฐะบะธะผ ะพะฑัะฐะทะพะผ ะฒั ะผะพะถะตัะต
ะพะฟัะตะดะตะปะธัั ะฝะตัะบะพะปัะบะพ ัะฐะทะปะธัะฝัั ััะฝะบัะธะน-ะบะพะฝััััะบัะพัะพะฒ ั ัะฐะทะปะธัะฝัะผะธ ะฐัะณัะผะตะฝัะฐะผะธ.

\section{ะกัััะบัััั ั ัะฒะฝะพ ะทะฐะดะฐะฝะฝัะผ ัะธะฟะพะผ ะฟัะตะดััะฐะฒะปะตะฝะธั}
\label{EXPLICIT-TYPE-STRUCTURES}

ะะฝะพะณะดะฐ ะฝะตะพะฑัะพะดะธะผะพ ัะฒะฝะพ ะบะพะฝััะพะปะธัะพะฒะฐัั ะฟัะตะดััะฐะฒะปะตะฝะธะต ััััะบัััั. ะะฟัะธั \cd{:type}
ะฟะพะทะฒะพะปัะตั ะฒัะฑัะฐัั ะฟัะตะดััะฐะฒะปะตะฝะธะต ะผะตะถะดั ัะฟะธัะบะพะผ ะธะปะธ ะฝะตะบะพัะพััะผ ะฒะธะดะพะผ ะฒะตะบัะพัะฐ ะธ
ัะบะฐะทะฐัั ัะพะพัะฒะตััะฒะธะต ะดะปั ัะฐะทะผะตัะตะฝะธั ัะปะพัะพะฒ ะฒ ะฒัะฑัะฐะฝะฝะพะผ ะฟัะตะดััะฐะฒะปะตะฝะธะธ.
ะกัััะบัััะฐ ัะฐะบะถะต ะผะพะถะตั ะฑััั <<ะฑะตะทัะผัะฝะฝะพะน>> ะธะปะธ <<ะธะผะตะฝะพะฒะฐะฝะฝะพะน>>. ะญัะพ ะพะทะฝะฐัะฐะตั
ะผะพะถะตั ะปะธ ะธะผั ััััะบัััั ะฑััั ัะพััะฐะฝะตะฝะพ ะฒ ะฝะตะน ัะฐะผะพะน (ะธ ัะพะพัะฒะตัััะฒะตะฝะฝะพ, ะฟัะพัะธัะฐะฝะพ
ะธะท ะฝะตั).

\subsection{ะะตะทัะผัะฝะฝัะต ััััะบัััั}

ะะฝะพะณะดะฐ ะบะพะฝะบัะตัะฝะพะต ะฟัะตะดััะฐะฒะปะตะฝะธะต ะดะฐะฝะฝัั ะฝะฐะฒัะทัะฒะฐะตััั ะฒะฝะตัะฝะธะผะธ ััะตะฑะพะฒะฐะฝะธัะผะธ ะธ,
ะบัะพะผะต ัะพะณะพ, ัะพัะผะฐั ะดะฐะฝะฝัั ะฟัะตะบัะฐัะฝะพ ะปะพะถะธััั ะฒ ััััะบัััะฝัะน ััะธะปั ััะฐะฝะตะฝะธั.
ะะฐะฟัะธะผะตั, ัะฐััะผะพััะธะผ ะฒััะฐะถะตะฝะธะต ัะพะทะดะฐะฝะฝะพะต ะธะท ัะธัะตะป, ัะธะผะฒะพะปะพะฒ ะธ ัะฐะบะธั ะพะฟะตัะฐัะธะน ะบะฐะบ
\cdf{+} ะธ \cdf{*}. ะะฟะตัะฐัะธั ะผะพะถะตั ะฑััั ะฟัะตะดััะฐะฒะปะตะฝะฐ, ะบะฐะบ ะฒ Lisp'ะต, ัะฟะธัะบะพะผ ะธะท
ะพะฟะตัะฐัะพัะฐ ะธ ะดะฒัั ะพะฟะตัะฐะฝะดะพะฒ. ะญัะพั ัะฐะบั ะผะพะถะตั ะฑััั ะฒััะฐะถะตะฝ ะบัะฐัะบะพ ะฒ ัะตัะผะธะฝะฐั
\cdf{defstruct}:
ะต\begin{lisp}
(defstruct (binop (:type list)) \\
~~(operator '? :type symbol) \\
~~operand-1 \\
~~operand-2)
\end{lisp}

ะะตะทัะปััะฐัะพะผ ะฒัะฟะพะปะฝะตะฝะธั \cdf{make-binop} ัะฒะปัะตััั 3-ัั ัะปะตะผะตะฝัะฝัะน ัะฟะธัะพะบ:
\begin{lisp}
(make-binop :operator '+ :operand-1 'x :operand-2 5) \\*
~~~\EV\ (+ x 5) \\
\\
(make-binop :operand-2 4 :operator '*) \\*
~~~\EV\ (* {\nil} 4)
\end{lisp}
ะัะณะปัะดะธั ะบะฐะบ ััะฝะบัะธั \cdf{list} ะทะฐ ะธัะบะปััะตะฝะธะตะผ ัะพะณะพ, ััะพ ะฟัะธะฝะธะผะฐะตั ะธะผะตะฝะพะฒะฐะฝะฝัะต
ะฟะฐัะฐะผะตััั ะธ ะฒัะฟะพะปะฝัะตั ะธะฝะธัะธะฐะปะธะทะฐัะธั ัะปะพัะพะฒ ัะพะพัะฒะตัััะฒััััั ะบะพะฝัะตะฟััะฐะปัะฝะพะผั ัะธะฟั
ะดะฐะฝะฝัั \cdf{binop}.
ะขะฐะบะธะผ ะถะต ะพะฑัะฐะทะพะผ, ัะตะปะตะบัะพัั \cdf{binop-operator}, \cdf{binop-operand-1} ะธ
\cdf{binop-operand-2} ัะบะฒะธะฒะฐะปะตะฝัะฝั ัะพะพัะฒะตัััะฒะตะฝะฝะพ \cdf{car}, \cdf{cadr} ะธ
\cdf{caddr}. (ะะฝะธ, ะบะพะฝะตัะฝะพ, ะฝะต ะฟะพะปะฝะพัััั ัะบะฒะธะฒะฐะปะตะฝัะฝั, ัะฐะบ ะบะฐะบ ัะตะฐะปะธะทะฐัะธั
ะผะพะถะตั ะพัััะตััะฒะปััั ะฟัะพะฒะตัะบะธ ัะธะฟะพะฒ ัะปะตะผะตะฝัะพะฒ, ะดะปะธะฝั ะผะฐััะธะฒะพะฒ ะฟัะธ ะธัะฟะพะปัะทะพะฒะฐะฝะธะธ
ัะตะปะตะบัะพัะพะฒ ัะปะพัะพะฒ ััััะบััั.)

ะั ะณะพะฒะพัะธะผ ะพ \cdf{binop} ะบะฐะบ ะพ <<ะบะพะฝัะตะฟััะฐะปัะฝะพะผ>> ัะธะฟะต ะดะฐะฝะฝัั, ะฟะพัะพะผั ััะพ
\cdf{binop} ะฝะต ะฟัะธะฝะฐะดะปะตะถะธั Common Lisp'ะพะฒะพะน ัะธััะตะผะต ัะธะฟะพะฒ. ะัะตะดะธะบะฐั \cdf{typep}
ะฝะต ะผะพะถะตั ะธัะฟะพะปัะทะพะฒะฐัั \cdf{binop} ะบะฐะบ ัะฟะตัะธัะธะบะฐัะพั ัะธะฟะฐ, ะธ \cdf{type-of} ะฑัะดะตั
ะฒะพะทะฒัะฐัะฐัั \cdf{list} ะดะปั ะทะฐะดะฐะฝะฝะพะน \cdf{binop} ััััะบัััั. ะะตัะพะผะฝะตะฝะฝะพ, ัะฐะทะปะธัะธะน
ะผะตะถะดั ััััะบัััะพะน ะดะฐะฝะฝัั, ัะพะทะดะฐะฝะฝะพะน ั ะฟะพะผะพััั \cdf{make-binop}, ะธ  ะฟัะพัััะผ
ัะฟะธัะบะพะผ ะฝะตั.

ะะตะฒะพะทะผะพะถะฝะพ ะดะฐะถะต ะฟะพะปััะธัั ะธะผั ััััะบัััั ะดะปั ะพะฑัะตะบัะฐ, ัะพะทะดะฐะฝะฝะพะณะพ ั ะฟะพะผะพััั
\cdf{make-binop}. ะะดะฝะฐะบะพ ะธะผั ะผะพะถะตั ะฑััั ัะพััะฐะฝะตะฝะพ ะธ ะฟะพะปััะตะฝะพ, ะตัะปะธ ััััะบัััะฐ
ัะพะดะตัะถะธั <<ะธะผั>>.

\subsection{ะะผะตะฝะพะฒะฐะฝะฝัะต ััััะบัััั}

ะกัััะบัััะฐ ั <<ะธะผะตะฝะตะผ>> ะธะผะตะตั ัะฒะพะนััะฒะพ, ะบะพัะพัะพะต ะทะฐะบะปััะฐะตััั ะฒ ัะพะผ, ััะพ ะดะปั ะปัะฑะพะณะพ
ัะบะทะตะผะฟะปััะฐ ััััะบัััั ะผะพะถะฝะพ ะฟะพะปััะธัั ะธะผั ััะพะน ััััะบัััั. ะะปั ััััะบััั
ะพะฟัะตะดะตะปัะฝะฝัั ะฑะตะท ัะบะฐะทะฐะฝะธั ะพะฟัะธะธ \cd{:type}, ะธะผั ััััะบัััั ัะฐะบัะธัะตัะบะธ ััะฐะฝะพะฒะธััั
ัะฐัััั Common Lisp'ะพะฒะพะน ัะธััะตะผั ัะธะฟะพะฒ. ะคัะฝะบัะธั \cdf{type-of} ะฟัะธ ะฟัะธะผะตะฝะตะฝะธะธ ะบ
ัะบะทะตะผะฟะปััั ัะฐะบะพะน ััััะบัััั ะฑัะดะตั ะฒะพะทะฒัะฐัะฐัั ะธะผั ััััะบัััั. ะัะตะดะธะบะฐั \cdf{typep}
ะฑัะดะตั ัะฐััะผะฐััะธะฒะฐัั ะธะผั ััััะบัััั, ะบะฐะบ ะบะพััะตะบัะฝัะน ัะฟะตัะธัะธะบะฐัะพั ัะธะฟะฐ.

ะะปั ััััะบััั ะพะฟัะตะดะตะปัะฝะฝัั ั ะพะฟัะธะตะน \cd{:type}, \cdf{type-of} ะฑัะดะตั ะฒะพะทะฒัะฐัะฐัั
ัะฟะตัะธัะธะบะฐัะพั ัะธะฟะฐ ะพะดะธะฝ ะธะท \cdf{list} ะธะปะธ \cdf{(vector t)}, ะฒ ะทะฐะฒะธัะธะผะพััะธ ะพั
ัะบะฐะทะฐะฝะฝะพะณะพ ะฐัะณัะผะตะฝัะฐ ะพะฟัะธะธ \cd{:type}.
ะะผั ััััะบัััั ะฝะต ััะฐะฝะพะฒะธััั ะบะพััะตะบัะฝัะผ ัะฟะตัะธัะธะบะฐัะพัะพะผ ัะธะฟะฐ. ะะดะฝะฐะบะพ ะตัะปะธ ัะฐะบะถะต
ัะบะฐะทะฐะฝะฐ ะพะฟัะธั \cd{:named}, ัะพะณะดะฐ ะฟะตัะฒัะน ะบะพะผะฟะพะฝะตะฝั ััััะบัััั ะฒัะตะณะดะฐ ัะพะดะตัะถะธั ะตั
ะธะผั. ะญัะพ ะฟะพะทะฒะพะปัะตั ะฟะพะปััะธัั ััะพ ะธะผั, ะธะผะตั ัะพะปัะบะพ ัะบะทะตะผะฟะปัั ััััะบัััั. ะญัะพ ัะฐะบะถะต
ะฟะพะทะฒะพะปัะตั ะฐะฒัะพะผะฐัะธัะตัะบะธ ะพะฟัะตะดะตะปะธัั ะฟัะตะดะธะบะฐั ะดะปั ะบะพะฝัะตะฟััะฐะปัะฝะพะณะพ ัะธะฟะฐ.
ะัะตะดะธะบะฐั \cd{\emph{name}-p} ะดะปั ััััะบัััั ะฟัะธะฝะธะผะฐะตั ะฒ ะบะฐัะตััะฒะต ะฟะตัะฒะพะณะพ ะฐัะณัะผะตะฝัะฐ
ะพะฑัะตะบั ะธ ะธััะธะฝะตะฝ, ะตัะปะธ ะพะฑัะตะบั ัะฒะปัะตััั ัะบะทะตะผะฟะปััะพะผ ััััะบัััั, ะธะฝะฐัะต ะปะพะถะตะฝ.

ะะฐััะผะพััะธะผ ะฒััะตัะฟะพะผัะฝัััะน ะฟัะธะผะตั \cdf{binop} ะธ ะผะพะดะธัะธัะธััะตะผ ะตะณะพ, ะดะพะฑะฐะฒะธะฒ
ะพะฟัะธั \cd{:named}:
\begin{lisp}
(defstruct (binop (:type list) :named) \\
~~(operator '? :type symbol) \\
~~operand-1 \\
~~operand-2)
\end{lisp}
ะะฐะบ ะธ ัะฐะฝััะต, ะบะพะฝััััะบัะธั ะพะฟัะตะดะตะปะธัั ััะฝะบัะธั-ะบะพะฝััััะบัะพั \cdf{make-binop} ะธ ััะธ
ััะฝะบัะธะธ-ัะตะปะตะบัะพัะฐ  \cdf{binop-operator}, \cd{binop-operand-1} ะธ
\cd{binop-operand-2}. ะะฝะฐ ัะฐะบะถะต ะพะฟัะตะดะตะปะธั ะฟัะตะดะธะบะฐั \cdf{binop-p}.

ะะตะทัะปััะฐัะพะผ \cdf{make-binop} ัะตะฟะตัั ัะฒะปัะตััั ัะฟะธัะพะบ ั 4-ะผั ัะปะตะผะตะฝัะฐะผะธ:
\begin{lisp}
(make-binop :operator '+ :operand-1 'x :operand-2 5) \\*
~~~\EV\ (binop + x 5) \\
\\
(make-binop :operand-2 4 :operator '*) \\*
~~~\EV\ (binop * {\nil} 4)
\end{lisp}
ะกัััะบัััะฐ ะธะผะตะตั ัะฐะบัั ะถะต ัะฐะทะผะตัะบั ะบะฐะบ ะธ ัะฐะฝััะต ะทะฐ ะธัะบะปััะตะฝะธะตะผ ะธะผะตะฝะธ ััััะบัััั ะฒ
ะฟะตัะฒะพะผ ัะปะตะผะตะฝัะต.
ะคัะฝะบัะธะธ-ัะตะปะตะบัะพัั
\cdf{binop-operator}, \cd{binop-operand-1}ะธ \cd{binop-operand-2} ัะบะฒะธะฒะฐะปะตะฝัะฝั
ัะพะพัะฒะตัััะฒะตะฝะฝะพ \cdf{cadr}, \cdf{caddr} ะธ \cdf{cadddr}.
ะัะตะดะธะบะฐั \cdf{binop-p} ะฟัะธะผะตัะฝะพ ัะพะพัะฒะตัััะฒัะตั ัะปะตะดัััะตะผั ะพะฟัะตะดะตะปะตะฝะธั.
\begin{lisp}
(defun binop-p (x) \\
~~(and (consp x) (eq (car x) 'binop)))
\end{lisp}
ะะผั \cdf{binop} ะฝะต ัะฒะปัะตััั ะบะพััะตะบัะฝัะผ ัะฟะตัะธัะธะบะฐัะพัะพะผ ัะธะฟะฐ, ะธ ะฝะต ะผะพะถะตั
ะธัะฟะพะปัะทะพะฒะฐัััั ะฒ \cdf{typep}. ะะพ ั ะฟะพะผะพััั ะฟัะตะดะธะบะฐัะฐ ััััะบัััะฐ ัะตะฟะตัั ะพัะปะธัะธะผะฐ 
ะพั ะดััะณะธั ััััะบััั. 

\subsection{ะััะณะธะต ะฐัะฟะตะบัั ัะฒะฝะพ ะพะฟัะตะดะตะปัะฝะฝัั ัะธะฟะพะฒ ะดะปั ะฟัะตะดััะฐะฒะปะตะฝะธั ััััะบััั}
\label{DEFSTRUCT-INITIAL-OFFSET}

ะะฟัะธั \cd{:initial-offset} ะฟะพะทะฒะพะปัะตั ัะบะฐะทัะฒะฐัั ะฝะฐัะฐะปะพ ัะฐะทะผะตัะตะฝะธั ัะปะพัะพะฒ ะฒ
ะฟัะตะดััะฐะฒะปะตะฝะธะธ ััััะบัััั. ะะฐะฟัะธะผะตั, ัะพัะผะฐ
\begin{lisp}
(defstruct (binop (:type list) (:initial-offset 2)) \\*
~~(operator '? :type symbol) \\*
~~operand-1 \\*
~~operand-2)
\end{lisp}
ัะพะทะดะฐัั ะบะพะฝััััะบัะพั \cdf{make-binop} ัะพ ัะปะตะดัััะธะผ ะฟะพะฒะตะดะตะฝะธะตะผ:
\begin{lisp}
(make-binop :operator '+ :operand-1 'x :operand-2 5) \\*
~~~\EV\ (nil nil + x 5) \\
\\
(make-binop :operand-2 4 :operator '*) \\*
~~~\EV\ (nil nil * {\nil} 4)
\end{lisp}
ะกะตะปะตะบัะพัั
\cdf{binop-operator}, \cd{binop-operand-1} ะธ \cd{binop-operand-2} 
ะฑัะดัั ัะบะฒะธะฒะฐะปะตะฝัะฝั ัะพะพัะฒะตัััะฒะตะฝะฝะพ \cdf{caddr},
\cdf{cadddr}, ะธ \cdf{car} ะพั \cdf{cddddr}.
ะขะฐะบะธะผ ะถะต ะพะฑัะฐะทะพะผ, ัะพัะผะฐ
\begin{lisp}
(defstruct (binop (:type list) :named (:initial-offset 2)) \\*
~~(operator '? :type symbol) \\*
~~operand-1 \\*
~~operand-2)
\end{lisp}
ัะพะทะดะฐัั ะบะพะฝััััะบัะพั \cdf{make-binop} ัะพ ัะปะตะดัััะธะผ ะฟะพะฒะตะดะตะฝะธะตะผ:
\begin{lisp}
(make-binop :operator '+ :operand-1 'x :operand-2 5) \\*
~~~\EV\ (nil nil binop + x 5) \\
\\
(make-binop :operand-2 4 :operator '*) \\*
~~~\EV\ (nil nil binop * {\nil} 4)
\end{lisp}

ะัะปะธ ะฒะผะตััะต ั ะพะฟัะธะตะน \cd{:type} ะธัะฟะพะปัะทัะตััั \cd{:include}, ัะพะณะดะฐ ะฒ
ะฟัะตะดััะฐะฒะปะตะฝะธะธ ะฒัะดะตะปัะตััั ััะพะปัะบะพ ะผะตััะฐ, ัะบะพะปัะบะพ ะฝะตะพะฑัะพะดะธะผะพ ะดะปั ัะพะดะธัะตะปััะบะพะน
ััััะบัััั, ะทะฐัะตะผ ะฟัะพะฟััะบะฐะตััั ััะพะปัะบะพ ะผะตััะฐ, ัะบะพะปัะบะพ ัะบะฐะทะฐะฝะพ ะฒ ะพะฟัะธะธ
\cd{:initial-offset}, ะธ ะทะฐัะตะผ ะฝะฐัะธะฝะฐะตััั ัะฐัะฟะพะปะพะถะตะฝะธะต ัะปะตะผะตะฝัะพะฒ ะพะฟัะตะดะตะปัะตะผะพะน
ััััะบัััั.
ะะฐะฟัะธะผะตั:
\begin{lisp}
(defstruct (binop (:type list) :named (:initial-offset 2)) \\
~~(operator '? :type symbol) \\
~~operand-1 \\
~~operand-2) \\
 \\
(defstruct (annotated-binop (:type list) \\
~~~~~~~~~~~~~~~~~~~~~~~~~~~~(:initial-offset 3) \\
~~~~~~~~~~~~~~~~~~~~~~~~~~~~(:include binop)) \\
~~commutative associative identity) \\
 \\
(make-annotated-binop :operator '* \\
~~~~~~~~~~~~~~~~~~~~~~:operand-1 'x \\
~~~~~~~~~~~~~~~~~~~~~~:operand-2 5 \\
~~~~~~~~~~~~~~~~~~~~~~:commutative t \\
~~~~~~~~~~~~~~~~~~~~~~:associative t \\
~~~~~~~~~~~~~~~~~~~~~~:identity 1) \\
~~~\EV\ (nil nil binop * x 5 nil nil nil t t 1)
\end{lisp}
ะะตัะฒัะต ะดะฒะฐ {\nil} ัะปะตะผะตะฝัะฐ ะฟัะพะฟััะตะฝั ะฟะพ ะฟัะธัะธะฝะต ะพะฟัะธะธ \cd{:initial-offset} ัะพ ะทะฝะฐัะตะฝะธะตะผ
\cd{2} ะฒ ะพะฟัะตะดะตะปะตะฝะธะธ \cdf{binop}. ะกะปะตะดัััะธะต ัะตัััะต ัะปะตะผะตะฝัะฐ ัะพะดะตัะถะฐั ะธะผั ะธ ััะธ ัะปะพัะฐ
ััััะบัััั \cdf{binop}. ะกะปะตะดัััะธะต ััะธ {\nil} ัะปะตะผะตะฝัั ะฟัะพะฟััะตะฝะพ ะฟะพ ะฟัะธัะธะฝะต ะพะฟัะธะธ
\cd{:initial-offset} ะทะฐ ะทะฝะฐัะตะฝะธะตะผ \cd{3} ะฒ ะพะฟัะตะดะตะปะตะฝะธะธ ััััะบัััั
\cdf{annotated-binop}. ะะพัะปะตะดะฝะธะต ััะธ ัะปะตะผะตะฝัะฐ ัะพะดะตัะถะฐั ััะธ ัะปะพัะฐ, ะพะฟัะตะดะตะปัะฝะฝัั ะฒ
ััััะบัััะต \cdf{annotated-binop}.


\fi