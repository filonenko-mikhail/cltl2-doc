<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//RU"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>Output Functions</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- 3,next,fn-in,charset=utf-8,sections+,minitoc<,html --> 
<meta name="src" content="clm.tex"> 
<meta name="date" content="2012-06-05 16:10:00"> 
<link rel="stylesheet" type="text/css" href="clm.css"> 
<link rel="stylesheet" type="text/css" href="../cltl2ed.css"></head><body 
>
   <div id="toplinks"> &lt;<a href="../index.html">Главная</a>&gt; &lt;<a href="symbols.html">Символы</a>&gt; <br />&#x003C;<a 
href="clmse115.html" >Далее</a>&#x003E;&#x003C;<a 
href="clmse113.html" >Назад</a>&#x003E;&#x003C;<a 
href="clmse113.html#tailclmse113.html" >Назад-и-вниз</a>&#x003E;&#x003C;<a 
href="#tailclmse114.html">В-конец</a>&#x003E;&#x003C;<a 
href="io.html#clmse114.html" >Наверх</a>&#x003E;</div><h3 class="sectionHead"><span class="titlemark">22.3
</span> <a 
href="clm.html#QQ2-141-230" id="x141-19200022.3">Output Functions</a></h3>
<!--l. 3820--><p class="noindent" >The output functions are divided into two groups: those that operate on streams
of characters and those that operate on streams of binary data. The function
<b><a 
href="symbols.html#x188-375426r426">format</a></b> operates on streams of characters but is described in a section
separate from the other character-output functions because of its great
complexity.
<!--l. 3827--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">22.3.1   </span> <a 
href="frontmatter.html#QQ2-141-231" id="x141-19300022.3.1">Output to Character Streams</a></h4>
<!--l. 3829--><p class="noindent" >These functions all take an optional argument called <em>output-stream</em>, which is
where to send the output. If unsupplied or <b><a 
href="symbols.html#x188-375658r658">nil</a></b>, <em>output-stream</em> defaults to the value
of the variable <b><a 
href="symbols.html#x188-375051r51">*standard-output*</a></b>. If it is <b><a 
href="symbols.html#x188-375939r939">t</a></b>, the value of the variable
<b><a 
href="symbols.html#x188-375052r52">*terminal-io*</a></b> is used.
<!--l. 3835--><p class="indent" >   X3J13 voted in June 1989 <a 
 id="dx141-193001"></a>to add the keyword argument <b>:readably</b> to the
function <b><a 
href="symbols.html#x188-376013r1013">write</a></b>, and voted in June 1989 <a 
 id="dx141-193002"></a>to add the keyword arguments
<b>:right-margin</b>, <b>:miser-width</b>, <b>:lines</b>, and <b>:pprint-dispatch</b>. The revised
description is as follows.
<div class="defun">
<div class="defunheader">
<em>
<!--l. 3843--><p class="noindent" >[Function]</em><a 
 id="dx141-193003"></a> <b>write</b> <i>object</i> <tt><a 
href="clmse29.html#x39-620005.2.2">&#x0026;key</a></tt> <i>:stream</i> <i>:escape</i> <i>:radix</i> <i>:base</i> <i>:circle</i> <i>:pretty</i> <i>:level</i>
<i>:length</i> <i>:case</i> <i>:gensym</i> <i>:array</i> <i>:readably</i> <i>:right-margin</i> <i>:miser-width</i> <i>:lines</i>
<i>:pprint-dispatch</i>
</div>
<!--l. 3847--><p class="indent" >   The printed representation of <em>object</em> is written to the output stream speciﬁed
by <b>:stream</b>, which defaults to the value of <b><a 
href="symbols.html#x188-375051r51">*standard-output*</a></b>.
<!--l. 3850--><p class="indent" >   The other keyword arguments specify values used to control the generation of
the printed representation. Each defaults to the value of the corresponding global
                                                                          

                                                                          
variable: see <b><a 
href="symbols.html#x188-375031r31">*print-escape*</a></b>, <b>*print-radix*</b>, <b>*print-base*</b>, <b><a 
href="symbols.html#x188-375030r30">*print-circle*</a></b>,
<b><a 
href="symbols.html#x188-375038r38">*print-pretty*</a></b>, <b>*print-level*</b>, <b>*print-length*</b>, and <b><a 
href="symbols.html#x188-375029r29">*print-case*</a></b>, in addition to
<b>*print-array*</b>, <b>*print-gensym*</b>, <b>*print-readably*</b>, <b>*print-right-margin*</b>,
<b>*print-miser-width*</b>, <b>*print-lines*</b>, and <b>*print-pprint-dispatch*</b>. (This is
the means by which these variables aﬀect printing operations: supplying
default values for the <b><a 
href="symbols.html#x188-376013r1013">write</a></b> function.) Note that the printing of symbols
is also aﬀected by the value of the variable <b><a 
href="symbols.html#x188-375026r26">*package*</a></b>. <b><a 
href="symbols.html#x188-376013r1013">write</a></b> returns
<em>object</em>.
<hr></div>
<div class="defun">
<div class="defunheader">
<em>
<!--l. 3870--><p class="noindent" >[Function]</em><a 
 id="dx141-193004"></a> <b>prin1</b> <i>object</i> <tt><a 
href="clmse29.html#x39-620005.2.2">&#x0026;optional</a></tt> <i>output-stream</i><br />
<em>
[Function]</em><a 
 id="dx141-193005"></a> <b>print</b> <i>object</i> <tt><a 
href="clmse29.html#x39-620005.2.2">&#x0026;optional</a></tt> <i>output-stream</i><br />
<em>
[Function]</em><a 
 id="dx141-193006"></a> <b>pprint</b> <i>object</i> <tt><a 
href="clmse29.html#x39-620005.2.2">&#x0026;optional</a></tt> <i>output-stream</i><br />
<em>
[Function]</em><a 
 id="dx141-193007"></a> <b>princ</b> <i>object</i> <tt><a 
href="clmse29.html#x39-620005.2.2">&#x0026;optional</a></tt> <i>output-stream</i>
</div>
<b>
<!--l. 3875--><p class="indent" >   prin1</b> outputs the printed representation of <em>object</em> to <em>output-stream</em>. Escape
characters are used as appropriate. Roughly speaking, the output from <b>prin1</b> is
suitable for input to the function <b><a 
href="symbols.html#x188-375766r766">read</a></b>. <b>prin1</b> returns the <em>object</em> as its value.
<div class="lisp"><tt><div class="tabbing">
(prin1 <em>object</em> <em>output-stream</em>)
   <br>                             <span class="math"> ≡</span> (write <em>object</em> :stream <em>output-stream</em> :escape t)<br>
<!--l. 3882--><p class="noindent" ></div>
</tt>
</div>
<b>
<!--l. 3884--><p class="indent" >   <a 
href="symbols.html#x188-375739r739">print</a></b> is just like <b>prin1</b> except that the printed representation of <em>object</em> is
preceded by a newline (see <b><a 
href="symbols.html#x188-375945r945">terpri</a></b>) and followed by a space. <b><a 
href="symbols.html#x188-375739r739">print</a></b> returns
                                                                          

                                                                          
<em>object</em>.
<b>
<!--l. 3889--><p class="indent" >   <a 
href="symbols.html#x188-375723r723">pprint</a></b> is just like <b><a 
href="symbols.html#x188-375739r739">print</a></b> except that the trailing space is omitted and the
<em>object</em> is printed with the <b><a 
href="symbols.html#x188-375038r38">*print-pretty*</a></b> ﬂag non-<b><a 
href="symbols.html#x188-375658r658">nil</a></b> to produce “pretty”
output. <b><a 
href="symbols.html#x188-375723r723">pprint</a></b> returns no values (that is, what the expression <b>(values)</b> returns:
zero values).
<div class="new">
<!--l. 3897--><p class="indent" >   X3J13 voted in January 1989 <a 
 id="dx141-193008"></a>to adopt a facility for user-controlled pretty
printing (see chapter <a 
href="pprint.html#x167-24300026">26<!--tex4ht:ref: PPRINT --></a>).
</div>
<b>
<!--l. 3903--><p class="indent" >   <a 
href="symbols.html#x188-375737r737">princ</a></b> is just like <b>prin1</b> except that the output has no escape characters. A
symbol is printed as simply the characters of its print name; a string is printed
without surrounding double quotes; and there may be diﬀerences for other data
types as well. The general rule is that output from <b><a 
href="symbols.html#x188-375737r737">princ</a></b> is intended to look good
to people, while output from <b>prin1</b> is intended to be acceptable to the
function <b><a 
href="symbols.html#x188-375766r766">read</a></b>. <div class="newer"> X3J13 voted in June 1987 <a 
 id="dx141-193009"></a>to clarify that <b><a 
href="symbols.html#x188-375737r737">princ</a></b> prints a
character in exactly the same manner as <b><a 
href="symbols.html#x188-376015r1015">write-char</a></b>: the character is
simply sent to the output <em>stream</em>. This was implied by the speciﬁcation in
section <a 
href="clmse112.html#x139-18800022.1.6">22.1.6<!--tex4ht:ref: PRINTER --></a> in the ﬁrst edition, but is worth pointing out explicitly
here.
</div> <b><a 
href="symbols.html#x188-375737r737">princ</a></b> returns the <em>object</em> as its value. <div class="lisp"><tt><div class="tabbing">
(princ <em>object</em> <em>output-stream</em>)
   <br>                          <span class="math"> ≡</span> (write <em>object</em> :stream <em>output-stream</em> :escape <b><a 
href="symbols.html#x188-375658r658">nil</a></b>)<br>
<!--l. 3921--><p class="noindent" ></div>
</tt>
</div>
<hr>
</div>
<div class="defun">
<div class="defunheader">
<em>
                                                                          

                                                                          
<!--l. 3926--><p class="noindent" >[Function]</em><a 
 id="dx141-193010"></a> <b>write-to-string</b> <i>object</i> <tt><a 
href="clmse29.html#x39-620005.2.2">&#x0026;key</a></tt> <i>:escape</i> <i>:radix</i> <i>:base</i> <i>:circle</i> <i>:pretty</i> <i>:level</i>
<i>:length</i> <i>:case</i> <i>:gensym</i> <i>:array</i> <i>:readably</i> <i>:right-margin</i> <i>:miser-width</i> <i>:lines</i>
<i>:pprint-dispatch</i><br />
<em>
[Function]</em><a 
 id="dx141-193011"></a> <b>prin1-to-string</b> <i>object</i><br />
<em>
[Function]</em><a 
 id="dx141-193012"></a> <b>princ-to-string</b> <i>object</i>
</div>
<!--l. 3932--><p class="indent" >   The object is eﬀectively printed as if by <b><a 
href="symbols.html#x188-376013r1013">write</a></b>, <b>prin1</b>, or <b><a 
href="symbols.html#x188-375737r737">princ</a></b>, respectively,
and the characters that would be output are made into a string, which is
returned.
<hr></div>
<div class="defun">
<div class="defunheader">
<em>
<!--l. 3940--><p class="noindent" >[Function]</em><a 
 id="dx141-193013"></a> <b>write-char</b> <i>character</i> <tt><a 
href="clmse29.html#x39-620005.2.2">&#x0026;optional</a></tt> <i>output-stream</i>
</div>
<b>
<!--l. 3942--><p class="indent" >   <a 
href="symbols.html#x188-376015r1015">write-char</a></b> outputs the <em>character</em> to <em>output-stream</em>, and returns <em>character</em>.
<hr></div>
<div class="defun">
<div class="defunheader">
<em>
<!--l. 3948--><p class="noindent" >[Function]</em><a 
 id="dx141-193014"></a> <b>write-string</b> <i>string</i> <tt><a 
href="clmse29.html#x39-620005.2.2">&#x0026;optional</a></tt> <i>output-stream</i> <tt><a 
href="clmse29.html#x39-620005.2.2">&#x0026;key</a></tt> <i>:start</i>
<i>:end</i><br />
<em>
[Function]</em><a 
 id="dx141-193015"></a> <b>write-line</b> <i>string</i> <tt><a 
href="clmse29.html#x39-620005.2.2">&#x0026;optional</a></tt> <i>output-stream</i> <tt><a 
href="clmse29.html#x39-620005.2.2">&#x0026;key</a></tt> <i>:start</i> <i>:end</i>
</div>
<b>
<!--l. 3951--><p class="indent" >   <a 
href="symbols.html#x188-376018r1018">write-string</a></b> writes the characters of the speciﬁed substring of <em>string</em> to the
<em>output-stream</em>. The <b>:start</b> and <b>:end</b> parameters delimit a substring of <em>string</em> in
the usual manner (see chapter <a 
href="kseque.html#x96-13600014">14<!--tex4ht:ref: KSEQUE --></a>). <b><a 
href="symbols.html#x188-376016r1016">write-line</a></b> does the same thing but then
outputs a newline afterwards. (See <b><a 
href="symbols.html#x188-375772r772">read-line</a></b>.) In either case, the <em>string</em>
is returned (<em>not</em> the substring delimited by <b>:start</b> and <b>:end</b>). In some
                                                                          

                                                                          
implementations these may be much more eﬃcient than an explicit loop using
<b><a 
href="symbols.html#x188-376015r1015">write-char</a></b>.
<hr></div>
<div class="defun">
<div class="defunheader">
<em>
<!--l. 3965--><p class="noindent" >[Function]</em><a 
 id="dx141-193016"></a> <b>write-sequence</b> <i>sequence</i> <i>output-stream</i> <tt><a 
href="clmse29.html#x39-620005.2.2">&#x0026;key</a></tt> <i>:start</i> <i>:end</i>
</div>
<!--l. 3968--><p class="indent" >   write-sequence writes the elements of the subsequence of <em>sequence</em> bounded by
<em>start</em> and <em>end</em> to <em>output-stream</em>.
<hr></div>
<div class="defun">
<div class="defunheader">
<em>
<!--l. 3972--><p class="noindent" >[Function]</em><a 
 id="dx141-193017"></a> <b>terpri</b> <tt><a 
href="clmse29.html#x39-620005.2.2">&#x0026;optional</a></tt> <i>output-stream</i><br />
<em>
[Function]</em><a 
 id="dx141-193018"></a> <b>fresh-line</b> <tt><a 
href="clmse29.html#x39-620005.2.2">&#x0026;optional</a></tt> <i>output-stream</i>
</div>
<!--l. 3975--><p class="indent" >   The function <b><a 
href="symbols.html#x188-375945r945">terpri</a></b> outputs a newline to <em>output-stream</em>. It is identical in eﬀect
to <b>(write-char #\Newline <em>output-stream</em>)</b>; however, <b><a 
href="symbols.html#x188-375945r945">terpri</a></b> always returns
<b><a 
href="symbols.html#x188-375658r658">nil</a></b>.
<b>
<!--l. 3980--><p class="indent" >   <a 
href="symbols.html#x188-375429r429">fresh-line</a></b> is similar to <b><a 
href="symbols.html#x188-375945r945">terpri</a></b> but outputs a newline only if the stream is not
already at the start of a line. (If for some reason this cannot be determined, then
a newline is output anyway.) This guarantees that the stream will be
on a “fresh line” while consuming as little vertical distance as possible.
<b><a 
href="symbols.html#x188-375429r429">fresh-line</a></b> is a predicate that is true if it output a newline, and otherwise
false.
<hr></div>
<div class="defun">
<div class="defunheader">
<em>
<!--l. 3991--><p class="noindent" >[Function]</em><a 
 id="dx141-193019"></a> <b>ﬁnish-output</b> <tt><a 
href="clmse29.html#x39-620005.2.2">&#x0026;optional</a></tt> <i>output-stream</i><br />
<em>
                                                                          

                                                                          
[Function]</em><a 
 id="dx141-193020"></a> <b>force-output</b> <tt><a 
href="clmse29.html#x39-620005.2.2">&#x0026;optional</a></tt> <i>output-stream</i><br />
<em>
[Function]</em><a 
 id="dx141-193021"></a> <b>clear-output</b> <tt><a 
href="clmse29.html#x39-620005.2.2">&#x0026;optional</a></tt> <i>output-stream</i>
</div>
<!--l. 3995--><p class="indent" >   Some streams may be implemented in an asynchronous or buﬀered
manner. The function <b><a 
href="symbols.html#x188-375411r411">ﬁnish-output</a></b> attempts to ensure that all output sent
to <em>output-stream</em> has reached its destination, and only then returns <b><a 
href="symbols.html#x188-375658r658">nil</a></b>.
<b><a 
href="symbols.html#x188-375425r425">force-output</a></b> initiates the emptying of any internal buﬀers but returns <b><a 
href="symbols.html#x188-375658r658">nil</a></b>
without waiting for completion or acknowledgment.
<!--l. 4002--><p class="indent" >   The function <b><a 
href="symbols.html#x188-375239r239">clear-output</a></b>, on the other hand, attempts to abort any
outstanding output operation in progress in order to allow as little output as
possible to continue to the destination. This is useful, for example, to abort a
lengthy output to the terminal when an asynchronous error occurs. <b><a 
href="symbols.html#x188-375239r239">clear-output</a></b>
returns <b><a 
href="symbols.html#x188-375658r658">nil</a></b>.
<!--l. 4009--><p class="indent" >   The precise actions of all three of these operations are implementation-dependent.
<hr></div>
<div class="defmac">
<div class="defmacheader">
<!--l. 4014--><p class="indent" >   <div class="tabbing">
 <em>[Макрос]</em> <b>print-unreadable-object</b> <a 
 id="dx141-193022"></a>(object stream[[<b>:type</b> type | <b>:identity</b> id]]){declaration}* {form}*
   <br>
<!--l. 4017--><p class="noindent" ></div>
</div>
<!--l. 4018--><p class="indent" >   Function will output a printed representation of <em>object</em> on <em>stream</em>, beginning
with <b>#&#x003C;</b> and ending with <b><a 
href="symbols.html#x188-375065r65">&#x003E;</a></b>. Everything output to the <em>stream</em> during execution
of the body forms is enclosed in the angle brackets. If <em>type</em> is true, the
body output is preceded by a brief description of the object&#x2019;s type and
a space character. If <em>id</em> is true, the body output is followed by a space
character and a representation of the object&#x2019;s identity, typically a storage
address.
<!--l. 4028--><p class="indent" >   If <b>*print-readably*</b> is true, <b><a 
href="symbols.html#x188-375741r741">print-unreadable-object</a></b> signals an error of
type <b>print-not-readable</b> without printing anything.
<!--l. 4031--><p class="indent" >   The <em>object</em>, <em>stream</em>, <em>type</em>, and <em>id</em> arguments are all evaluated normally. The
<em>type</em> and <em>id</em> default to false. It is valid to provide no body forms. If <em>type</em> and <em>id</em> are
both true and there are no body forms, only one space character separates the
                                                                          

                                                                          
printed type and the printed identity.
<!--l. 4036--><p class="indent" >   The value returned by <b><a 
href="symbols.html#x188-375741r741">print-unreadable-object</a></b> is <b><a 
href="symbols.html#x188-375658r658">nil</a></b>. <div class="lisp"><tt><div class="tabbing">
(defmethod print-object ((obj airplane) stream)
   <br>                     (print-unreadable-object (obj stream :type t :identity t)<br>
    (princ (tail-number obj) stream)))<br>         (print my-airplane)  prints<br>
#&#x003C;Airplane NW0773 777500123135&#x003E;     ;In implementation A<br>
                     or perhaps<br>
#&#x003C;FAA:AIRPLANE NW0773 17&#x003E;           ;In implementation B<br>
<!--l. 4045--><p class="noindent" ></div>
</tt>
</div>
<!--l. 4046--><p class="indent" >   The big advantage of <b><a 
href="symbols.html#x188-375741r741">print-unreadable-object</a></b> is that it allows a user to
write <b><a 
href="symbols.html#x188-375740r740">print-object</a></b> methods that adhere to implementation-speciﬁc style without
requiring the user to write implementation-dependent code.
<!--l. 4051--><p class="indent" >   The X3J13 vote left it unclear whether <b><a 
href="symbols.html#x188-375741r741">print-unreadable-object</a></b> permits
declarations to appear before the body of the macro call. I believe that was the
intent, and this is reﬂected in the syntax shown above; but this is only my
interpretation.
<hr></div>
<!--l. 4057--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">22.3.2   </span> <a 
href="frontmatter.html#QQ2-141-232" id="x141-19400022.3.2">Output to Binary Streams</a></h4>
<!--l. 4059--><p class="noindent" >Common Lisp currently speciﬁes only a very simple facility for binary output: the
writing of a single byte as an integer.
<div class="defun">
<div class="defunheader">
<em>
<!--l. 4063--><p class="noindent" >[Function]</em><a 
 id="dx141-194001"></a> <b>write-byte</b> <i>integer</i> <i>binary-output-stream</i>
</div>
<b>
                                                                          

                                                                          
<!--l. 4065--><p class="indent" >   <a 
href="symbols.html#x188-376014r1014">write-byte</a></b> writes one byte, the value of <em>integer</em>. It is an error if <em>integer</em> is not
of the type speciﬁed as the <b>:element-type</b> argument to <b><a 
href="symbols.html#x188-375689r689">open</a></b> when the stream
was created. The value <em>integer</em> is returned.
<hr></div>
<!--l. 4073--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">22.3.3   </span> <a 
href="frontmatter.html#QQ2-141-233" id="x141-19500022.3.3">Formatted Output to Character Streams</a></h4>
<!--l. 4077--><p class="noindent" >The function <b><a 
href="symbols.html#x188-375426r426">format</a></b> is very useful for producing nicely formatted text, producing
good-looking messages, and so on. <b><a 
href="symbols.html#x188-375426r426">format</a></b> can generate a string or output to a
stream.
<!--l. 4081--><p class="indent" >   Formatted output is performed not only by the <b><a 
href="symbols.html#x188-375426r426">format</a></b> function itself but by
certain other functions that accept a control string “the way <b><a 
href="symbols.html#x188-375426r426">format</a></b> does.” For
example, error-signaling functions such as <b><a 
href="symbols.html#x188-375201r201">cerror</a></b> accept <b><a 
href="symbols.html#x188-375426r426">format</a></b> control
strings.
<div class="defun">
<div class="defunheader">
<em>
<!--l. 4087--><p class="noindent" >[Function]</em><a 
 id="dx141-195001"></a> <b>format</b> <i>destination</i> <i>control-string</i> <tt><a 
href="clmse29.html#x39-620005.2.2">&#x0026;rest</a></tt> <i>arguments</i>
</div>
<b>
<!--l. 4089--><p class="indent" >   <a 
href="symbols.html#x188-375426r426">format</a></b> is used to produce formatted output. <b><a 
href="symbols.html#x188-375426r426">format</a></b> outputs the characters
of <em>control-string</em>, except that a tilde (<b>~</b>) introduces a directive. The character
after the tilde, possibly preceded by preﬁx parameters and modiﬁers, speciﬁes
what kind of formatting is desired. Most directives use one or more elements
of <em>arguments</em> to create their output; the typical directive puts the next
element of <em>arguments</em> into the output, formatted in some special way. It is
an error if no argument remains for a directive requiring an argument,
but it is not an error if one or more arguments remain unprocessed by a
directive.
<!--l. 4101--><p class="indent" >   The output is sent to <em>destination</em>. If <em>destination</em> is <b><a 
href="symbols.html#x188-375658r658">nil</a></b>, a string is created that
contains the output; this string is returned as the value of the call to
<b><a 
href="symbols.html#x188-375426r426">format</a></b>.
<!--l. 4105--><p class="indent" >   When the ﬁrst argument to <b><a 
href="symbols.html#x188-375426r426">format</a></b> is <b><a 
href="symbols.html#x188-375658r658">nil</a></b>, <b><a 
href="symbols.html#x188-375426r426">format</a></b> creates a stream of type
<b>string-stream</b> in much the same manner as <b><a 
href="symbols.html#x188-376008r1008">with-output-to-string</a></b>. (This
stream may be visible to the user if, for example, the <b>~S</b> directive is used to print
                                                                          

                                                                          
a <b><a 
href="symbols.html#x188-375313r313">defstruct</a></b> structure that has a user-supplied print function.)
<!--l. 4112--><p class="indent" >   In all other cases <b><a 
href="symbols.html#x188-375426r426">format</a></b> returns <b><a 
href="symbols.html#x188-375658r658">nil</a></b>, performing output to <em>destination</em> as a
side eﬀect. If <em>destination</em> is a stream, the output is sent to it. If <em>destination</em>
is <b><a 
href="symbols.html#x188-375939r939">t</a></b>, the output is sent to the stream that is the value of the variable
<b><a 
href="symbols.html#x188-375051r51">*standard-output*</a></b>. If <em>destination</em> is a string with a ﬁll pointer, then in eﬀect
the output characters are added to the end of the string (as if by use of
<b><a 
href="symbols.html#x188-375993r993">vector-push-extend</a></b>).
<!--l. 4122--><p class="indent" >   The <b><a 
href="symbols.html#x188-375426r426">format</a></b> function includes some extremely complicated and specialized
features. It is not necessary to understand all or even most of its features to
use <b><a 
href="symbols.html#x188-375426r426">format</a></b> eﬀectively. The beginner should skip over anything in the
following documentation that is not immediately useful or clear. The
more sophisticated features (such as conditionals and iteration) are there
for the convenience of programs with especially complicated formatting
requirements.
<!--l. 4131--><p class="indent" >   A <b><a 
href="symbols.html#x188-375426r426">format</a></b> directive consists of a tilde (<b>~</b>), optional preﬁx parameters
separated by commas, optional colon (<b>:</b>) and at-sign (<b>@</b>) modiﬁers, and a single
character indicating what kind of directive this is. The alphabetic case of the
directive character is ignored. The preﬁx parameters are generally integers,
notated as optionally signed decimal numbers.
<!--l. 4139--><p class="indent" >   If both colon and at-sign modiﬁers are present, they may appear in either
order; thus <b>~:@R</b> and <b>~@:R</b> mean the same thing. However, it is traditional to
put the colon ﬁrst, and all the examples in this book put colons before
at-signs.
<!--l. 4144--><p class="indent" >   Examples of control strings: <div class="lisp"><tt><div class="tabbing">
&#x0022;~S&#x0022;           ;An <b>~S</b> directive with no parameters or modiﬁers
   <br>       &#x0022;~3,-4:@s&#x0022;     ;An <b>~S</b> directive with two parameters, 3 and <span class="math"> − 4</span>,<br>
               ; and both the colon and at-sign ﬂags<br>
&#x0022;~,+4S&#x0022;        ;First preﬁx parameter is omitted and takes<br>
               ; on its default value; the second parameter is 4<br>
<!--l. 4151--><p class="noindent" ></div>
</tt>
</div>
<!--l. 4152--><p class="indent" >   Sometimes a preﬁx parameter is used to specify a character, for instance the
padding character in a right- or left-justifying operation. In this case a
single quote (<b>&#x2019;</b>) followed by the desired character may be used as a preﬁx
                                                                          

                                                                          
parameter, to mean the character object that is the character following
the single quote. For example, you can use <b>~5,&#x2019;0d</b> to print an integer in
decimal radix in ﬁve columns with leading zeros, or <b>~5,&#x2019;*d</b> to get leading
asterisks.
<!--l. 4161--><p class="indent" >   In place of a preﬁx parameter to a directive, you can put the letter <b>V</b> (or <b>v</b>),
which takes an argument from <em>arguments</em> for use as a parameter to the directive.
Normally this should be an integer or character object, as appropriate. This
feature allows variable-width ﬁelds and the like. If the argument used by a <b>V</b>
parameter is <b><a 
href="symbols.html#x188-375658r658">nil</a></b>, the eﬀect is as if the parameter had been omitted. You may also
use the character <b>#</b> in place of a parameter; it represents the number of
arguments remaining to be processed.
<!--l. 4170--><p class="indent" >   It is an error to give a format directive more parameters than it is described
here as accepting. It is also an error to give colon or at-sign modiﬁers
to a directive in a combination not speciﬁcally described here as being
meaningful.
<hr></div>
                                                                          

                                                                          
<div class="new">
<!--l. 4179--><p class="indent" >   X3J13 voted in January 1989 <a 
 id="dx141-195002"></a>to clarify the interaction between <b><a 
href="symbols.html#x188-375426r426">format</a></b> and
the various printer control variables (those named <b>*print-<em>xxx</em>*</b>). This is
important because many <b><a 
href="symbols.html#x188-375426r426">format</a></b> operations are deﬁned, directly or indirectly, in
terms of <b>prin1</b> or <b><a 
href="symbols.html#x188-375737r737">princ</a></b>, which are aﬀected by the printer control variables. The
general rule is that <b><a 
href="symbols.html#x188-375426r426">format</a></b> does not bind any of the standard printer control
variables except as speciﬁed in the individual descriptions of directives. An
implementation may not bind any standard printer control variable not speciﬁed
in the description of a <b><a 
href="symbols.html#x188-375426r426">format</a></b> directive, nor may an implementation fail to bind
any standard printer control variables that is speciﬁed to be bound by
such a description. (See these descriptions for speciﬁc changes voted by
X3J13.)
<!--l. 4194--><p class="indent" >   One consequence of this change is that the user is guaranteed to be able to use
the <b><a 
href="symbols.html#x188-375426r426">format</a></b> <b>~A</b> and <b>~S</b> directives to do pretty printing, under control
of the <b><a 
href="symbols.html#x188-375038r38">*print-pretty*</a></b> variable. Implementations have diﬀered on this
point in their interpretations of the ﬁrst edition. The new <b>~W</b> directive
may be more appropriate than either <b>~A</b> and <b>~S</b> for some purposes,
whether for pretty printing or ordinary printing. See section <a 
href="clmse140.html#x171-24700026.4">26.4<!--tex4ht:ref: PPRINT-FORMAT-DIRECTIVES-SECTION --></a> for
a discussion of <b>~W</b> and other new <b><a 
href="symbols.html#x188-375426r426">format</a></b> directives related to pretty
printing.
</div>
<!--l. 4206--><p class="indent" >   Here are some relatively simple examples to give you the general ﬂavor of how
<b><a 
href="symbols.html#x188-375426r426">format</a></b> is used. <div class="lisp"><tt><div class="tabbing">
(format <b><a 
href="symbols.html#x188-375658r658">nil</a></b> &#x0022;foo&#x0022;) <span class="math"> ⇒</span> &#x0022;foo&#x0022;
   <br>                                         <br>                                         (setq x 5)<br>
<br>                (format <b><a 
href="symbols.html#x188-375658r658">nil</a></b> &#x0022;The answer is ~D.&#x0022; x) <span class="math"> ⇒</span> &#x0022;The answer is 5.&#x0022;<br>
<br>             (format <b><a 
href="symbols.html#x188-375658r658">nil</a></b> &#x0022;The answer is ~3D.&#x0022; x) <span class="math"> ⇒</span> &#x0022;The answer is   5.&#x0022;<br>
<br>           (format <b><a 
href="symbols.html#x188-375658r658">nil</a></b> &#x0022;The answer is ~3,&#x2019;0D.&#x0022; x) <span class="math"> ⇒</span> &#x0022;The answer is 005.&#x0022;<br>
<br>                             (format <b><a 
href="symbols.html#x188-375658r658">nil</a></b> &#x0022;The answer is ~:D.&#x0022; (expt 47 x))<br>
                                <span class="math"> ⇒</span> &#x0022;The answer is 229,345,007.&#x0022;<br>
<!--l. 4221--><p class="noindent" ></div>
</tt>
</div>
<div class="lisp">
<tt>
                                                                          

                                                                          
<!--l. 4223--><p class="indent" >   <div class="tabbing">
(setq y &#x0022;elephant&#x0022;)
   <br>       <br>       (format <b><a 
href="symbols.html#x188-375658r658">nil</a></b> &#x0022;Look at the ~A!&#x0022; y) <span class="math"> ⇒</span> &#x0022;Look at the elephant!&#x0022;<br>
<br>                                            (format <b><a 
href="symbols.html#x188-375658r658">nil</a></b> &#x0022;Type ~:C to ~A.&#x0022;<br>
        (set-char-bit #\D :control t)<br>              &#x0022;delete all your ﬁles&#x0022;)<br>
   <span class="math"> ⇒</span> &#x0022;Type Control-D to delete all your ﬁles.&#x0022;<br>
<!--l. 4232--><p class="noindent" ></div>
</tt>
</div>
<!--l. 4234--><p class="indent" >
                                                                          

                                                                          
<div class="lisp">
<tt>
<!--l. 4236--><p class="indent" >   <div class="tabbing">
(setq n 3)
   <br>
<!--l. 4238--><p class="noindent" ></div>
</tt>
</div>
<div class="lisp">
<tt>
<!--l. 4239--><p class="indent" >   <div class="tabbing">
(format <b><a 
href="symbols.html#x188-375658r658">nil</a></b> &#x0022;~D item~:P found.&#x0022; n) <span class="math"> ⇒</span> &#x0022;3 items found.&#x0022;
   <br>
<!--l. 4241--><p class="noindent" ></div>
</tt>
</div>
<div class="lisp">
<tt>
<!--l. 4242--><p class="indent" >   <div class="tabbing">
(format <b><a 
href="symbols.html#x188-375658r658">nil</a></b> &#x0022;~R dog~:[s are~; is~] here.&#x0022; n (= n 1))
   <br>                                                         <span class="math"> ⇒</span> &#x0022;three dogs are here.&#x0022;<br>
<!--l. 4245--><p class="noindent" ></div>
</tt>
</div>
<div class="lisp">
<tt>
<!--l. 4246--><p class="indent" >   <div class="tabbing">
                                                                          

                                                                          
(format <b><a 
href="symbols.html#x188-375658r658">nil</a></b> &#x0022;~R dog~:*~[s are~; is~:;s are~] here.&#x0022; n)
   <br>                                                         <span class="math"> ⇒</span> &#x0022;three dogs are here.&#x0022;<br>
<!--l. 4249--><p class="noindent" ></div>
</tt>
</div>
<div class="lisp">
<tt>
<!--l. 4250--><p class="indent" >   <div class="tabbing">
(format <b><a 
href="symbols.html#x188-375658r658">nil</a></b> &#x0022;Here ~[are~;is~:;are~] ~:*~R pupp~:@P.&#x0022; n)
   <br>                                                    <span class="math"> ⇒</span> &#x0022;Here are three puppies.&#x0022;<br>
<!--l. 4253--><p class="noindent" ></div>
</tt>
</div>
<!--l. 4255--><p class="indent" >   In the descriptions of the directives that follow, the term <em>arg</em> in general refers
to the next item of the set of <em>arguments</em> to be processed. The word or phrase at
the beginning of each description is a mnemonic (not necessarily an accurate one)
for the directive. <div class="flushdesc">
      <ul><li><b>
<b>~A</b> </b></li><em>Ascii</em>. An <em>arg</em>, any Lisp object, is printed without escape characters (as
      by <b><a 
href="symbols.html#x188-375737r737">princ</a></b>). In particular, if <em>arg</em> is a string, its characters will be output
      verbatim. If <em>arg</em> is <b><a 
href="symbols.html#x188-375658r658">nil</a></b>, it will be printed as <b><a 
href="symbols.html#x188-375658r658">nil</a></b>; the colon modiﬁer (<b>~:A</b>)
      will cause an <em>arg</em> of <b><a 
href="symbols.html#x188-375658r658">nil</a></b> to be printed as (), but if <em>arg</em> is a composite
      structure, such as a list or vector, any contained occurrences of <b><a 
href="symbols.html#x188-375658r658">nil</a></b> will
      still be printed as <b><a 
href="symbols.html#x188-375658r658">nil</a></b>.
<b>
      <!--l. 4271--><p class="noindent" >~<em>mincol</em>A</b> inserts spaces on the right, if necessary, to make the width
      at  least  <em>mincol</em>  columns.  The  <b>@</b> modiﬁer  causes  the  spaces  to  be
      inserted on the left rather than the right.
<b>
      <!--l. 4275--><p class="noindent" >~<em>mincol</em>,<em>colinc</em>,<em>minpad</em>,<em>padchar</em>A</b> is the full form of <b>~A</b>, which
      allows  elaborate  control  of  the  padding.  The  string  is  padded  on
                                                                          

                                                                          
      the  right  (or  on  the  left  if  the  <b>@</b> modiﬁer  is  used)  with  at  least
      <em>minpad</em> copies of <em>padchar</em>; padding characters are then inserted <em>colinc</em>
      characters at a time until the total width is at least <em>mincol</em>. The defaults
      are <b>0</b> for <em>mincol</em> and <em>minpad</em>, <b>1</b> for <em>colinc</em>, and the space character for
      <em>padchar</em>.
<b>
      <!--l. 4284--><p class="noindent" ><a 
href="symbols.html#x188-375426r426">format</a></b> binds <b><a 
href="symbols.html#x188-375031r31">*print-escape*</a></b> to <b><a 
href="symbols.html#x188-375658r658">nil</a></b> during the processing of the <b>~A</b>
      directive.
      <li><b>
<b>~S</b> </b></li><em>S-expression</em>.  This  is  just  like  <b>~A</b>,  but  <em>arg</em>  is  printed  <em>with</em>  escape
      characters (as by <b>prin1</b> rather than <b><a 
href="symbols.html#x188-375737r737">princ</a></b>). The output is therefore
      suitable for input to <b><a 
href="symbols.html#x188-375766r766">read</a></b>. <b>~S</b> accepts all the arguments and modiﬁers
      that <b>~A</b> does.
<b>
      <!--l. 4294--><p class="noindent" ><a 
href="symbols.html#x188-375426r426">format</a></b> binds <b><a 
href="symbols.html#x188-375031r31">*print-escape*</a></b> to <b><a 
href="symbols.html#x188-375939r939">t</a></b> during the processing of the <b>~S</b>
      directive.
      <!--l. 4297--><p class="noindent" >
                                                                          

                                                                          
      <li><b>
<b>~D</b> </b></li><em>Decimal</em>. An <em>arg</em>, which should be an integer, is printed in decimal radix.
      <b>~D</b> will never put a decimal point after the number.
<b>
      <!--l. 4304--><p class="noindent" >~<em>mincol</em>D</b> uses a column width of <em>mincol</em>; spaces are inserted on the
      left if the number requires fewer than <em>mincol</em> columns for its digits and
      sign. If the number doesn&#x2019;t ﬁt in <em>mincol</em> columns, additional columns
      are used as needed.
<b>
      <!--l. 4309--><p class="noindent" >~<em>mincol</em>,<em>padchar</em>D</b> uses  <em>padchar</em> as  the  pad  character  instead  of
      space.
      <!--l. 4312--><p class="noindent" >If <em>arg</em> is not an integer, it is printed in <b>~A</b> format and decimal base.
<b>
      <!--l. 4315--><p class="noindent" ><a 
href="symbols.html#x188-375426r426">format</a></b>  binds  <b><a 
href="symbols.html#x188-375031r31">*print-escape*</a></b>  to  <b><a 
href="symbols.html#x188-375658r658">nil</a></b>,  <b>*print-radix*</b>  to  <b><a 
href="symbols.html#x188-375658r658">nil</a></b>,  and
      <b>*print-base*</b> to <b>10</b> during processing of <b>~D</b>.
      <!--l. 4319--><p class="noindent" >The  <b>@</b>  modiﬁer  causes  the  number&#x2019;s  sign  to  be  printed  always;
      the  default  is  to  print  it  only  if  the  number  is  negative.  The
      <b>:</b>  modiﬁer  causes  commas  to  be  printed  between  groups  of  three
      digits;  the  third  preﬁx  parameter  may  be  used  to  change  the
      character used as the comma. Thus the most general form of <b>~D</b> is
      <b>~<em>mincol</em>,<em>padchar</em>,<em>commachar</em>D</b>.
<div class="new">
      <!--l. 4327--><p class="noindent" >X3J13 voted in March 1988 <a 
 id="dx141-195003"></a>to add a fourth parameter, the <em>commainterval</em>.
      This must be an integer; if it is not provided, it defaults to 3. This
      parameter controls the number of digits in each group separated by the
      <em>commachar</em>.
      <!--l. 4334--><p class="noindent" >By extension, each of the <b>~B</b>, <b>~O</b>, and <b>~X</b> directives accepts a
      <em>commainterval</em> as a fourth parameter, and the <b>~R</b> directive accepts a
      <em>commainterval</em> as its ﬁfth parameter. Examples: <div class="lisp"><tt><div class="tabbing">
      (format nil &#x0022;~„&#x2019; ,4B&#x0022; #xFACE) <span class="math"> ⇒</span> &#x0022;1111 1010 1100 1110&#x0022;
      <br>                            (format nil &#x0022;~„&#x2019; ,4B&#x0022; #x1CE) <span class="math"> ⇒</span> &#x0022;1 1100 1110&#x0022;<br>
           (format nil &#x0022;~19„&#x2019; ,4B&#x0022; #xFACE) <span class="math"> ⇒</span> &#x0022;1111 1010 1100 1110&#x0022;<br>
                                                                          

                                                                          
           (format nil &#x0022;~19„&#x2019; ,4B&#x0022; #x1CE) <span class="math"> ⇒</span> &#x0022;0000 0001 1100 1110&#x0022;<br>
      <!--l. 4343--><p class="noindent" ></div>
</tt>
</div>
      <!--l. 4344--><p class="noindent" >This is one of those little improvements that probably don&#x2019;t matter much
      but aren&#x2019;t hard to implement either. It was pretty silly having the number 3
      wired into the deﬁnition of comma separation when it is just as easy to
      make it a parameter.
      </div>
      <li><b>
<b>~B</b> </b></li><em>Binary</em>. This is just like <b>~D</b> but prints in binary radix (radix 2) instead of
      decimal. The full form is therefore <b>~<em>mincol</em>,<em>padchar</em>,<em>commachar</em>B</b>.
<b>
      <!--l. 4356--><p class="noindent" ><a 
href="symbols.html#x188-375426r426">format</a></b> binds <b><a 
href="symbols.html#x188-375031r31">*print-escape*</a></b> to <b><a 
href="symbols.html#x188-375658r658">nil</a></b>, <b>*print-radix*</b> to <b><a 
href="symbols.html#x188-375658r658">nil</a></b>, and
      <b>*print-base*</b> to <b>2</b> during processing of <b>~B</b>.
      <li><b>
<b>~O</b> </b></li><em>Octal</em>. This is just like <b>~D</b> but prints in octal radix (radix 8) instead of
      decimal. The full form is therefore <b>~<em>mincol</em>,<em>padchar</em>,<em>commachar</em>O</b>.
<b>
      <!--l. 4366--><p class="noindent" ><a 
href="symbols.html#x188-375426r426">format</a></b> binds <b><a 
href="symbols.html#x188-375031r31">*print-escape*</a></b> to <b><a 
href="symbols.html#x188-375658r658">nil</a></b>, <b>*print-radix*</b> to <b><a 
href="symbols.html#x188-375658r658">nil</a></b>, and
      <b>*print-base*</b> to <b>8</b> during processing of <b>~O</b>.
      <li><b>
<b>~X</b> </b></li><em>Hexadecimal</em>. This is just like <b>~D</b> but prints in hexadecimal radix (radix 16)
      instead of decimal. The full form is therefore <b>~<em>mincol</em>,<em>padchar</em>,<em>commachar</em>X</b>.
<b>
      <!--l. 4376--><p class="noindent" ><a 
href="symbols.html#x188-375426r426">format</a></b> binds <b><a 
href="symbols.html#x188-375031r31">*print-escape*</a></b> to <b><a 
href="symbols.html#x188-375658r658">nil</a></b>, <b>*print-radix*</b> to <b><a 
href="symbols.html#x188-375658r658">nil</a></b>, and
      <b>*print-base*</b> to <b>16</b> during processing of <b>~X</b>.
      <li><b>
<b>~R</b> </b></li><em>Radix</em>. <b>~<em>n</em>R</b> prints <em>arg</em> in radix <em>n</em>. The modiﬁer ﬂags and any remaining
      parameters are used as for the <b>~D</b> directive. Indeed, <b>~D</b> is the same as <b>~10R</b>.
      The full form here is therefore <b>~<em>radix</em>,<em>mincol</em>,<em>padchar</em>,<em>commachar</em>R</b>.
<b>
                                                                          

                                                                          
      <!--l. 4388--><p class="noindent" ><a 
href="symbols.html#x188-375426r426">format</a></b> binds <b><a 
href="symbols.html#x188-375031r31">*print-escape*</a></b> to <b><a 
href="symbols.html#x188-375658r658">nil</a></b>, <b>*print-radix*</b> to <b><a 
href="symbols.html#x188-375658r658">nil</a></b>, and
      <b>*print-base*</b> to the value of the ﬁrst parameter during the processing of
      the <b>~R</b> directive with a parameter.
      <!--l. 4393--><p class="noindent" >If no parameters are given to <b>~R</b>, then an entirely diﬀerent interpretation is
      given. <div class="new"><em>Notice of correction.</em> In the ﬁrst edition, this sentence referred to
      “arguments” given to <b>~R</b>. The correct term is “parameters.”
      </div> The argument should be an integer; suppose it is <b>4</b>. Then <b>~R</b> prints <em>arg</em> as
      a cardinal English number: <b>four</b>; <b>~:R</b> prints <em>arg</em> as an ordinal English
      number: <b><a 
href="symbols.html#x188-375428r428">fourth</a></b>; <b>~@R</b> prints <em>arg</em> as a Roman numeral: <b>IV</b>; and <b>~:@R</b>
      prints <em>arg</em> as an old Roman numeral: <b>IIII</b>.
<b>
      <!--l. 4407--><p class="noindent" ><a 
href="symbols.html#x188-375426r426">format</a></b> binds <b>*print-base*</b> to <b>10</b> during the processing of the <b>~R</b>
      directive with no parameter.
<div class="new">
      <!--l. 4411--><p class="noindent" >The ﬁrst edition did not specify how <b>~R</b> and its variants should handle
      arguments that are very large or not positive. Actual practice varies, and
      X3J13 has not yet addressed the topic. Here is a sampling of current
      practice.
      <!--l. 4416--><p class="noindent" >For <b>~@R</b> and <b>~:@R</b>, nearly all implementations produce Roman numerals
      only for integers in the range 1 to 3999, inclusive. Some implementations
      will produce old-style Roman numerals for integers in the range 1 to 4999,
      inclusive. All other integers are printed in decimal notation, as if <b>~D</b> had
      been used.
      <!--l. 4422--><p class="noindent" >For zero, most implementations print <b>zero</b> for <b>~R</b> and <b>zeroth</b> for
      <b>~:R</b>.
      <!--l. 4425--><p class="noindent" >For <b>~R</b> with a negative argument, most implementations simply
      print the word <b>minus</b> followed by its absolute value as a cardinal in
      English.
      <!--l. 4428--><p class="noindent" >For <b>~:R</b> with a negative argument, some implementations also print the
      word <b>minus</b> followed by its absolute value as an ordinal in English; other
      implementations print the absolute value followed by the word <b>previous</b>.
      Thus the argument <b>-4</b> might produce <b>minus fourth</b> or <b>fourth previous</b>.
      Each has its charm, but one is not always a suitable substitute for the other;
      users should be careful.
      <!--l. 4435--><p class="noindent" >There is standard English nomenclature for fairly large integers (up
                                                                          

                                                                          
      to <span class="math">10<sup>6</sup>0</span>, at least), based on appending the suﬃx -illion to Latin
      names of integers. Thus we have the names <em>trillion</em>, <em>quadrillion</em>,
      <em>sextillion</em>, <em>septillion</em>, and so on. For extremely large integers, one
      may express powers of ten in English. One implementation gives
      <b>1606938044258990275541962092341162602522202993782792835301376</b>
      (which is <span class="math">2<sup>200</sup></span>, the result of <b>(ash 1 200)</b>) in this manner:
      <div class="flushleft" 
>
<!--l. 4444--><p class="noindent" >
 one times ten to the sixtieth power six hundred six times ten to the ﬁfty-seventh
power nine hundred thirty-eight septdecillion forty-four sexdecillion two hundred
ﬁfty-eight quindecillion nine hundred ninety quattuordecillion two hundred
seventy-ﬁve tredecillion ﬁve hundred forty-one duodecillion nine hundred
sixty-two undecillion ninety-two decillion three hundred forty-one nonillion one
hundred sixty-two octillion six hundred two septillion ﬁve hundred twenty-two
sextillion two hundred two quintillion nine hundred ninety-three quadrillion seven
hundred eighty-two trillion seven hundred ninety-two billion eight hundred
thirty-ﬁve million three hundred one thousand three hundred seventy-six</div>
      <!--l. 4457--><p class="noindent" >Another implementation prints it this way (note the use of <b>plus</b>):
      <div class="flushleft" 
>
<!--l. 4458--><p class="noindent" >
 one times ten to the sixtieth power plus six hundred six times ten to the
ﬁfty-seventh power plus ... plus two hundred seventy-ﬁve times ten to the
forty-second power plus ﬁve hundred forty-one duodecillion nine hundred
sixty-two undecillion ... three hundred seventy-six</div>
      <!--l. 4465--><p class="noindent" >(I have elided some of the text here to save space.)
      <!--l. 4467--><p class="noindent" >Unfortunately, the meaning of this nomenclature diﬀers between American
      English (in which k-illion means <span class="math">10<sup>3(k+1)</sup></span>, so one trillion is <span class="math">10<sup>12</sup></span>) and British
      English (in which k-illion means <span class="math">10<sup>6k</sup></span>, so one trillion is <span class="math">10<sup>18</sup></span>). To avoid both
      confusion and prolixity, I recommend using decimal notation for all numbers
      above 999,999,999; this is similar to the escape hatch used for Roman
      numerals.
      </div>
                                                                          

                                                                          
      <li><b>
<b>~P</b> </b></li><em>Plural</em>. If <em>arg</em> is not <b><a 
href="symbols.html#x188-375367r367">eql</a></b> to the integer <b>1</b>, a lowercase <b>s</b> is printed; if <em>arg</em> is <b><a 
href="symbols.html#x188-375367r367">eql</a></b>
      to <b>1</b>, nothing is printed. (Notice that if <em>arg</em> is a ﬂoating-point <b>1.0</b>, the <b>s</b> <em>is</em>
      printed.) <b>~:P</b> does the same thing, after doing a <b>~:*</b> to back up one
      argument; that is, it prints a lowercase <b>s</b> if the <em>last</em> argument was not <b>1</b>.
      This is useful after printing a number using <b>~D</b>. <b>~@P</b> prints <b>y</b> if the
      argument is <b>1</b>, or <b>ies</b> if it is not. <b>~:@P</b> does the same thing, but backs up
      ﬁrst. <div class="lisp"><tt><div class="tabbing">
      (format <b><a 
href="symbols.html#x188-375658r658">nil</a></b> &#x0022;~D tr~:@P/~D win~:P&#x0022; 7 1) <span class="math"> ⇒</span> &#x0022;7 tries/1 win&#x0022;
      <br>           (format <b><a 
href="symbols.html#x188-375658r658">nil</a></b> &#x0022;~D tr~:@P/~D win~:P&#x0022; 1 0) <span class="math"> ⇒</span> &#x0022;1 try/0 wins&#x0022;<br>
           (format <b><a 
href="symbols.html#x188-375658r658">nil</a></b> &#x0022;~D tr~:@P/~D win~:P&#x0022; 1 3) <span class="math"> ⇒</span> &#x0022;1 try/3 wins&#x0022;<br>
      <!--l. 4490--><p class="noindent" ></div>
</tt>
</div>
      <li><b>
<b>~C</b> </b></li><em>Character</em>. The next <em>arg</em> should be a character; it is printed according to the
      modiﬁer ﬂags.
<div class="obsolete">
<b>
      <!--l. 4497--><p class="noindent" >~C</b> prints the character in an implementation-dependent abbreviated
      format. This format should be culturally compatible with the host
      environment.
      </div>
<div class="newer">
      <!--l. 4503--><p class="noindent" >X3J13 voted in June 1987 <a 
 id="dx141-195004"></a>to specify that <b>~C</b> performs exactly the same
      action as <b><a 
href="symbols.html#x188-376015r1015">write-char</a></b> if the character to be printed has zero for its bits
      attributes. X3J13 voted in March 1989 <a 
 id="dx141-195005"></a>to eliminate the bits and font
      attributes, replacing them with the notion of implementation-deﬁned
      attributes. The net eﬀect is that characters whose implementation-deﬁned
      attributes all have the “standard” values should be printed by <b>~C</b> in the
      same way that <b><a 
href="symbols.html#x188-376015r1015">write-char</a></b> would print them.
      </div>
                                                                          

                                                                          
<b>
      <!--l. 4514--><p class="noindent" >~:C</b> spells out the names of the control bits and represents non-printing
      characters by their names: <b>Control-Meta-F</b>, <b>Control-Return</b>, <b>Space</b>.
      This is a “pretty” format for printing characters.
<b>
      <!--l. 4519--><p class="noindent" >~:@C</b> prints what <b>~:C</b> would, and then if the character requires unusual
      shift keys on the keyboard to type it, this fact is mentioned: <b>Control-<span class="math">∂</span>
      (Top-F)</b>. This is the format for telling the user about a key he or she is
      expected to type, in prompts, for instance. The precise output may depend
      not only on the implementation but on the particular I/O devices in
      use.
<b>
      <!--l. 4526--><p class="noindent" >~@C</b> prints the character so that the Lisp reader can read it, using <b>#\</b>
      syntax.
<div class="new">
      <!--l. 4530--><p class="noindent" >X3J13 voted in January 1989 <a 
 id="dx141-195006"></a>to specify that <b><a 
href="symbols.html#x188-375426r426">format</a></b> binds <b><a 
href="symbols.html#x188-375031r31">*print-escape*</a></b>
      to <b><a 
href="symbols.html#x188-375939r939">t</a></b> during the processing of the <b>~@C</b> directive. Other variants of the <b>~C</b>
      directive do not bind any printer control variables.
      </div>_____________________________________________________________________<div class="rationale">
        <!--l. 4538--><p class="noindent" ><b>Обоснование:</b> In some implementations the <b>~S</b> directive would do what <b>~C</b>
       does, but <b>~C</b> is compatible with Lisp dialects such as MacLisp that do not have a
        character data type.
        </div>___________________________________________________________________________________________________
        <li><b>
<b>~F</b> </b></li><em>Fixed-format ﬂoating-point</em>. The next <em>arg</em> is printed as a ﬂoating-point
        number.
        <!--l. 4551--><p class="noindent" >The full form is <b>~<em>w</em>,<em>d</em>,<em>k</em>,<em>over owchar</em>,<em>padchar</em>F</b>. The parameter <em>w</em> is
        the width of the ﬁeld to be printed; <em>d</em> is the number of digits to
        print after the decimal point; <em>k</em> is a scale factor that defaults to
        zero.
        <!--l. 4557--><p class="noindent" >Exactly <em>w</em> characters will be output. First, leading copies of the character
        <em>padchar</em> (which defaults to a space) are printed, if necessary, to pad the ﬁeld
        on the left. If the <em>arg</em> is negative, then a minus sign is printed; if the <em>arg</em> is
        not negative, then a plus sign is printed if and only if the <b>@</b> modiﬁer was
        speciﬁed. Then a sequence of digits, containing a single embedded decimal
                                                                          

                                                                          
      point, is printed; this represents the magnitude of the value of <em>arg</em> times <span class="math">10<sup>k</sup></span>,
      rounded to <em>d</em> fractional digits. (When rounding up and rounding down
      would produce printed values equidistant from the scaled value of <em>arg</em>, then
      the implementation is free to use either one. For example, printing the
      argument <b>6.375</b> using the format <b>~4,2F</b> may correctly produce either
      <b>6.37</b> or <b>6.38</b>.) Leading zeros are not permitted, except that a single
      zero digit is output before the decimal point if the printed value
      is less than 1, and this single zero digit is not output after all if
      <span class="math"><em>w</em> = <em>d</em> + 1</span>.
      <!--l. 4577--><p class="noindent" >If it is impossible to print the value in the required format in a ﬁeld of width
      <em>w</em>, then one of two actions is taken. If the parameter <em>overﬂowchar</em> is
      speciﬁed, then <em>w</em> copies of that parameter are printed instead of the scaled
      value of <em>arg</em>. If the <em>overﬂowchar</em> parameter is omitted, then the scaled value
      is printed using more than <em>w</em> characters, as many more as may be
      needed.
      <!--l. 4585--><p class="noindent" >If the <em>w</em> parameter is omitted, then the ﬁeld is of variable width. In eﬀect, a
      value is chosen for <em>w</em> in such a way that no leading pad characters need to
      be printed and exactly <em>d</em> characters will follow the decimal point.
      For example, the directive <b>~,2F</b> will print exactly two digits after
      the decimal point and as many as necessary before the decimal
      point.
      <!--l. 4593--><p class="noindent" >If the parameter <em>d</em> is omitted, then there is no constraint on the number
      of digits to appear after the decimal point. A value is chosen for
      <em>d</em> in such a way that as many digits as possible may be printed
      subject to the width constraint imposed by the parameter <em>w</em> and the
      constraint that no trailing zero digits may appear in the fraction, except
      that if the fraction to be printed is zero, then a single zero digit
      should appear after the decimal point if permitted by the width
      constraint.
      <!--l. 4602--><p class="noindent" >If both <em>w</em> and <em>d</em> are omitted, then the eﬀect is to print the value using
      ordinary free-format output; <b>prin1</b> uses this format for any number
      whose magnitude is either zero or between <span class="math">10<sup>−3</sup></span> (inclusive) and <span class="math">10<sup>7</sup></span>
      (exclusive).
      <!--l. 4607--><p class="noindent" >If <em>w</em> is omitted, then if the magnitude of <em>arg</em> is so large (or, if <em>d</em> is also
      omitted, so small) that more than 100 digits would have to be printed, then
      an implementation is free, at its discretion, to print the number using
                                                                          

                                                                          
      exponential notation instead, as if by the directive <b>~E</b> (with all
      parameters to <b>~E</b> defaulted, not taking their values from the <b>~F</b>
      directive).
      <!--l. 4614--><p class="noindent" >If <em>arg</em> is a rational number, then it is coerced to be a <b>single-ﬂoat</b> and then
      printed. (Alternatively, an implementation is permitted to process a rational
      number by any other method that has essentially the same behavior but
      avoids such hazards as loss of precision or overﬂow because of the coercion.
      However, note that if <em>w</em> and <em>d</em> are unspeciﬁed and the number has no exact
      decimal representation, for example <b>1/3</b>, some precision cutoﬀ must be
      chosen by the implementation: only a ﬁnite number of digits may be
      printed.)
      <!--l. 4623--><p class="noindent" >If <em>arg</em> is a complex number or some non-numeric object, then it
      is printed using the format directive <b>~<em>w</em>D</b>, thereby printing it in
      decimal radix and a minimum ﬁeld width of <em>w</em>. (If it is desired to
      print each of the real part and imaginary part of a complex number
      using a <b>~F</b> directive, then this must be done explicitly with two
      <b>~F</b> directives and code to extract the two parts of the complex
      number.)
<div class="new">
      <!--l. 4632--><p class="noindent" >X3J13 voted in January 1989 <a 
 id="dx141-195007"></a>to specify that <b><a 
href="symbols.html#x188-375426r426">format</a></b> binds <b><a 
href="symbols.html#x188-375031r31">*print-escape*</a></b>
      to <b><a 
href="symbols.html#x188-375658r658">nil</a></b> during the processing of the <b>~F</b> directive.
      </div>
<div class="lisp">
<tt>
      <!--l. 4638--><p class="noindent" ><div class="tabbing">
      (defun foo (x)
      <br>                     (format nil &#x0022;~6,2F|~6,2,1,&#x2019;*F|~6,2„&#x2019;?F|~6F|~,2F|~F&#x0022;<br>
                     x x x x x x))<br>      (foo 3.14159)  <span class="math"> ⇒</span> &#x0022;  3.14| 31.42|  3.14|3.1416|3.14|3.14159&#x0022;<br>
           (foo -3.14159) <span class="math"> ⇒</span> &#x0022; -3.14|-31.42| -3.14|-3.142|-3.14|-3.14159&#x0022;<br>
           (foo 100.0)    <span class="math"> ⇒</span> &#x0022;100.00|******|100.00| 100.0|100.00|100.0&#x0022;<br>
           (foo 1234.0)   <span class="math"> ⇒</span> &#x0022;1234.00|******|??????|1234.0|1234.00|1234.0&#x0022;<br>
           (foo 0.006)    <span class="math"> ⇒</span> &#x0022;  0.01|  0.06|  0.01| 0.006|0.01|0.006&#x0022;<br>
                                                                          

                                                                          
      <!--l. 4647--><p class="noindent" ></div>
</tt>
</div>
      <li><b>
<b>~E</b> </b></li><em>Exponential ﬂoating-point</em>. The next <em>arg</em> is printed in exponential
      notation.
      <!--l. 4653--><p class="noindent" >The full form is <b>~<em>w</em>,<em>d</em>,<em>e</em>,<em>k</em>,<em>over owchar</em>,<em>padchar</em>,<em>exponentchar</em>E</b>. The
      parameter <em>w</em> is the width of the ﬁeld to be printed; <em>d</em> is the number of digits
      to print after the decimal point; <em>e</em> is the number of digits to use when
      printing the exponent; <em>k</em> is a scale factor that defaults to 1 (not
      zero).
      <!--l. 4660--><p class="noindent" >Exactly <em>w</em> characters will be output. First, leading copies of the character
      <em>padchar</em> (which defaults to a space) are printed, if necessary, to pad the ﬁeld
      on the left. If the <em>arg</em> is negative, then a minus sign is printed; if the <em>arg</em> is
      not negative, then a plus sign is printed if and only if the <b>@</b> modiﬁer was
      speciﬁed. Then a sequence of digits, containing a single embedded decimal
      point, is printed. The form of this sequence of digits depends on the scale
      factor <em>k</em>. If <em>k</em> is zero, then <em>d</em> digits are printed after the decimal point,
      and a single zero digit appears before the decimal point if the total
      ﬁeld width will permit it. If <em>k</em> is positive, then it must be strictly
      less than <span class="math"><em>d</em> + 2</span>; <em>k</em> signiﬁcant digits are printed before the decimal
      point, and <span class="math"><em>d</em> −<em>k</em> + 1</span> digits are printed after the decimal point. If <em>k</em> is
      negative, then it must be strictly greater than <span class="math"> −<em>d</em></span>; a single zero
      digit appears before the decimal point if the total ﬁeld width will
      permit it, and after the decimal point are printed ﬁrst <span class="math"> −<em>k</em></span> zeros and
      then <span class="math"><em>d</em> + <em>k</em></span> signiﬁcant digits. The printed fraction must be properly
      rounded. (When rounding up and rounding down would produce
      printed values equidistant from the scaled value of <em>arg</em>, then the
      implementation is free to use either one. For example, printing <b>637.5</b>
      using the format <b>~8,2E</b> may correctly produce either <b>6.37E+02</b> or
      <b>6.38E+02</b>.)
      <!--l. 4687--><p class="noindent" >Following the digit sequence, the exponent is printed. First the character
      parameter <em>exponentchar</em> is printed; if this parameter is omitted, then the
      exponent marker that <b>prin1</b> would use is printed, as determined
      from the type of the ﬂoating-point number and the current value of
      <b><a 
href="symbols.html#x188-375045r45">*read-default-ﬂoat-format*</a></b>. Next, either a plus sign or a minus sign is
                                                                          

                                                                          
      printed, followed by <em>e</em> digits representing the power of 10 by which the
      printed fraction must be multiplied to properly represent the rounded value
      of <em>arg</em>.
      <!--l. 4698--><p class="noindent" >If it is impossible to print the value in the required format in a ﬁeld of width
      <em>w</em>, possibly because <em>k</em> is too large or too small or because the exponent
      cannot be printed in <em>e</em> character positions, then one of two actions is
      taken. If the parameter <em>overﬂowchar</em> is speciﬁed, then <em>w</em> copies of
      that parameter are printed instead of the scaled value of <em>arg</em>. If
      the <em>overﬂowchar</em> parameter is omitted, then the scaled value is
      printed using more than <em>w</em> characters, as many more as may be
      needed; if the problem is that <em>d</em> is too small for the speciﬁed <em>k</em> or
      that <em>e</em> is too small, then a larger value is used for <em>d</em> or <em>e</em> as may be
      needed.
      <!--l. 4710--><p class="noindent" >If the <em>w</em> parameter is omitted, then the ﬁeld is of variable width. In eﬀect a
      value is chosen for <em>w</em> in such a way that no leading pad characters need to
      be printed.
      <!--l. 4714--><p class="noindent" >If the parameter <em>d</em> is omitted, then there is no constraint on the number of
      digits to appear. A value is chosen for <em>d</em> in such a way that as many digits
      as possible may be printed subject to the width constraint imposed
      by the parameter <em>w</em>, the constraint of the scale factor <em>k</em>, and the
      constraint that no trailing zero digits may appear in the fraction, except
      that if the fraction to be printed is zero, then a single zero digit
      should appear after the decimal point if the width constraint allows
      it.
      <!--l. 4724--><p class="noindent" >If the parameter <em>e</em> is omitted, then the exponent is printed using the
      smallest number of digits necessary to represent its value.
      <!--l. 4727--><p class="noindent" >If all of <em>w</em>, <em>d</em>, and <em>e</em> are omitted, then the eﬀect is to print the value using
      ordinary free-format exponential-notation output; <b>prin1</b> uses this format for
      any non-zero number whose magnitude is less than <span class="math">10<sup>−3</sup></span> or greater than or
      equal to <span class="math">10<sup>7</sup></span>.
<div class="new">
      <!--l. 4733--><p class="noindent" >X3J13 voted in January 1989 <a 
 id="dx141-195008"></a>to amend the previous paragraph as
      follows:
      <!--l. 4737--><p class="noindent" >If all of <em>w</em>, <em>d</em>, and <em>e</em> are omitted, then the eﬀect is to print the value using
      ordinary free-format exponential-notation output; <b>prin1</b> uses a
                                                                          

                                                                          
      similar format for any non-zero number whose magnitude is less
      than <span class="math">10<sup>−3</sup></span> or greater than or equal to <span class="math">10<sup>7</sup></span>. The only diﬀerence is
      that the <b>~E</b> directive always prints a plus or minus sign before
      the exponent, while <b>prin1</b> omits the plus sign if the exponent is
      non-negative.
      <!--l. 4745--><p class="noindent" >(The amendment reconciles this paragraph with the speciﬁcation several
      paragraphs above that <b>~E</b> always prints a plus or minus sign before the
      exponent.)
      </div>
      <!--l. 4750--><p class="noindent" >If <em>arg</em> is a rational number, then it is coerced to be a <b>single-ﬂoat</b> and then
      printed. (Alternatively, an implementation is permitted to process a rational
      number by any other method that has essentially the same behavior but
      avoids such hazards as loss of precision or overﬂow because of the coercion.
      However, note that if <em>w</em> and <em>d</em> are unspeciﬁed and the number has no exact
      decimal representation, for example <b>1/3</b>, some precision cutoﬀ must be
      chosen by the implementation: only a ﬁnite number of digits may be
      printed.)
      <!--l. 4759--><p class="noindent" >If <em>arg</em> is a complex number or some non-numeric object, then it
      is printed using the format directive <b>~<em>w</em>D</b>, thereby printing it in
      decimal radix and a minimum ﬁeld width of <em>w</em>. (If it is desired to
      print each of the real part and imaginary part of a complex number
      using a <b>~E</b> directive, then this must be done explicitly with two
      <b>~E</b> directives and code to extract the two parts of the complex
      number.)
<div class="new">
      <!--l. 4768--><p class="noindent" >X3J13 voted in January 1989 <a 
 id="dx141-195009"></a>to specify that <b><a 
href="symbols.html#x188-375426r426">format</a></b> binds <b><a 
href="symbols.html#x188-375031r31">*print-escape*</a></b>
      to <b><a 
href="symbols.html#x188-375658r658">nil</a></b> during the processing of the <b>~E</b> directive.
      </div>
<div class="lisp">
<tt>
      <!--l. 4774--><p class="noindent" ><div class="tabbing">
      (defun foo (x)
                                                                          

                                                                          
      <br>                                                                            (format <b><a 
href="symbols.html#x188-375658r658">nil</a></b><br>
                     &#x0022;~9,2,1„&#x2019;*E|~10,3,2,2,&#x2019;?„&#x2019;$E|~9,3,2,-2,&#x2019;%@E|~9,2E&#x0022;<br>
                     x x x x))<br>      (foo 3.14159)  <span class="math"> ⇒</span> &#x0022;  3.14E+0| 31.42$-01|+.003E+03|  3.14E+0&#x0022;<br>
           (foo -3.14159) <span class="math"> ⇒</span> &#x0022; -3.14E+0|-31.42$-01|-.003E+03| -3.14E+0&#x0022;<br>
           (foo 1100.0)   <span class="math"> ⇒</span> &#x0022;  1.10E+3| 11.00$+02|+.001E+06|  1.10E+3&#x0022;<br>
           (foo 1100.0L0) <span class="math"> ⇒</span> &#x0022;  1.10L+3| 11.00$+02|+.001L+06|  1.10L+3&#x0022;<br>
           (foo 1.1E13)   <span class="math"> ⇒</span> &#x0022;*********| 11.00$+12|+.001E+16| 1.10E+13&#x0022;<br>
           (foo 1.1L120)  <span class="math"> ⇒</span> &#x0022;*********|??????????|%%%%%%%%%|1.10L+120&#x0022;<br>
           (foo 1.1L1200) <span class="math"> ⇒</span> &#x0022;*********|??????????|%%%%%%%%%|1.10L+1200&#x0022;<br>
      <!--l. 4786--><p class="noindent" ></div>
</tt>
</div>
      <!--l. 4787--><p class="noindent" >Here is an example of the eﬀects of varying the scale factor: <div class="lisp"><tt><div class="tabbing">
      (dotimes (k 13)
      <br>                               (format t &#x0022; %Scale factor  2D: | 13,6,2,VE|&#x0022;<br>
                     (- k 5) 3.14159))                          ;Prints 13 lines<br>
           Scale factor -5: | 0.000003E+06|<br>      Scale factor -4: | 0.000031E+05|<br>
           Scale factor -3: | 0.000314E+04|<br>      Scale factor -2: | 0.003142E+03|<br>
           Scale factor -1: | 0.031416E+02|<br>      Scale factor  0: | 0.314159E+01|<br>
           Scale factor  1: | 3.141590E+00|<br>      Scale factor  2: | 31.41590E-01|<br>
           Scale factor  3: | 314.1590E-02|<br>      Scale factor  4: | 3141.590E-03|<br>
           Scale factor  5: | 31415.90E-04|<br>      Scale factor  6: | 314159.0E-05|<br>
           Scale factor  7: | 3141590.E-06|<br>
      <!--l. 4805--><p class="noindent" ></div>
</tt>
</div>
      <!--l. 4807--><p class="noindent" >
                                                                          

                                                                          
      <li><b>
<b>~G</b> </b></li><em>General ﬂoating-point</em>. The next <em>arg</em> is printed as a ﬂoating-point number in
      either ﬁxed-format or exponential notation as appropriate.
      <!--l. 4813--><p class="noindent" >The full form is <b>~<em>w</em>,<em>d</em>,<em>e</em>,<em>k</em>,<em>over owchar</em>,<em>padchar</em>,<em>exponentchar</em>G</b>. The
      format in which to print <em>arg</em> depends on the magnitude (absolute value) of
      the <em>arg</em>. Let <em>n</em> be an integer such that <span class="math">10<sup>n−1</sup> ≤<em>arg</em> &#x003C; 10<sup>n</sup></span>. (If <em>arg</em> is zero, let
      <em>n</em> be 0.) Let <em>ee</em> equal <span class="math"><em>e</em> + 2</span>, or 4 if <em>e</em> is omitted. Let <em>ww</em> equal <span class="math"><em>w</em> −<em>ee</em></span>, or <b><a 
href="symbols.html#x188-375658r658">nil</a></b>
      if <em>w</em> is omitted. If <em>d</em> is omitted, ﬁrst let <em>q</em> be the number of digits needed
      to print <em>arg</em> with no loss of information and without leading or
      trailing zeros; then let <em>d</em> equal <b>(max <em>q</em> (min <em>n</em> 7))</b>. Let <em>dd</em> equal
      <span class="math"><em>d</em> −<em>n</em></span>.
      <!--l. 4826--><p class="noindent" >If <span class="math">0 ≤<em>dd</em> ≤<em>d</em></span>, then <em>arg</em> is printed as if by the format directives
      <div class="lisp"><tt><div class="tabbing">
      ~<em>ww</em>,<em>dd</em>„<em>overﬂowchar</em>,<em>padchar</em>F~<em>ee</em>@T
      <br>
      <!--l. 4830--><p class="noindent" ></div>
</tt>
</div>
      <!--l. 4831--><p class="noindent" >Note that the scale factor <em>k</em> is not passed to the <b>~F</b> directive. For
      all other values of <em>dd</em>, <em>arg</em> is printed as if by the format directive
      <div class="lisp"><tt><div class="tabbing">
      ~<em>w</em>,<em>d</em>,<em>e</em>,<em>k</em>,<em>overﬂowchar</em>,<em>padchar</em>,<em>exponentchar</em>E
      <br>
      <!--l. 4836--><p class="noindent" ></div>
</tt>
</div>
      <!--l. 4838--><p class="noindent" >In either case, an <b>@</b> modiﬁer is speciﬁed to the <b>~F</b> or <b>~E</b> directive if and
      only if one was speciﬁed to the <b>~G</b> directive.
                                                                          

                                                                          
<b>
      <!--l. 4842--><p class="noindent" ><a 
href="symbols.html#x188-375426r426">format</a></b> binds <b><a 
href="symbols.html#x188-375031r31">*print-escape*</a></b> to <b><a 
href="symbols.html#x188-375658r658">nil</a></b> during the processing of the <b>~G</b>
      directive.
      <!--l. 4845--><p class="noindent" >Examples: <div class="lisp"><tt><div class="tabbing">
      (defun foo (x)
      <br>                                                                            (format <b><a 
href="symbols.html#x188-375658r658">nil</a></b><br>
                     &#x0022;~9,2,1„&#x2019;*G|~9,3,2,3,&#x2019;?„&#x2019;$G|~9,3,2,0,&#x2019;%G|~9,2G&#x0022;<br>
                     x x x))<br>
      (foo 0.0314159) <span class="math"> ⇒</span> &#x0022;  3.14E-2|314.2$-04|0.314E-01|  3.14E-2&#x0022;
      <br>        (foo 0.314159)  <span class="math"> ⇒</span> &#x0022;  0.31   |0.314    |0.314    | 0.31    &#x0022;<br>
           (foo 3.14159)   <span class="math"> ⇒</span> &#x0022;   3.1   | 3.14    | 3.14    |  3.1    &#x0022;<br>
           (foo 31.4159)   <span class="math"> ⇒</span> &#x0022;   31.   | 31.4    | 31.4    |  31.    &#x0022;<br>
           (foo 314.159)   <span class="math"> ⇒</span> &#x0022;  3.14E+2| 314.    | 314.    |  3.14E+2&#x0022;<br>
           (foo 3141.59)   <span class="math"> ⇒</span> &#x0022;  3.14E+3|314.2$+01|0.314E+04|  3.14E+3&#x0022;<br>
           (foo 3141.59L0) <span class="math"> ⇒</span> &#x0022;  3.14L+3|314.2$+01|0.314L+04|  3.14L+3&#x0022;<br>
           (foo 3.14E12)   <span class="math"> ⇒</span> &#x0022;*********|314.0$+10|0.314E+13| 3.14E+12&#x0022;<br>
           (foo 3.14L120)  <span class="math"> ⇒</span> &#x0022;*********|?????????|%%%%%%%%%|3.14L+120&#x0022;<br>
           (foo 3.14L1200) <span class="math"> ⇒</span> &#x0022;*********|?????????|%%%%%%%%%|3.14L+1200&#x0022;<br>
      <!--l. 4861--><p class="noindent" ></div>
</tt>
</div>
      <!--l. 4862--><p class="noindent" >
                                                                          

                                                                          
      <li><b>
<b>~$</b> </b></li><em>Dollars ﬂoating-point</em>. The next <em>arg</em> is printed as a ﬂoating-point number in
      ﬁxed-format notation. This format is particularly convenient for printing a
      value as dollars and cents.
      <!--l. 4869--><p class="noindent" >The full form is <b>~<em>d</em>,<em>n</em>,<em>w</em>,<em>padchar</em>$</b>. The parameter <em>d</em> is the number of
      digits to print after the decimal point (default value 2); <em>n</em> is the minimum
      number of digits to print before the decimal point (default value 1); <em>w</em> is
      the minimum total width of the ﬁeld to be printed (default value
      0).
      <!--l. 4877--><p class="noindent" >First padding and the sign are output. If the <em>arg</em> is negative, then a
      minus sign is printed; if the <em>arg</em> is not negative, then a plus sign is
      printed if and only if the <b>@</b> modiﬁer was speciﬁed. If the <b>:</b> modiﬁer is
      used, the sign appears before any padding, and otherwise after the
      padding. If <em>w</em> is speciﬁed and the number of other characters to be
      output is less than <em>w</em>, then copies of <em>padchar</em> (which defaults to a
      space) are output to make the total ﬁeld width equal <em>w</em>. Then <em>n</em>
      digits are printed for the integer part of <em>arg</em>, with leading zeros if
      necessary; then a decimal point; then <em>d</em> digits of fraction, properly
      rounded.
      <!--l. 4891--><p class="noindent" >If the magnitude of <em>arg</em> is so large that more than <em>m</em> digits would have to be
      printed, where <em>m</em> is the larger of <em>w</em> and 100, then an implementation is free,
      at its discretion, to print the number using exponential notation
      instead, as if by the directive <b>~<em>w</em>,<em>q</em>„„<em>padchar</em>E</b>, where <em>w</em> and
      <em>padchar</em> are present or omitted according to whether they were
      present or omitted in the <b>~$</b> directive, and where <span class="math"><em>q</em> = <em>d</em> + <em>n</em> − 1</span>,
      where <em>d</em> and <em>n</em> are the (possibly default) values given to the <b>~$</b>
      directive.
      <!--l. 4901--><p class="noindent" >If <em>arg</em> is a rational number, then it is coerced to be a <b>single-ﬂoat</b> and then
      printed. (Alternatively, an implementation is permitted to process a rational
      number by any other method that has essentially the same behavior but
      avoids such hazards as loss of precision or overﬂow because of the
      coercion.)
      <!--l. 4907--><p class="noindent" >If <em>arg</em> is a complex number or some non-numeric object, then it
      is printed using the format directive <b>~<em>w</em>D</b>, thereby printing it in
      decimal radix and a minimum ﬁeld width of <em>w</em>. (If it is desired to
      print each of the real part and imaginary part of a complex number
                                                                          

                                                                          
      using a <b>~$</b> directive, then this must be done explicitly with two
      <b>~$</b> directives and code to extract the two parts of the complex
      number.)
<b>
      <!--l. 4915--><p class="noindent" ><a 
href="symbols.html#x188-375426r426">format</a></b> binds <b><a 
href="symbols.html#x188-375031r31">*print-escape*</a></b> to <b><a 
href="symbols.html#x188-375658r658">nil</a></b> during the processing of the <b>~$</b>
      directive.
      <li><b>
<b>~%</b> </b></li>This outputs a <b>#\Newline</b> character, thereby terminating the current
      output line and beginning a new one (see <b><a 
href="symbols.html#x188-375945r945">terpri</a></b>).
<b>
      <!--l. 4923--><p class="noindent" >~<em>n</em>%</b> outputs <em>n</em> newlines.
      <!--l. 4925--><p class="noindent" >No <em>arg</em> is used. Simply putting a newline in the control string would work,
      but <b>~%</b> is often used because it makes the control string look nicer in the
      middle of a Lisp program.
      <li><b>
<b>~&#x0026;</b> </b></li>Unless it can be determined that the output stream is already at the
      beginning of a line, this outputs a newline (see <b><a 
href="symbols.html#x188-375429r429">fresh-line</a></b>).
<b>
      <!--l. 4934--><p class="noindent" >~<em>n</em>&#x0026;</b> calls <b><a 
href="symbols.html#x188-375429r429">fresh-line</a></b> and then outputs <span class="math"><em>n</em> − 1</span> newlines. <b>~0&#x0026;</b> does
      nothing.
      <li><b>
<b>~|</b> </b></li>This outputs a page separator character, if possible. <b>~<em>n</em>|</b> does this <em>n</em> times. <b>|</b> is
      vertical bar, not capital I.
      <li><b>
<b>~~</b> </b></li><em>Tilde</em>. This outputs a tilde. <b>~<em>n</em>~</b> outputs <em>n</em> tildes.
      <li><b>
<b>~</b><span class="math">⟨</span>newline<span class="math">⟩</span> </b></li>Tilde immediately followed by a newline ignores the newline and any
      following non-newline whitespace characters. With a <b>:</b>, the newline is
      ignored, but any following whitespace is left in place. With an <b>@</b>, the
      newline is left in place, but any following whitespace is ignored. This
      directive is typically used when a format control string is too long to ﬁt
      nicely into one line of the program: <div class="lisp"><tt><div class="tabbing">
                                                                          

                                                                          
      (defun type-clash-error (fn nargs argnum right-type wrong-type)
      <br>                                                             (format *error-output*<br>
                     &#x0022;~&#x0026;Function ~S requires its ~:[~:R~;~*~] ~<br>
                      argument to be of type ~S,~%but it was called ~<br>
                      with an argument of type ~S.~%&#x0022;<br>
                     fn (eql nargs 1) argnum right-type wrong-type))<br>
           <br>                  (type-clash-error &#x2019;aref nil 2 &#x2019;integer &#x2019;vector) prints:<br>
           Function AREF requires its second argument to be of type INTEGER,<br>
           but it was called with an argument of type VECTOR.<br>
           <br>                    (type-clash-error &#x2019;car 1 1 &#x2019;list &#x2019;short-ﬂoat) prints:<br>
           Function CAR requires its argument to be of type LIST,<br>
           but it was called with an argument of type SHORT-FLOAT.<br>
      <!--l. 4971--><p class="noindent" ></div>
</tt>
</div>
      <!--l. 4972--><p class="noindent" >Note that in this example newlines appear in the output only as speciﬁed
      by the <b>~&#x0026;</b> and <b>~%</b> directives; the actual newline characters in
      the control string are suppressed because each is preceded by a
      tilde.
      <li><b>
<b>~T</b> </b></li><em>Tabulate</em>. This spaces over to a given column. <b>~<em>colnum</em>,<em>colinc</em>T</b> will output
      suﬃcient spaces to move the cursor to column <em>colnum</em>. If the cursor is
      already at or beyond column <em>colnum</em>, it will output spaces to move it to
      column <em>colnum</em>+<em>k</em>*<em>colinc</em> for the smallest positive integer <em>k</em> possible, unless
      <em>colinc</em> is zero, in which case no spaces are output if the cursor is
      already at or beyond column <em>colnum</em>. <em>colnum</em> and <em>colinc</em> default to
      <b>1</b>.
      <!--l. 4987--><p class="noindent" >Ideally, the current column position is determined by examination of the
      destination, whether a stream or string. (Although no user-level
      operation for determining the column position of a stream is deﬁned by
      Common Lisp, such a facility may exist at the implementation level.) If
      for some reason the current absolute column position cannot be
      determined by direct inquiry, <b><a 
href="symbols.html#x188-375426r426">format</a></b> may be able to deduce the current
                                                                          

                                                                          
      column position by noting that certain directives (such as <b>~%</b>, or
      <b>~&#x0026;</b>, or <b>~A</b> with the argument being a string containing a newline)
      cause the column position to be reset to zero, and counting the
      number of characters emitted since that point. If that fails, <b><a 
href="symbols.html#x188-375426r426">format</a></b>
      may attempt a similar deduction on the riskier assumption that the
      destination was at column zero when <b><a 
href="symbols.html#x188-375426r426">format</a></b> was invoked. If even this
      heuristic fails or is implementationally inconvenient, at worst the
      <b>~T</b> operation will simply output two spaces. (All this implies that
      code that uses <b><a 
href="symbols.html#x188-375426r426">format</a></b> is more likely to be portable if all format
      control strings that use the <b>~T</b> directive either begin with <b>~%</b> or
      <b>~&#x0026;</b> to force a newline or are designed to be used only when the
      destination is known from other considerations to be at column
      zero.)
<b>
      <!--l. 5009--><p class="noindent" >~@T</b> performs <em>relative</em> tabulation. <b>~<em>colrel</em>,<em>colinc</em>@T</b> outputs <em>colrel</em> spaces
      and then outputs the smallest non-negative number of additional spaces
      necessary to move the cursor to a column that is a multiple of <em>colinc</em>. For
      example, the directive <b>~3,8@T</b> outputs three spaces and then moves the
      cursor to a “standard multiple-of-eight tab stop” if not at one already. If the
      current output column cannot be determined, however, then <em>colinc</em> is
      ignored, and exactly <em>colrel</em> spaces are output.
<div class="new">
      <!--l. 5021--><p class="noindent" >X3J13 voted in June 1989 <a 
 id="dx141-195010"></a>to deﬁne <b>~:T</b> and <b>~:@T</b> to perform
      tabulation relative to a point deﬁned by the pretty printing process (see
      section <a 
href="clmse140.html#x171-24700026.4">26.4<!--tex4ht:ref: PPRINT-FORMAT-DIRECTIVES-SECTION --></a>).
      </div>
      <li><b>
<b>~*</b> </b></li>The next <em>arg</em> is ignored. <b>~<em>n</em>*</b> ignores the next <em>n</em> arguments.
<b>
      <!--l. 5029--><p class="noindent" >~:*</b> “ignores backwards”; that is, it backs up in the list of arguments so that
      the argument last processed will be processed again. <b>~<em>n</em>:*</b> backs up <em>n</em>
      arguments.
      <!--l. 5033--><p class="noindent" >When within a <b>~{</b> construct (see below), the ignoring (in either
      direction) is relative to the list of arguments being processed by the
      iteration.
<b>
                                                                          

                                                                          
      <!--l. 5037--><p class="noindent" >~<em>n</em>@*</b> is an “absolute goto” rather than a “relative goto”: it goes to the <em>n</em>th
      <em>arg</em>, where 0 means the ﬁrst one; <em>n</em> defaults to 0, so <b>~@*</b> goes back to the
      ﬁrst <em>arg</em>. Directives after a <b>~<em>n</em>@*</b> will take arguments in sequence
      beginning with the one gone to. When within a <b>~{</b> construct, the
      “goto” is relative to the list of arguments being processed by the
      iteration.
      <li><b>
<b>~?</b> </b></li><em>Indirection</em>. The next <em>arg</em> must be a string, and the one after it a list; both are
      consumed by the <b>~?</b> directive. The string is processed as a <b><a 
href="symbols.html#x188-375426r426">format</a></b> control
      string, with the elements of the list as the arguments. Once the recursive
      processing of the control string has been ﬁnished, then processing of the
      control string containing the <b>~?</b> directive is resumed. Example:
      <div class="lisp"><tt><div class="tabbing">
      (format nil &#x0022;~? ~D&#x0022; &#x0022;&#x003C;~A ~D&#x003E;&#x0022; &#x2019;(&#x0022;Foo&#x0022; 5) 7) <span class="math"> ⇒</span> &#x0022;&#x003C;Foo 5&#x003E; 7&#x0022;
      <br>        (format nil &#x0022;~? ~D&#x0022; &#x0022;&#x003C;~A ~D&#x003E;&#x0022; &#x2019;(&#x0022;Foo&#x0022; 5 14) 7) <span class="math"> ⇒</span> &#x0022;&#x003C;Foo 5&#x003E; 7&#x0022;<br>
      <!--l. 5057--><p class="noindent" ></div>
</tt>
</div>
      <!--l. 5058--><p class="noindent" >Note that in the second example three arguments are supplied to the control
      string <b>&#x0022;&#x003C;~A ~D&#x003E;&#x0022;</b>, but only two are processed and the third is therefore
      ignored.
      <!--l. 5062--><p class="noindent" >With the <b>@</b> modiﬁer, only one <em>arg</em> is directly consumed. The <em>arg</em> must be a
      string; it is processed as part of the control string as if it had appeared in
      place of the <b>~@?</b> construct, and any directives in the recursively processed
      control string may consume arguments of the control string containing the
      <b>~@?</b> directive. Example: <div class="lisp"><tt><div class="tabbing">
      (format nil &#x0022;~@? ~D&#x0022; &#x0022;&#x003C;~A ~D&#x003E;&#x0022; &#x0022;Foo&#x0022; 5 7) <span class="math"> ⇒</span> &#x0022;&#x003C;Foo 5&#x003E; 7&#x0022;
      <br>        (format nil &#x0022;~@? ~D&#x0022; &#x0022;&#x003C;~A ~D&#x003E;&#x0022; &#x0022;Foo&#x0022; 5 14 7) <span class="math"> ⇒</span> &#x0022;&#x003C;Foo 5&#x003E; 14&#x0022;<br>
                                                                          

                                                                          
      <!--l. 5072--><p class="noindent" ></div>
</tt>
</div>
      <!--l. 5074--><p class="noindent" >Here is a rather sophisticated example. The <b><a 
href="symbols.html#x188-375426r426">format</a></b> function itself, as
      implemented at one time in Lisp Machine Lisp, used a routine internal to
      the <b><a 
href="symbols.html#x188-375426r426">format</a></b> package called <b>format-error</b> to signal error messages;
      <b>format-error</b> in turn used <b><a 
href="symbols.html#x188-375371r371">error</a></b>, which used <b><a 
href="symbols.html#x188-375426r426">format</a></b> recursively. Now
      <b>format-error</b> took a string and arguments, just like <b><a 
href="symbols.html#x188-375426r426">format</a></b>, but
      also printed the control string to <b><a 
href="symbols.html#x188-375426r426">format</a></b> (which at this point was
      available in the global variable <b>*ctl-string*</b>) and a little arrow showing
      where in the processing of the control string the error occurred. The
      variable <b>*ctl-index*</b> pointed one character after the place of the error.
      <div class="lisp"><tt><div class="tabbing">
      (defun format-error (string &#x0026;rest args)     ;Example
      <br>                             (error <b><a 
href="symbols.html#x188-375658r658">nil</a></b> &#x0022;~?~%~V@T<span class="math"> ⇓</span>~%~3@T\&#x0022;~A\&#x0022;~%&#x0022;<br>
                    string args (+ *ctl-index* 3) *ctl-string*))<br>
      <!--l. 5090--><p class="noindent" ></div>
</tt>
</div>
      <!--l. 5091--><p class="noindent" >(The character set used in the Lisp Machine Lisp implementation contains a
      down-arrow character <b><span class="math"> ⇓</span></b>, which is not a standard Common Lisp character.)
      This ﬁrst processed the given string and arguments using <b>~?</b>, then output a
      newline, tabbed a variable amount for printing the down-arrow, and printed
      the control string between double quotes (note the use of <b>\&#x0022;</b> to include
      double quotes within the control string). The eﬀect was something like this:
      <div class="lisp"><tt><div class="tabbing">
      (format t &#x0022;The item is a ~[Foo~;Bar~;Loser~].&#x0022; &#x2019;quux)
      <br>                »ERROR: The argument to the FORMAT &#x0022;~[&#x0022; command<br>
                    must be a number.<br>                             <span class="math"> ⇓</span><br>
              &#x0022;The item is a ~[Foo~;Bar~;Loser~].&#x0022;<br>
                                                                          

                                                                          
      <!--l. 5104--><p class="noindent" ></div>
</tt>
</div>__________________________________________________________________________<div class="implementation">
        <!--l. 5107--><p class="noindent" ><b>Заметка для реализации:</b> Implementors may wish to report errors occurring
        within <b><a 
href="symbols.html#x188-375426r426">format</a></b> control strings in the manner outlined here. It looks pretty ﬂashy
        when done properly.
        </div>___________________________________________________________________________________________________
        </ul>
</div>
<div class="new">
<!--l. 5116--><p class="indent" >     X3J13 voted in June 1989 <a 
 id="dx141-195011"></a>to introduce certain <b><a 
href="symbols.html#x188-375426r426">format</a></b> directives to
support the user interface to the pretty printer described in detail in
chapter <a 
href="pprint.html#x167-24300026">26<!--tex4ht:ref: PPRINT --></a>.
<div class="flushdesc">
        <ul><li><b>
<b>~_</b> </b></li><em>Conditional  newline.</em>  Without  any  modiﬁers,  the  directive  <b>~_</b>  is
        equivalent  to  <b>(pprint-newline  :linear)</b>.  The  directive  <b>~@_</b>  is
        equivalent  to  <b>(pprint-newline  :miser)</b>.  The  directive  <b>~:_</b>  is
        equivalent to <b>(pprint-newline :ﬁll)</b>. The directive <b>~:@_</b> is equivalent
        to <b>(pprint-newline :mandatory)</b>.
        <li><b>
<b>~W</b> </b></li><em>Write.</em> An <em>arg</em>, any Lisp object, is printed obeying <em>every</em> printer control
        variable (as by <b><a 
href="symbols.html#x188-376013r1013">write</a></b>). See section <a 
href="clmse140.html#x171-24700026.4">26.4<!--tex4ht:ref: PPRINT-FORMAT-DIRECTIVES-SECTION --></a> for details.
        <li><b>
<b>~I</b> </b></li><em>Indent.</em> The directive <b>~<em>n</em>I</b> is equivalent to <b>(pprint-indent :block <em>n</em>)</b>.
        The directive <b>~:<em>n</em>I</b> is equivalent to <b>(pprint-indent :current <em>n</em>)</b>. In
        both cases, <em>n</em> defaults to zero, if it is omitted.</ul>
</div>
</div>
<!--l. 5145--><p class="indent" >     The format directives after this point are much more complicated than
the foregoing; they constitute control structures that can perform case
conversion, conditional selection, iteration, justiﬁcation, and non-local
exits. Used with restraint, they can perform powerful tasks. Used with
abandon, they can produce completely unreadable and unmaintainable
code.
                                                                          

                                                                          
<!--l. 5152--><p class="indent" >   The case-conversion, conditional, iteration, and justiﬁcation constructs can
contain other formatting constructs by bracketing them. These constructs
must nest properly with respect to each other. For example, it is not
legitimate to put the start of a case-conversion construct in each arm of a
conditional and the end of the case-conversion construct outside the conditional:
<div class="lisp"><tt><div class="tabbing">
(format <b><a 
href="symbols.html#x188-375658r658">nil</a></b> &#x0022;~:[abc~:@(def~;ghi~:@(jkl~]mno~)&#x0022; x)     ;Illegal!
   <br>
<!--l. 5160--><p class="noindent" ></div>
</tt>
</div>
<!--l. 5161--><p class="indent" >   One might expect this to produce either <b>&#x0022;abcDEFMNO&#x0022;</b> or <b>&#x0022;ghiJKLMNO&#x0022;</b>,
depending on whether <b>x</b> is false or true; but in fact the construction is
illegal because the <b>~[...~;...~]</b> and <b>~(...~)</b> constructs are not properly
nested.
<!--l. 5166--><p class="indent" >   The processing indirection caused by the <b>~?</b> directive is also a kind of nesting
for the purposes of this rule of proper nesting. It is not permitted to start a
bracketing construct within a string processed under control of a <b>~?</b> directive
and end the construct at some point after the <b>~?</b> construct in the string
containing that construct, or vice versa. For example, this situation is illegal:
<div class="lisp"><tt><div class="tabbing">
(format <b><a 
href="symbols.html#x188-375658r658">nil</a></b> &#x0022;~?ghi~)&#x0022; &#x0022;abc~@(def&#x0022;)     ;Illegal!
   <br>
<!--l. 5176--><p class="noindent" ></div>
</tt>
</div>
<!--l. 5177--><p class="indent" >   One might expect it to produce <b>&#x0022;abcDEFGHI&#x0022;</b>, but in fact the
construction is illegal because the <b>~?</b> and <b>~(...~)</b> constructs are not properly
nested.
<div class="flushdesc">
                                                                          

                                                                          
      <ul><li><b>
<b>~(<em>str</em>~)</b> </b></li><em>Case conversion</em>. The contained control string <em>str</em> is processed, and
      what it produces is subject to case conversion: <b>~(</b> converts every uppercase
      character to the corresponding lowercase character; <b>~:(</b> capitalizes all words,
      as if by <b><a 
href="symbols.html#x188-375897r897">string-capitalize</a></b>; <b>~@(</b> capitalizes just the ﬁrst word and forces
      the rest to lowercase; <b>~:@(</b> converts every lowercase character to
      the corresponding uppercase character. In this example, <b>~@(</b> is
      used to cause the ﬁrst word produced by <b>~@R</b> to be capitalized:
      <div class="lisp"><tt><div class="tabbing">
      (format nil &#x0022;~@R ~(~@R~)&#x0022; 14 14) <span class="math"> ⇒</span> &#x0022;XIV xiv&#x0022;
      <br>               (defun f (n) (format nil &#x0022;~@(~R~) error~:P detected.&#x0022; n))<br>
           (f 0) <span class="math"> ⇒</span> &#x0022;Zero errors detected.&#x0022;<br>
           (f 1) <span class="math"> ⇒</span> &#x0022;One error detected.&#x0022;<br>
           (f 23) <span class="math"> ⇒</span> &#x0022;Twenty-three errors detected.&#x0022;<br>
      <!--l. 5200--><p class="noindent" ></div>
</tt>
</div>
      <li><b>
<b>~[<em>str0</em>~;<em>str1</em>~;<em>...</em>~;<em>strn</em>~]</b> </b></li><em>Conditional expression</em>. This is a set of control
      strings, called <em>clauses</em>, one of which is chosen and used. The clauses are
      separated by <b>~;</b> and the construct is terminated by <b>~]</b>. For example,
      <div class="lisp"><tt><div class="tabbing">
      &#x0022;~[Siamese~;Manx~;Persian~] Cat&#x0022;
      <br>
      <!--l. 5209--><p class="noindent" ></div>
</tt>
</div>
                                                                          

                                                                          
      <!--l. 5210--><p class="noindent" >The <em>arg</em>th clause is selected, where the ﬁrst clause is number 0. If a preﬁx
      parameter is given (as <b>~<em>n</em>[</b>), then the parameter is used instead of an
      argument. (This is useful only if the parameter is speciﬁed by <b>#</b>, to dispatch
      on the number of arguments remaining to be processed.) If <em>arg</em> is out of
      range, then no clause is selected (and no error is signaled). After the selected
      alternative has been processed, the control string continues after the
      <b>~]</b>.
<b>
      <!--l. 5221--><p class="noindent" >~[<em>str0</em>~;<em>str1</em>~;<em>...</em>~;<em>strn</em>~:;<em>default</em>~]</b> has a default case. If the <em>last</em> <b>~;</b>
      used to separate clauses is <b>~:;</b> instead, then the last clause is an “else”
      clause that is performed if no other clause is selected. For example:
      <div class="lisp"><tt><div class="tabbing">
      &#x0022;~[Siamese~;Manx~;Persian~:;Alley~] Cat&#x0022;
      <br>
      <!--l. 5228--><p class="noindent" ></div>
</tt>
</div>
<b>
      <!--l. 5230--><p class="noindent" >~:[<em>false</em>~;<em>true</em>~]</b> selects the <em>false</em> control string if <em>arg</em> is <b><a 
href="symbols.html#x188-375658r658">nil</a></b>, and selects the
      <em>true</em> control string otherwise.
<b>
      <!--l. 5233--><p class="noindent" >~@[<em>true</em>~]</b> tests the argument. If it is not <b><a 
href="symbols.html#x188-375658r658">nil</a></b>, then the argument is not
      used up by the <b>~@[</b> command but remains as the next one to be processed,
      and the one clause <em>true</em> is processed. If the <em>arg</em> is <b><a 
href="symbols.html#x188-375658r658">nil</a></b>, then the argument is
      used up, and the clause is not processed. The clause therefore should
      normally use exactly one argument, and may expect it to be non-<b><a 
href="symbols.html#x188-375658r658">nil</a></b>. For
      example: <div class="lisp"><tt><div class="tabbing">
      (setq *print-level* <b><a 
href="symbols.html#x188-375658r658">nil</a></b> *print-length* 5)
                                                                          

                                                                          
      <br>          (format <b><a 
href="symbols.html#x188-375658r658">nil</a></b> &#x0022;~@[ print level = ~D~]~@[ print length = ~D~]&#x0022;<br>
                       *print-level* *print-length*)<br>
              <span class="math"> ⇒</span> &#x0022; print length = 5&#x0022;<br>
      <!--l. 5247--><p class="noindent" ></div>
</tt>
</div>
      <!--l. 5249--><p class="noindent" >The combination of <b>~[</b> and <b>#</b> is useful, for example, for dealing with
      English conventions for printing lists: <div class="lisp"><tt><div class="tabbing">
      (setq foo &#x0022;Items:~#[ none~; ~S~; ~S and ~S~
      <br>                                          ~:;~@{~#[~; and~] ~S~̂,~}~].&#x0022;)<br>
           (format <b><a 
href="symbols.html#x188-375658r658">nil</a></b> foo)<br>
                   <span class="math"> ⇒</span> &#x0022;Items: none.&#x0022;<br>               (format <b><a 
href="symbols.html#x188-375658r658">nil</a></b> foo &#x2019;foo)<br>
                   <span class="math"> ⇒</span> &#x0022;Items: FOO.&#x0022;<br>          (format <b><a 
href="symbols.html#x188-375658r658">nil</a></b> foo &#x2019;foo &#x2019;bar)<br>
                   <span class="math"> ⇒</span> &#x0022;Items: FOO and BAR.&#x0022;<br>
           (format <b><a 
href="symbols.html#x188-375658r658">nil</a></b> foo &#x2019;foo &#x2019;bar &#x2019;baz)<br>
                   <span class="math"> ⇒</span> &#x0022;Items: FOO, BAR, and BAZ.&#x0022;<br>
           (format <b><a 
href="symbols.html#x188-375658r658">nil</a></b> foo &#x2019;foo &#x2019;bar &#x2019;baz &#x2019;quux)<br>
                   <span class="math"> ⇒</span> &#x0022;Items: FOO, BAR, BAZ, and QUUX.&#x0022;<br>
      <!--l. 5264--><p class="noindent" ></div>
</tt>
</div>
      <li><b>
<b>~;</b> </b></li>This separates clauses in <b>~[</b> and <b>~&#x003C;</b> constructions. It is an error elsewhere.
      <li><b>
<b>~]</b> </b></li>This terminates a <b>~[</b>. It is an error elsewhere.
      <li><b>
<b>~{<em>str</em>~}</b> </b></li><em>Iteration</em>. This is an iteration construct. The argument should be a list,
      which is used as a set of arguments as if for a recursive call to <b><a 
href="symbols.html#x188-375426r426">format</a></b>. The
      string <em>str</em> is used repeatedly as the control string. Each iteration can absorb
      as many elements of the list as it likes as arguments; if <em>str</em> uses up two
                                                                          

                                                                          
      arguments by itself, then two elements of the list will get used up each
      time around the loop. If before any iteration step the list is empty,
      then the iteration is terminated. Also, if a preﬁx parameter <em>n</em> is
      given, then there will be at most <em>n</em> repetitions of processing of <em>str</em>.
      Finally, the <b>~̂</b> directive can be used to terminate the iteration
      prematurely.
      <!--l. 5288--><p class="noindent" >Here are some simple examples: <div class="lisp"><tt><div class="tabbing">
      (format <b><a 
href="symbols.html#x188-375658r658">nil</a></b>
      <br>                                             &#x0022;The winners are:~{ ~S~}.&#x0022;<br>
                   &#x2019;(fred harry jill))<br>
                <span class="math"> ⇒</span> &#x0022;The winners are: FRED HARRY JILL.&#x0022;<br>
           <br>                  (format <b><a 
href="symbols.html#x188-375658r658">nil</a></b> &#x0022;Pairs:~{ &#x003C;~S,~S&#x003E;~}.&#x0022; &#x2019;(a 1 b 2 c 3))<br>
                <span class="math"> ⇒</span> &#x0022;Pairs: &#x003C;A,1&#x003E; &#x003C;B,2&#x003E; &#x003C;C,3&#x003E;.&#x0022;<br>
      <!--l. 5297--><p class="noindent" ></div>
</tt>
</div>
<b>
      <!--l. 5299--><p class="noindent" >~:{<em>str</em>~}</b> is similar, but the argument should be a list of sublists. At
      each repetition step, one sublist is used as the set of arguments
      for processing <em>str</em>; on the next repetition, a new sublist is used,
      whether or not all of the last sublist had been processed. Example:
      <div class="lisp"><tt><div class="tabbing">
      (format <b><a 
href="symbols.html#x188-375658r658">nil</a></b> &#x0022;Pairs:~:{ &#x003C;~S,~S&#x003E;~}.&#x0022;
      <br>                                                            &#x2019;((a 1) (b 2) (c 3)))<br>
                <span class="math"> ⇒</span> &#x0022;Pairs: &#x003C;A,1&#x003E; &#x003C;B,2&#x003E; &#x003C;C,3&#x003E;.&#x0022;<br>
      <!--l. 5307--><p class="noindent" ></div>
</tt>
</div>
                                                                          

                                                                          
<b>
      <!--l. 5309--><p class="noindent" >~@{<em>str</em>~}</b> is similar to <b>~{<em>str</em>~}</b>, but instead of using one argument that is
      a list, all the remaining arguments are used as the list of arguments for the
      iteration. Example: <div class="lisp"><tt><div class="tabbing">
      (format <b><a 
href="symbols.html#x188-375658r658">nil</a></b> &#x0022;Pairs:~@{ &#x003C;~S,~S&#x003E;~}.&#x0022;
      <br>                                                                   &#x2019;a 1 &#x2019;b 2 &#x2019;c 3)<br>
                <span class="math"> ⇒</span> &#x0022;Pairs: &#x003C;A,1&#x003E; &#x003C;B,2&#x003E; &#x003C;C,3&#x003E;.&#x0022;<br>
      <!--l. 5317--><p class="noindent" ></div>
</tt>
</div>
      <!--l. 5318--><p class="noindent" >If the iteration is terminated before all the remaining arguments
      are consumed, then any arguments not processed by the iteration
      remain to be processed by any directives following the iteration
      construct.
<b>
      <!--l. 5322--><p class="noindent" >~:@{<em>str</em>~}</b> combines the features of <b>~:{<em>str</em>~}</b> and <b>~@{<em>str</em>~}</b>. All the
      remaining arguments are used, and each one must be a list. On each
      iteration, the next argument is used as a list of arguments to <em>str</em>. Example:
      <div class="lisp"><tt><div class="tabbing">
      (format <b><a 
href="symbols.html#x188-375658r658">nil</a></b> &#x0022;Pairs:~:@{ &#x003C;~S,~S&#x003E;~}.&#x0022;
      <br>                                                            &#x2019;(a 1) &#x2019;(b 2) &#x2019;(c 3))<br>
                <span class="math"> ⇒</span> &#x0022;Pairs: &#x003C;A,1&#x003E; &#x003C;B,2&#x003E; &#x003C;C,3&#x003E;.&#x0022;<br>
      <!--l. 5333--><p class="noindent" ></div>
</tt>
</div>
      <!--l. 5335--><p class="noindent" >Terminating the repetition construct with <b>~:}</b> instead of <b>~}</b> forces <em>str</em> to
      be processed at least once, even if the initial list of arguments is
      null (however, it will not override an explicit preﬁx parameter of
      zero).
                                                                          

                                                                          
      <!--l. 5340--><p class="noindent" >If <em>str</em> is empty, then an argument is used as <em>str</em>. It must be a string and
      precede any arguments processed by the iteration. As an example, the
      following are equivalent: <div class="lisp"><tt><div class="tabbing">
      (apply #&#x2019;format stream string arguments)
      <br>                                   (format stream &#x0022;~1{~:}&#x0022; string arguments)<br>
      <!--l. 5346--><p class="noindent" ></div>
</tt>
</div>
      <!--l. 5347--><p class="noindent" >This will use <b><a 
href="symbols.html#x188-375896r896">string</a></b> as a formatting string. The <b>~1{</b> says it will be
      processed at most once, and the <b>~:}</b> says it will be processed at
      least once. Therefore it is processed exactly once, using <b>arguments</b>
      as the arguments. This case may be handled more clearly by the
      <b>~?</b> directive, but this general feature of <b>~{</b> is more powerful than
      <b>~?</b>.
      <li><b>
<b>~}</b> </b></li>This terminates a <b>~{</b>. It is an error elsewhere.
      <li><b>
<b>~<em>mincol</em>,<em>colinc</em>,<em>minpad</em>,<em>padchar</em>&#x003C;<em>str</em>~&#x003E;</b> </b></li><em>Justiﬁcation</em>. This justiﬁes the text
      produced by processing <em>str</em> within a ﬁeld at least <em>mincol</em> columns wide. <em>str</em>
      may be divided up into segments with <b>~;</b>, in which case the spacing is
      evenly divided between the text segments.
      <!--l. 5364--><p class="noindent" >With no modiﬁers, the leftmost text segment is left-justiﬁed in the ﬁeld, and
      the rightmost text segment right-justiﬁed; if there is only one text element,
      as a special case, it is right-justiﬁed. The <b>:</b> modiﬁer causes spacing to be
      introduced before the ﬁrst text segment; the <b>@</b> modiﬁer causes spacing to be
      added after the last. The <em>minpad</em> parameter (default <b>0</b>) is the minimum
      number of padding characters to be output between each segment. The
      padding character is speciﬁed by <em>padchar</em>, which defaults to the space
      character. If the total width needed to satisfy these constraints is greater
      than <em>mincol</em>, then the width used is <em>mincol</em>+<em>k</em>*<em>colinc</em> for the smallest
      possible non-negative integer value <em>k</em>; <em>colinc</em> defaults to <b>1</b>, and <em>mincol</em>
      defaults to <b>0</b>.
                                                                          

                                                                          
<div class="lisp">
<tt>
      <!--l. 5379--><p class="noindent" ><div class="tabbing">
      (format <b><a 
href="symbols.html#x188-375658r658">nil</a></b> &#x0022;~10&#x003C;foo~;bar~&#x003E;&#x0022;)          <span class="math"> ⇒</span> &#x0022;foo    bar&#x0022;
      <br>            (format <b><a 
href="symbols.html#x188-375658r658">nil</a></b> &#x0022;~10:&#x003C;foo~;bar~&#x003E;&#x0022;)         <span class="math"> ⇒</span> &#x0022;  foo  bar&#x0022;<br>
           (format <b><a 
href="symbols.html#x188-375658r658">nil</a></b> &#x0022;~10:@&#x003C;foo~;bar~&#x003E;&#x0022;)        <span class="math"> ⇒</span> &#x0022;  foo bar &#x0022;<br>
           (format <b><a 
href="symbols.html#x188-375658r658">nil</a></b> &#x0022;~10&#x003C;foobar~&#x003E;&#x0022;)            <span class="math"> ⇒</span> &#x0022;    foobar&#x0022;<br>
           (format <b><a 
href="symbols.html#x188-375658r658">nil</a></b> &#x0022;~10:&#x003C;foobar~&#x003E;&#x0022;)           <span class="math"> ⇒</span> &#x0022;    foobar&#x0022;<br>
           (format <b><a 
href="symbols.html#x188-375658r658">nil</a></b> &#x0022;~10@&#x003C;foobar~&#x003E;&#x0022;)           <span class="math"> ⇒</span> &#x0022;foobar    &#x0022;<br>
           (format <b><a 
href="symbols.html#x188-375658r658">nil</a></b> &#x0022;~10:@&#x003C;foobar~&#x003E;&#x0022;)          <span class="math"> ⇒</span> &#x0022;  foobar  &#x0022;<br>
      <!--l. 5387--><p class="noindent" ></div>
</tt>
</div>
      <!--l. 5389--><p class="noindent" >Note that <em>str</em> may include <b><a 
href="symbols.html#x188-375426r426">format</a></b> directives. All the clauses in <em>str</em>
      are processed in order; it is the resulting pieces of text that are
      justiﬁed.
      <!--l. 5393--><p class="noindent" >The <b>~̂</b> directive may be used to terminate processing of the clauses
      prematurely, in which case only the completely processed clauses are
      justiﬁed.
      <!--l. 5397--><p class="noindent" >If the ﬁrst clause of a <b>~&#x003C;</b> is terminated with <b>~:;</b> instead of <b>~;</b>, then it is
      used in a special way. All of the clauses are processed (subject to <b>~̂</b>, of
      course), but the ﬁrst one is not used in performing the spacing and padding.
      When the padded result has been determined, then if it will ﬁt on the
      current line of output, it is output, and the text for the ﬁrst clause is
      discarded. If, however, the padded text will not ﬁt on the current
      line, then the text segment for the ﬁrst clause is output before the
      padded text. The ﬁrst clause ought to contain a newline (such as
      a <b>~%</b> directive). The ﬁrst clause is always processed, and so any
      arguments it refers to will be used; the decision is whether to use the
      resulting segment of text, not whether to process the ﬁrst clause. If
      the <b>~:;</b> has a preﬁx parameter <em>n</em>, then the padded text must ﬁt
      on the current line with <em>n</em> character positions to spare to avoid
                                                                          

                                                                          
      outputting the ﬁrst clause&#x2019;s text. For example, the control string
      <div class="lisp"><tt><div class="tabbing">
      &#x0022;~%;; ~{~&#x003C;~%;; ~1:; ~S~&#x003E;~̂,~}.~%&#x0022;
      <br>
      <!--l. 5414--><p class="noindent" ></div>
</tt>
</div>
      <!--l. 5415--><p class="noindent" >can be used to print a list of items separated by commas without breaking
      items over line boundaries, beginning each line with <b>;; </b>. The preﬁx
      parameter <b>1</b> in <b>~1:;</b> accounts for the width of the comma that will follow
      the justiﬁed item if it is not the last element in the list, or the period if it is.
      If <b>~:;</b> has a second preﬁx parameter, then it is used as the width of the line,
      thus overriding the natural line width of the output stream. To
      make the preceding example use a line width of 50, one would write
      <div class="lisp"><tt><div class="tabbing">
      &#x0022;~%;; ~{~&#x003C;~%;; ~1,50:; ~S~&#x003E;~̂,~}.~%&#x0022;
      <br>
      <!--l. 5425--><p class="noindent" ></div>
</tt>
</div>
      <!--l. 5427--><p class="noindent" >If the second argument is not speciﬁed, then <b><a 
href="symbols.html#x188-375426r426">format</a></b> uses the line width
      of the output stream. If this cannot be determined (for example,
      when producing a string result), then <b><a 
href="symbols.html#x188-375426r426">format</a></b> uses <b>72</b> as the line
      length.
      <li><b>
<b>~&#x003E;</b> </b></li>Terminates a <b>~&#x003C;</b>. It is an error elsewhere. <div class="new"> X3J13 voted in June 1989 <a 
 id="dx141-195012"></a>to
      introduce certain <b><a 
href="symbols.html#x188-375426r426">format</a></b> directives to support the user interface to the
                                                                          

                                                                          
      pretty printer. If <b>~:&#x003E;</b> is used to terminate a <b>~&#x003C;...</b> directive, the directive is
      equivalent to a call on <b><a 
href="symbols.html#x188-375729r729">pprint-logical-block</a></b>. See section <a 
href="clmse140.html#x171-24700026.4">26.4<!--tex4ht:ref: PPRINT-FORMAT-DIRECTIVES-SECTION --></a> for
      details.
      </div>
      <li><b>
<b>~̂</b> </b></li><em>Up and out</em>. This is an escape construct. If there are no more arguments
      remaining to be processed, then the immediately enclosing <b>~{</b> or <b>~&#x003C;</b>
      construct is terminated. If there is no such enclosing construct, then the
      entire formatting operation is terminated. In the <b>~&#x003C;</b> case, the formatting <em>is</em>
      performed, but no more segments are processed before doing the
      justiﬁcation. The <b>~̂</b> should appear only at the <em>beginning</em> of a <b>~&#x003C;</b>
      clause, because it aborts the entire clause it appears in (as well as all
      following clauses). <b>~̂</b> may appear anywhere in a <b>~{</b> construct.
      <div class="lisp"><tt><div class="tabbing">
      (setq donestr &#x0022;Done.~̂ ~D warning~:P.~̂ ~D error~:P.&#x0022;)
      <br>                                                (format <b><a 
href="symbols.html#x188-375658r658">nil</a></b> donestr) <span class="math"> ⇒</span> &#x0022;Done.&#x0022;<br>
           (format <b><a 
href="symbols.html#x188-375658r658">nil</a></b> donestr 3) <span class="math"> ⇒</span> &#x0022;Done. 3 warnings.&#x0022;<br>
           (format <b><a 
href="symbols.html#x188-375658r658">nil</a></b> donestr 1 5) <span class="math"> ⇒</span> &#x0022;Done. 1 warning. 5 errors.&#x0022;<br>
      <!--l. 5460--><p class="noindent" ></div>
</tt>
</div>
      <!--l. 5462--><p class="noindent" >If a preﬁx parameter is given, then termination occurs if the parameter is
      zero. (Hence <b>~̂</b> is equivalent to <b>~#̂</b>.) If two parameters are given,
      termination occurs if they are equal. If three parameters are given,
      termination occurs if the ﬁrst is less than or equal to the second and the
      second is less than or equal to the third. Of course, this is useless if all the
      preﬁx parameters are constants; at least one of them should be a <b>#</b> or a <b>V</b>
      parameter.
      <!--l. 5470--><p class="noindent" >If <b>~̂</b> is used within a <b>~:{</b> construct, then it merely terminates
      the current iteration step (because in the standard case it tests for
      remaining arguments of the current step only); the next iteration step
      commences immediately. To terminate the entire iteration process, use
                                                                          

                                                                          
      <b>~:̂</b>.
<div class="new">
      <!--l. 5477--><p class="noindent" >X3J13 voted in March 1988 <a 
 id="dx141-195013"></a>to clarify the behavior of <b>~:̂</b> as follows. It may
      be used only if the command it would terminate is <b>~:{</b> or <b>~:@{</b>. The entire
      iteration process is terminated if and only if the sublist that is supplying the
      arguments for the current iteration step is the last sublist (in the case of
      terminating a <b>~:{</b> command) or the last argument to that call to <b><a 
href="symbols.html#x188-375426r426">format</a></b>
      (in the case of terminating a <b>~:@{</b> command). Note furthermore
      that while <b>~̂</b> is equivalent to <b>~#̂</b> in all circumstances, <b>~:̂</b> is
      <em>not</em> equivalent to <b>~:#̂</b> because the latter terminates the entire
      iteration if and only if no arguments remain for <em>the current iteration
      step</em> (as opposed to no arguments remaining for the entire iteration
      process).
      <!--l. 5493--><p class="noindent" >Here are some examples of the diﬀerences in the behaviors of <b>~̂</b>, <b>~:̂</b>, and
      <b>~:#̂</b>. <div class="lisp"><tt><div class="tabbing">
      (format nil
      <br>                                                                 &#x0022;~:{/~S~̂ ...~}&#x0022;<br>
                   &#x2019;((hot dog) (hamburger) (ice cream) (french fries)))<br>
            <span class="math"> ⇒</span> &#x0022;/HOT .../HAMBURGER/ICE .../FRENCH ...&#x0022;<br>
      <!--l. 5501--><p class="noindent" ></div>
</tt>
</div>
      <!--l. 5502--><p class="noindent" >For each sublist, “<b> ...</b>” appears after the ﬁrst word unless there are no
      additional words. <div class="lisp"><tt><div class="tabbing">
      (format nil
      <br>                                                                &#x0022;~:{/~S~:̂ ...~}&#x0022;<br>
                   &#x2019;((hot dog) (hamburger) (ice cream) (french fries)))<br>
            <span class="math"> ⇒</span> &#x0022;/HOT .../HAMBURGER .../ICE .../FRENCH&#x0022;<br>
                                                                          

                                                                          
      <!--l. 5509--><p class="noindent" ></div>
</tt>
</div>
      <!--l. 5510--><p class="noindent" >For each sublist, “<b> ...</b>” always appears after the ﬁrst word, unless it is
      the last sublist, in which case the entire iteration is terminated.
      <div class="lisp"><tt><div class="tabbing">
      (format nil
      <br>                                                             &#x0022;~:{/~S~:#̂ ...~}&#x0022;<br>
                   &#x2019;((hot dog) (hamburger) (ice cream) (french fries)))<br>
            <span class="math"> ⇒</span> &#x0022;/HOT .../HAMBURGER&#x0022;<br>
      <!--l. 5517--><p class="noindent" ></div>
</tt>
</div>
      <!--l. 5518--><p class="noindent" >For each sublist, “<b> ...</b>” appears after the ﬁrst word, but if the sublist has
      only one word then the entire iteration is terminated.
      </div>
      <!--l. 5522--><p class="noindent" >If <b>~̂</b> appears within a control string being processed under the control of a
      <b>~?</b> directive, but not within any <b>~{</b> or <b>~&#x003C;</b> construct within that string,
      then the string being processed will be terminated, thereby ending
      processing of the <b>~?</b> directive. Processing then continues within
      the string containing the <b>~?</b> directive at the point following that
      directive.
      <!--l. 5531--><p class="noindent" >If <b>~̂</b> appears within a <b>~[</b> or <b>~(</b> construct, then all the commands up to the
      <b>~̂</b> are properly selected or case-converted, the <b>~[</b> or <b>~(</b> processing is
      terminated, and the outward search continues for a <b>~{</b> or <b>~&#x003C;</b> construct to
      be terminated. For example: <div class="lisp"><tt><div class="tabbing">
      (setq tellstr &#x0022;~@(~@[~R~]~̂ ~A.~)&#x0022;)
                                                                          

                                                                          
      <br>                                    (format <b><a 
href="symbols.html#x188-375658r658">nil</a></b> tellstr 23) <span class="math"> ⇒</span> &#x0022;Twenty-three.&#x0022;<br>
           (format <b><a 
href="symbols.html#x188-375658r658">nil</a></b> tellstr nil &#x0022;losers&#x0022;) <span class="math"> ⇒</span> &#x0022;Losers.&#x0022;<br>
           (format <b><a 
href="symbols.html#x188-375658r658">nil</a></b> tellstr 23 &#x0022;losers&#x0022;) <span class="math"> ⇒</span> &#x0022;Twenty-three losers.&#x0022;<br>
      <!--l. 5541--><p class="noindent" ></div>
</tt>
</div>
      <!--l. 5543--><p class="noindent" >Here are some examples of the use of <b>~̂</b> within a <b>~&#x003C;</b> construct.
      <div class="lisp"><tt><div class="tabbing">
      (format <b><a 
href="symbols.html#x188-375658r658">nil</a></b> &#x0022;~15&#x003C;~S~;~̂~S~;~̂~S~&#x003E;&#x0022; &#x2019;foo)
      <br>                                                     <span class="math"> ⇒</span> &#x0022;            FOO&#x0022;<br>
           (format <b><a 
href="symbols.html#x188-375658r658">nil</a></b> &#x0022;~15&#x003C;~S~;~̂~S~;~̂~S~&#x003E;&#x0022; &#x2019;foo &#x2019;bar)<br>
                   <span class="math"> ⇒</span> &#x0022;FOO         BAR&#x0022;<br>
           (format <b><a 
href="symbols.html#x188-375658r658">nil</a></b> &#x0022;~15&#x003C;~S~;~̂~S~;~̂~S~&#x003E;&#x0022; &#x2019;foo &#x2019;bar &#x2019;baz)<br>
                   <span class="math"> ⇒</span> &#x0022;FOO   BAR   BAZ&#x0022;<br>
      <!--l. 5551--><p class="noindent" ></div>
</tt>
</div>
      </ul>
</div>
<div class="new">
<!--l. 5555--><p class="indent" >   X3J13 voted in June 1989 <a 
 id="dx141-195014"></a>to introduce user-deﬁned directives in the form of
the <b>~/.../</b> directive. See section <a 
href="clmse140.html#x171-24700026.4">26.4<!--tex4ht:ref: PPRINT-FORMAT-DIRECTIVES-SECTION --></a> for details.
</div>
<div class="new">
<!--l. 5562--><p class="indent" >   The hairiest <b><a 
href="symbols.html#x188-375426r426">format</a></b> control string I have ever seen in shown in table <a 
href="#x141-1950159">22.9<!--tex4ht:ref: XAPPING-FORMAT-TABLE --></a>. It
started innocently enough as part of the simulator for Connection Machine
Lisp <span class="cite">[<a 
href="bib.html#XCONNECTION-MACHINE-LISP">44</a>, <a 
href="bib.html#XCMLISP-IMPLEMENTATION">57</a>]</span>; the <em>xapping</em> data type, deﬁned by <b><a 
href="symbols.html#x188-375313r313">defstruct</a></b>, needed a
<b>:print-function</b> option so that xappings would print properly. As this data
type became more complicated, step by step, so did the <b><a 
href="symbols.html#x188-375426r426">format</a></b> control
string.
</div> <div class="table">
                                                                          

                                                                          
<!--l. 5570--><p class="indent" >   <a 
 id="x141-1950159"></a><hr class="float"><div class="float" 
>
                                                                          

                                                                          
 <div class="caption" 
><span class="id">Таблица 22.9: </span><span  
class="content">Print Function for the Xapping Data Type</span></div><!--tex4ht:label?: x141-1950159 -->
<div class="lisp">
<tt>
<div class="tabbing">
(defun print-xapping (xapping stream depth)
<br>                                                    (declare (ignore depth))<br>
  (format stream<br>                               ;; Are you ready for this one?<br>
          &#x0022;~:[{~;[~]~:{~S~:[<span class="math"> ⇒</span>~S~;~*~]~:̂ ~}~:[~; ~]~<br>
           ~{~S<span class="math"> ⇒</span>~̂ ~}~:[~; ~]~[~*~;<span class="math"> ⇒</span>~S~;<span class="math"> ⇒</span>~*~]~:[}~;]~]&#x0022;<br>
          ;; Is that clear?<br>                                (xectorp xapping)<br>
          (do ((vp (xectorp xapping))<br>               (sp (ﬁnite-part-is-xetp xapping))<br>
               (d (xapping-domain xapping) (cdr d))<br>
               (r (xapping-range xapping) (cdr r))<br>
               (z &#x2019;() (cons (list (if vp (car r) (car d))<br>
                                  (or vp sp)<br>
                                  (car r))<br>                            z)))<br>
              ((null d) (reverse z)))<br>          (and (xapping-domain xapping)<br>
               (or (xapping-exceptions xapping)<br>
                   (xapping-inﬁnite xapping)))<br>
          (xapping-exceptions xapping)<br>          (and (xapping-exceptions xapping)<br>
               (xapping-inﬁnite xapping))<br>          (ecase (xapping-inﬁnite xapping)<br>
            ((nil) 0)<br>                                         (:constant 1)<br>
            (:universal 2))<br>                        (xapping-default xapping)<br>
          (xectorp xapping)))<br>
</div>
</tt>
</div>
See section <a 
href="clmse112.html#x139-18700022.1.5">22.1.5<!--tex4ht:ref: READTABLE-SECTION --></a> for the <b><a 
href="symbols.html#x188-375313r313">defstruct</a></b> deﬁnition of the <b>xapping</b> data type, whose
accessor functions are used in this code.
                                                                          

                                                                          
   </div><hr class="endfloat" />
   </div>
<div class="new">
<!--l. 5612--><p class="indent" >   See the description of <b><a 
href="symbols.html#x188-375829r829">set-macro-character</a></b> for a discussion of xappings and
the <b><a 
href="symbols.html#x188-375313r313">defstruct</a></b> deﬁnition. Assume that the predicate <b>xectorp</b> is true of a xapping
if it is a xector, and that the predicate <b>ﬁnite-part-is-xetp</b> is true if every value
in the range is the same as its corresponding index.
<!--l. 5617--><p class="indent" >   Here is a blow-by-blow description of the parts of this format string:
</div>
<div class="flushleft" 
>
<!--l. 5620--><p class="noindent" >
 <!--tex4ht:inline--><div class="tabular"><table width="100%" class="tabular"><tr><td align="left" ><b>~:[{~;[~]</b>                         </td><td align="left" ><!--l. 5623--><p class="noindent" >Print “<b>[</b>” for a xector, and “<b>{</b>” otherwise.</td>
</tr><tr><td align="left" ><b>~:{~S~:[<span class="math"> ⇒</span>~S~;~*~]~:̂ ~}</b> </td><td align="left" ><!--l. 5625--><p class="noindent" >Given a list of lists, print the pairs. Each
sublist has three elements: the index (or
the value if we&#x2019;re printing a xector); a
ﬂag that is true for either a xector or xet
(in which case no arrow is printed); and
the value. Note the use of <b>~:{</b> to iterate,
and the use of <b>~:̂</b> to avoid printing a
separating space after the ﬁnal pair (or
at all, if there are no pairs).               </td>
</tr><tr><td align="left" ><b>~:[~; ~]</b>                           </td><td align="left" ><!--l. 5632--><p class="noindent" >If   there   were   pairs   and   there   are
exceptions  or  an  inﬁnite  part,  print  a
separating space.                              </td>
</tr><tr><td align="left" ><b>~<span class="math">⟨</span>newline<span class="math">⟩</span></b>            </td><td align="left" ><!--l. 5634--><p class="noindent" >Do  nothing.  This  merely  allows  the
format control string to be broken across
two lines.                                        </td>
</tr><tr><td align="left" ><b>~{~S<span class="math"> ⇒</span>~̂ ~}</b>                  </td><td align="left" ><!--l. 5636--><p class="noindent" >Given a list of exception indices, print
them.  Note  the  use  of  <b>~{</b> to  iterate,
and  the  use  of  <b>~̂</b>  to  avoid  printing
a   separating   space   after   the   ﬁnal
exception  (or  at  all,  if  there  are  no
exceptions).                                    </td>
</tr><tr><td align="left" ><b>~:[~; ~]</b>                           </td><td align="left" ><!--l. 5641--><p class="noindent" >If there were exceptions and there is an
inﬁnite part, print a separating space.  </td>
</tr><tr><td align="left" ><b>~[~*~;<span class="math"> ⇒</span>~S~;<span class="math"> ⇒</span>~*~]</b>         </td><td align="left" ><!--l. 5643--><p class="noindent" >Use <b>~[</b> to choose one of three cases for
printing the inﬁnite part.                   </td>
</tr><tr><td align="left" ><b>~:[}~;]~]</b>                         </td><td align="left" ><!--l. 5645--><p class="noindent" >Print “<b>]</b>” for a xector, and “<b>}</b>” otherwise.</td></tr></table>
</div></div>
                                                                          

                                                                          
                                                                          

                                                                          
<!--l. 5649--><p class="indent" >   <div id="bottomlinks">&#x003C;<a 
href="clmse115.html" >Далее</a>&#x003E;&#x003C;<a 
href="clmse113.html" >Назад</a>&#x003E;&#x003C;<a 
href="clmse113.html#tailclmse113.html" >Назад-и-вниз</a>&#x003E;&#x003C;<a 
href="clmse114.html" >В-начало</a>&#x003E;&#x003C;<a 
href="io.html#clmse114.html" >Наверх</a>&#x003E;<br> &lt;<a href="../index.html">Главная</a>&gt; &lt;<a href="symbols.html">Символы</a>&gt;</div><a 
 id="tailclmse114.html"></a>
 
</body></html> 
