<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//RU"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>Изменение измерений массива</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- 3,next,fn-in,charset=utf-8,sections+,minitoc<,html --> 
<meta name="src" content="clm.tex"> 
<meta name="date" content="2012-06-05 15:52:00"> 
<link rel="stylesheet" type="text/css" href="clm.css"> 
<link rel="stylesheet" type="text/css" href="../cltl2ed.css"></head><body 
>
   <div id="toplinks"> &lt;<a href="../index.html">Главная</a>&gt; &lt;<a href="symbols.html">Символы</a>&gt; <br />&#x003C;<a 
href="string.html" >Далее</a>&#x003E;&#x003C;<a 
href="clmse95.html" >Назад</a>&#x003E;&#x003C;<a 
href="clmse95.html#tailclmse95.html" >Назад-и-вниз</a>&#x003E;&#x003C;<a 
href="#tailclmse96.html">В-конец</a>&#x003E;&#x003C;<a 
href="array.html#clmse96.html" >Наверх</a>&#x003E;</div><h3 class="sectionHead"><span class="titlemark">17.6
</span> <a 
href="clm.html#QQ2-118-188" id="x118-15800017.6">Изменение измерений массива</a></h3>
<!--l. 1724--><p class="noindent" >Следующие функции могут использоваться для изменения размера
или формы массива. Их опции почти совпадают с опциями функции
<b><a 
href="symbols.html#x188-375576r576">make-array</a></b>.
<div class="defun">
<div class="defunheader">
<em>
<!--l. 1728--><p class="noindent" >[Функция]</em><a 
 id="dx118-158001"></a> <b>adjust-array</b> <i>array</i> <i>new-dimensions</i> <tt><a 
href="clmse29.html#x39-620005.2.2">&#x0026;key</a></tt> <i>:element-type</i>
<i>:initial-element</i> <i>:initial-contents</i> <i>:ﬁll-pointer</i> <i>:displaced-to</i> <i>:displaced-index-oﬀset</i>
</div>
<b>
<!--l. 1730--><p class="indent" >   <a 
href="symbols.html#x188-375080r80">adjust-array</a></b> принимает массив и те же аргументы, что и для
<b><a 
href="symbols.html#x188-375576r576">make-array</a></b>. Количество измерений, указанных в <em>new-dimensions</em> должно
равняться рангу массива <em>array</em>.
<b>
<!--l. 1734--><p class="indent" >   <a 
href="symbols.html#x188-375080r80">adjust-array</a></b> возвращает массив такого же типа и ранга, что и массив
<em>array</em>, но с другим измерениями <em>new-dimensions</em>. Фактически, аргумент <em>array</em>
модифицируется в соответствие с новыми указаниями. Но это может быть
достигнуто двумя путями: модификацией массива <em>array</em> или созданием
нового массива и модификацией аргумента <em>array</em> для <em>соединения</em> его с новым
массивом.
<!--l. 1741--><p class="indent" >   В простейшем случае, можно указать только измерения <em>new-dimensions</em> и,
возможно, аргумент <b>:initial-element</b>. Не пустые элементы массива <em>array</em>
вставляются в новый массив. Элементы нового массива, которые не были
заполнены значениями из старого массива, получают значение из
<b>:initial-element</b>. Если аргумент не был указан, то первоначальное значение
элементов не определено.
<!--l. 1748--><p class="indent" >   Если указан <b>:element-type</b>, тогда массив <em>array</em> должен был быть создан с
указанием такого же типа. В противном случае сигнализируется ошибка.
                                                                          

                                                                          
Указание <b>:element-type</b> в <b><a 
href="symbols.html#x188-375080r80">adjust-array</a></b> служит только для проверки на
существование ошибки несовпадения типов.
<!--l. 1753--><p class="indent" >   Если указаны <b>:initial-contents</b> или <b>:displaced-to</b>, тогда они
обрабатываются как для <b><a 
href="symbols.html#x188-375576r576">make-array</a></b>. В таком случае,
<!--l. 1756--><p class="indent" >   Если указан <b>:ﬁll-pointer</b>, тогда указатель заполнения массива <em>array</em>
принимает указанное значение. Если массив <em>array</em> не содержал указателя
заполнения сигнализируется ошибка.
<div class="new">
<!--l. 1761--><p class="indent" >   X3J13 voted in June 1988 <a 
 id="dx118-158002"></a>to clarify the treatment of the <b>:ﬁll-pointer</b>
argument as follows.
<!--l. 1766--><p class="indent" >   If the <b>:ﬁll-pointer</b> argument is not supplied, then the ﬁll pointer of the <em>array</em>
is left alone. It is an error to try to adjust the <em>array</em> to a total size that is smaller
than its ﬁll pointer.
<!--l. 1771--><p class="indent" >   If the <b>:ﬁll-pointer</b> argument is supplied, then its value must be either an
integer, <b><a 
href="symbols.html#x188-375939r939">t</a></b>, or <b><a 
href="symbols.html#x188-375658r658">nil</a></b>. If it is an integer, then it is the new value for the ﬁll
pointer; it must be non-negative and no greater than the new size to
which the <em>array</em> is being adjusted. If it is <b><a 
href="symbols.html#x188-375939r939">t</a></b>, then the ﬁll pointer is set
equal to the new size for the <em>array</em>. If it is <b><a 
href="symbols.html#x188-375658r658">nil</a></b>, then the ﬁll pointer is
left alone; it is as if the argument had not been supplied. Again, it is an
error to try to adjust the <em>array</em> to a total size that is smaller than its ﬁll
pointer.
<!--l. 1783--><p class="indent" >   An error is signaled if a non-<b><a 
href="symbols.html#x188-375658r658">nil</a></b> <b>:ﬁll-pointer</b> value is supplied and the <em>array</em>
to be adjusted does not already have a ﬁll pointer.
<!--l. 1787--><p class="indent" >   This extended treatment of the <b>:ﬁll-pointer</b> argument to <b><a 
href="symbols.html#x188-375080r80">adjust-array</a></b> is
consistent with the previously existing treatment of the <b>:ﬁll-pointer</b> argument to
<b><a 
href="symbols.html#x188-375576r576">make-array</a></b>.
</div>
<b>
<!--l. 1792--><p class="indent" >   <a 
href="symbols.html#x188-375080r80">adjust-array</a></b> может, в зависимости от реализации и аргументов, просто
изменить исходный массив или создать и вернуть новый. В последнем случае
исходный массив изменяется, а именно <em>соединяется</em> с новым массивом, и
имеет новые измерения.
<div class="newer">
<!--l. 1798--><p class="indent" >   X3J13 voted in January 1989 <a 
 id="dx118-158003"></a>to allow <b><a 
href="symbols.html#x188-375080r80">adjust-array</a></b> to be applied to any
array. If <b><a 
href="symbols.html#x188-375080r80">adjust-array</a></b> is applied to an array that was originally created with
<b>:adjustable</b> true, the array returned is <b><a 
href="symbols.html#x188-375366r366">eq</a></b> to its ﬁrst argument. It is not speciﬁed
whether <b><a 
href="symbols.html#x188-375080r80">adjust-array</a></b> returns an array <b><a 
href="symbols.html#x188-375366r366">eq</a></b> to its ﬁrst argument for any other
arrays. If the array returned by <b><a 
href="symbols.html#x188-375080r80">adjust-array</a></b> is not <b><a 
href="symbols.html#x188-375366r366">eq</a></b> to its ﬁrst argument,
                                                                          

                                                                          
the original array is unchanged and does not share storage with the new
array.
<!--l. 1809--><p class="indent" >   Under this new deﬁnition, it is wise to treat <b><a 
href="symbols.html#x188-375080r80">adjust-array</a></b> in the same manner
as <b><a 
href="symbols.html#x188-375317r317">delete</a></b> and <b><a 
href="symbols.html#x188-375654r654">nconc</a></b>: one should carefully retain the returned value, for example
by writing <div class="lisp"><tt><div class="tabbing">
(setq my-array (adjust-array my-array ...))
   <br>
<!--l. 1814--><p class="noindent" ></div>
</tt>
</div>
<!--l. 1815--><p class="indent" >   rather than relying solely on a side eﬀect.
</div>
<!--l. 1818--><p class="indent" >   Если <b>adjust-array</b> применяется к массиву <em>array</em>, который соединён с
другим массивом <em>x</em>, тогда ни массив <em>array</em>, ни возвращённый результат не
будет <em>соединены</em> с <em>x</em>, если только такое соединения не задано явно в вызове
<b><a 
href="symbols.html#x188-375080r80">adjust-array</a></b>.
<!--l. 1823--><p class="indent" >   Например, предположим что массив 4-на-4 <b>m</b> выглядит так: <div class="lisp"><tt><div class="tabbing">
#2A( ( alpha     beta      gamma     delta )
   <br>                                    ( epsilon   zeta      eta       theta )<br>
     ( iota      kappa     lambda    mu    )<br>
     ( nu        xi        omicron   pi    ) )<br>
<!--l. 1829--><p class="noindent" ></div>
</tt>
</div>
<!--l. 1830--><p class="indent" >   Тогда результат выражения <div class="lisp"><tt><div class="tabbing">
(adjust-array m &#x2019;(3 5) :initial-element &#x2019;baz)
   <br>
                                                                          

                                                                          
<!--l. 1833--><p class="noindent" ></div>
</tt>
</div>
<!--l. 1834--><p class="indent" >   является массивом 3-на-5 с содержимым <div class="lisp"><tt><div class="tabbing">
#2A( ( alpha     beta      gamma     delta     baz )
   <br>                        ( epsilon   zeta      eta       theta     baz )<br>
     ( iota      kappa     lambda    mu        baz ) )<br>
<!--l. 1839--><p class="noindent" ></div>
</tt>
</div>
<!--l. 1840--><p class="indent" >   Следует отметить, что если массив <b>a</b> создаётся <em>соединённым</em> с массивом <b>b</b>
и затем массив <b>b</b> передаётся в <b><a 
href="symbols.html#x188-375080r80">adjust-array</a></b>, то массив <b>a</b> все ещё
будет <em>соединён</em> с массивом <b>b</b>. При этом должны быть приняты во
внимание правила <em>соединения</em> массивов и построчный порядок следования
элементов.
<div class="newer">
<!--l. 1847--><p class="indent" >   X3J13 voted in June 1988 <a 
 id="dx118-158004"></a>to clarify the interaction of <b><a 
href="symbols.html#x188-375080r80">adjust-array</a></b> with
array displacement.
<!--l. 1850--><p class="indent" >   Suppose that an array <em>A</em> is to be adjusted. There are four cases according to
whether or not <em>A</em> was displaced before adjustment and whether or not the result
is displaced after adjustment.
      <ul class="itemize1">
      <li class="itemize">Suppose <em>A</em> is not displaced either before or after. The dimensions of <em>A</em>
      are altered, and the contents are rearranged as appropriate. Additional
      elements of <em>A</em> are taken from the <b>:initial-element</b> argument. However,
      the use of the <b>:initial-contents</b> argument causes all old contents to be
      discarded.
      </li>
      <li class="itemize">Suppose <em>A</em> is not displaced before, but is displaced to array <em>C</em> after.
      None of the original contents of <em>A</em> appears in <em>A</em> afterwards; <em>A</em> now
      contains (some of) the contents of <em>C</em>, without any rearrangement of <em>C</em>.
      </li>
                                                                          

                                                                          
      <li class="itemize">Suppose <em>A</em> is displaced to array <em>B</em> before the call, and is displaced to
      array <em>C</em> after the call. (Note that <em>B</em> and <em>C</em> may be the same array.)
      The contents of <em>B</em> do not appear in <em>A</em> afterwards (unless such contents
      also happen to be in <em>C</em>, as when <em>B</em> and <em>C</em> are the same, for example). If
      <b>:displaced-index-oﬀset</b> is not speciﬁed in the call to <b><a 
href="symbols.html#x188-375080r80">adjust-array</a></b>,
      it defaults to zero; the old oﬀset (into <em>B</em>) is not retained.
      </li>
      <li class="itemize">Suppose <em>A</em> is displaced to array <em>B</em> before the call, but is not displaced
      afterwards.  In  this  case  <em>A</em> gets  a  new  “data  region”  and  (some  of)
      the contents of <em>B</em> are copied into it as appropriate to maintain the
      existing  old  contents.  Additional  elements  of  <em>A</em> are  taken  from  the
      <b>:initial-element</b> argument. However, the use of the <b>:initial-contents</b>
      argument causes all old contents to be discarded.</li></ul>
<!--l. 1890--><p class="indent" >   If array <em>X</em> is displaced to array <em>Y </em>, and array <em>Y </em> is displaced to array <em>Z</em>, and
array <em>Y </em> is altered by <b><a 
href="symbols.html#x188-375080r80">adjust-array</a></b>, array <em>X</em> must now refer to the adjusted
contents of <em>Y </em>. This means that an implementation may not collapse the chain to
make <em>X</em> refer to <em>Z</em> directly and forget that the chain of reference passes through
array <em>Y </em>. (Caching techniques are of course permitted, as long as they preserve the
semantics speciﬁed here.)
<!--l. 1898--><p class="indent" >   If <em>X</em> is displaced to <em>Y </em>, it is an error to adjust <em>Y </em> in such a way that it no
longer has enough elements to satisfy <em>X</em>. This error may be signaled at the time of
the adjustment, but this is not required.
<!--l. 1902--><p class="indent" >   Note that omitting the <b>:displaced-to</b> argument to <b><a 
href="symbols.html#x188-375080r80">adjust-array</a></b> is
equivalent to specifying <b>:displaced-to nil</b>; in either case, the array is not
displaced after the call regardless of whether it was displaced before the
call.
</div>
<hr></div>
                                                                          

                                                                          
                                                                          

                                                                          
                                                                          

                                                                          
<!--l. 411--><p class="indent" >   <div id="bottomlinks">&#x003C;<a 
href="string.html" >Далее</a>&#x003E;&#x003C;<a 
href="clmse95.html" >Назад</a>&#x003E;&#x003C;<a 
href="clmse95.html#tailclmse95.html" >Назад-и-вниз</a>&#x003E;&#x003C;<a 
href="clmse96.html" >В-начало</a>&#x003E;&#x003C;<a 
href="array.html#clmse96.html" >Наверх</a>&#x003E;<br> &lt;<a href="../index.html">Главная</a>&gt; &lt;<a href="symbols.html">Символы</a>&gt;</div><a 
 id="tailclmse96.html"></a>
 
</body></html> 
